{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "DWH-ADF-Development"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/m_dim_employee')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "marts/dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "pre_dim_employee",
								"type": "DatasetReference"
							},
							"name": "preDimEmployee"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "dim_employee",
								"type": "DatasetReference"
							},
							"name": "dimEmployee"
						}
					],
					"transformations": [
						{
							"name": "DeriveTopLevel",
							"description": "Derive top_key and top_description"
						},
						{
							"name": "AlterRow"
						}
					],
					"script": "source(output(\n\t\temp_source_key as string,\n\t\tagresso_emp_id as string,\n\t\temp_first_name as string,\n\t\temp_last_name as string,\n\t\temp_job_mobile as string,\n\t\temp_job_email as string,\n\t\tmain_gard_office_location as string,\n\t\temp_name as string,\n\t\tlast_updated_by as string,\n\t\tincident_team_code as string,\n\t\tincident_team_desc as string,\n\t\temp_job_phone as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\twildcardPaths:['Pre_Dim/pre_dim_employee.parquet']) ~> preDimEmployee\npreDimEmployee derive(top_key = 'ALL',\n\t\ttop_description = 'All Employees') ~> DeriveTopLevel\nDeriveTopLevel alterRow(upsertIf(!isNull(emp_source_key))) ~> AlterRow\nAlterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['dim_employee.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> dimEmployee"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_dim_guarantee_pa')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "pre_dim_guarantee_pa",
								"type": "DatasetReference"
							},
							"name": "PreDimGuarantee"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "dim_guarantee",
								"type": "DatasetReference"
							},
							"name": "DimGuarantee"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tGut_Date_Given as timestamp,\n\t\tGut_Guarantee_Issued_To as string,\n\t\tGut_Guarantee_Remarks as string,\n\t\tGut_Date_Expiry as timestamp,\n\t\tGut_Date_Created as timestamp,\n\t\tGut_Key as string,\n\t\tGut_Type_Description as string,\n\t\tGut_Guarantee_Status as string,\n\t\tGut_Inc_Key as string,\n\t\tGut_open_ind as string,\n\t\tGut_Guarantee_type_Code as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\twildcardPaths:['Pre_Dim/pre_dim_guarantee_pa.parquet']) ~> PreDimGuarantee\nPreDimGuarantee derive(Top_key = 'N/A',\n\t\tTop_Description = 'All Guarantees') ~> DerivedColumn1\nDerivedColumn1 alterRow(upsertIf(1==1)) ~> AlterRow1\nAlterRow1 sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['dim_guarantee.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimGuarantee"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_dim_source_system')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "marts/dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "pre_dim_source_system",
								"type": "DatasetReference"
							},
							"name": "PreDimSourceSystem"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "dim_source_system",
								"type": "DatasetReference"
							},
							"name": "DimSourceSystem"
						}
					],
					"transformations": [
						{
							"name": "DeriveTopLevel"
						},
						{
							"name": "RemoveUnusedColumns"
						},
						{
							"name": "SelectOutputColumns"
						},
						{
							"name": "AlterRow"
						}
					],
					"script": "source(output(\n\t\tactive as string,\n\t\tdescription as string,\n\t\tpk_source_system as string,\n\t\tlast_updated_by as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\twildcardPaths:['Pre_Dim/pre_dim_source_system.parquet']) ~> PreDimSourceSystem\nRemoveUnusedColumns derive(top_key = 'ALL',\n\t\ttop_description = 'All Source Systems') ~> DeriveTopLevel\nPreDimSourceSystem select(mapColumn(\n\t\tpk_source_system,\n\t\tdescription\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveUnusedColumns\nDeriveTopLevel select(mapColumn(\n\t\tsou_key = pk_source_system,\n\t\tsou_description = description,\n\t\ttop_key,\n\t\ttop_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectOutputColumns\nSelectOutputColumns alterRow(upsertIf(!isNull(sou_key))) ~> AlterRow\nAlterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['m_dim_source_system.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimSourceSystem"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_dim_sub_claim_pa')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "marts/dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "pre_dim_sub_claim_pa",
								"type": "DatasetReference"
							},
							"name": "PreDimSubClaim"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "dim_sub_claim",
								"type": "DatasetReference"
							},
							"name": "DimSubClaim"
						}
					],
					"transformations": [
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "AlterRow1"
						}
					],
					"script": "source(output(\n\t\tscl_sub_claim_desc as string,\n\t\tscl_sub_claim_number as decimal(38,18),\n\t\tscl_member_sub_claim_reference as string,\n\t\tscl_sub_claim_remarks as string,\n\t\tscl_gard_sub_claim_id as string,\n\t\tscl_sub_claim_type_code as string,\n\t\tscl_sub_claim_type_description as string,\n\t\tscl_sub_claim_detail_code as string,\n\t\tscl_sub_claim_detail_desc as string,\n\t\tscl_sub_claim_status as string,\n\t\tscl_rule_of_cover_code as string,\n\t\tscl_rule_of_cover_description as string,\n\t\tscl_sub_claim_handler_code as string,\n\t\tscl_sub_claim_handler_description as string,\n\t\tscl_human_location as string,\n\t\tscl_cause_of_injury as string,\n\t\tscl_title_rank_top as string,\n\t\tscl_alleged_cause as string,\n\t\tscl_alleged_cause_top as string,\n\t\tscl_carriage_method as string,\n\t\tscl_claim_type_specification as string,\n\t\tscl_inc_key as string,\n\t\tpk_key as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\twildcardPaths:['Pre_Dim/pre_dim_sub_claim_pa.parquet']) ~> PreDimSubClaim\nPreDimSubClaim derive(top_key = 'ALL',\n\t\ttop_description = 'All Sub Claims') ~> DerivedColumn1\nDerivedColumn1 alterRow(upsertIf(1==1)) ~> AlterRow1\nAlterRow1 sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimSubClaim"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_dim_vessel_type_group')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "pre_dim_vessel_type_group",
								"type": "DatasetReference"
							},
							"name": "VesselTypeGroup"
						},
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "LlyodsVessel"
						},
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcross"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "crc"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "dim_vessel_type_group",
								"type": "DatasetReference"
							},
							"name": "DimVesselTyprGroup"
						}
					],
					"transformations": [
						{
							"name": "Deduplicator"
						},
						{
							"name": "VesselType"
						},
						{
							"name": "VesselTypeCode"
						},
						{
							"name": "xrefvesseltype"
						},
						{
							"name": "VesselTypeCrossRef"
						},
						{
							"name": "CodeType"
						},
						{
							"name": "Constant"
						},
						{
							"name": "NA"
						},
						{
							"name": "onlycrossref"
						},
						{
							"name": "notInVslTypeGrp"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "notin"
						},
						{
							"name": "finalunion"
						},
						{
							"name": "vesseltypegroupselected"
						},
						{
							"name": "DefaultNull"
						},
						{
							"name": "renamingcolumns"
						},
						{
							"name": "DeriveTopLevels"
						},
						{
							"name": "AlterRow"
						}
					],
					"script": "source(output(\n\t\tfp_3_ltr_code as string,\n\t\tfp_level_5_code as string,\n\t\tfp_level_5_decode as string,\n\t\tfp_level_5_desc as string,\n\t\tfp_level_5_hull as double,\n\t\tfp_level_5_sub as string,\n\t\tinsert_date as timestamp,\n\t\tpk_vessel_type_group as double,\n\t\tupdate_date as timestamp,\n\t\tvsl_cefor_group as string,\n\t\tvsl_desc as string,\n\t\tvsl_gard_group as string,\n\t\tvsl_marine_group as string,\n\t\tvsl_risk_group as string,\n\t\tvsl_group1 as integer,\n\t\tvsl_group1_desc as string,\n\t\tvsl_group1_sort as string,\n\t\tvsl_group2 as integer,\n\t\tvsl_group2_desc as string,\n\t\tvsl_group2_sort as string,\n\t\tvsl_group3 as integer,\n\t\tvsl_group3_desc as string,\n\t\tvsl_group3_sort as string,\n\t\tvsl_group4 as integer,\n\t\tvsl_group4_desc as string,\n\t\tvsl_group4_sort as string,\n\t\tvsl_group5 as integer,\n\t\tvsl_group5_desc as string,\n\t\tvsl_group5_sort as string,\n\t\tvsl_groupIV as integer,\n\t\tvsl_groupIV_desc as string,\n\t\tvsl_groupIV_sort as string,\n\t\tvsl_groupLOH as integer,\n\t\tvsl_groupLOH_desc as string,\n\t\tvsl_groupLOH_sort as string,\n\t\tgroup_code_Size as string,\n\t\tgroup_desc_Size as string,\n\t\tfp_Lvl4_code as string,\n\t\tfp_Lvl4_Group as integer,\n\t\tgroup_Lvl4_decode as string,\n\t\tgroup_Lvl3_decode as string,\n\t\tFp_Lvl3_Group as integer,\n\t\tgroup_desc_Lvl3 as string,\n\t\tVessel_Gard_Group as string,\n\t\tVessel_Group_6 as integer,\n\t\tgroup_code_alternative_D6 as string,\n\t\tVessel_Group_6_desc as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> VesselTypeGroup\nsource(output(\n\t\tammonia_ind as string,\n\t\tanswer_back as string,\n\t\taudit_created as timestamp,\n\t\taudit_updated as timestamp,\n\t\tbale_capacity as decimal(38,18),\n\t\tballast_capacity as decimal(38,18),\n\t\tbeneficial_owner_id as decimal(38,18),\n\t\tbeneficial_owner_start_date as timestamp,\n\t\tbollard_pull as decimal(38,18),\n\t\tbore as decimal(38,18),\n\t\tbow_chain_stoppers as string,\n\t\tbow_load_discharge as string,\n\t\tbreadth_extreme as decimal(38,18),\n\t\tbreadth_moulded as decimal(38,18),\n\t\tbreaker_company as string,\n\t\tbroken_end_date as timestamp,\n\t\tbroken_place as string,\n\t\tbuilt_place as string,\n\t\tbulbous_bow_ind as string,\n\t\tcall_sign as string,\n\t\tcar_capacity as decimal(38,18),\n\t\tcasualty_date as timestamp,\n\t\tclass1 as string,\n\t\tclass1_code as string,\n\t\tclass1_esp_ind as string,\n\t\tclass1_ice_class as string,\n\t\tclass1_ice_class_text as string,\n\t\tclass1_last_survey_date as timestamp,\n\t\tclass1_notation as string,\n\t\tclass1_provisional_end_date as timestamp,\n\t\tclass1_provisional_ind as string,\n\t\tclass1_rating as string,\n\t\tclass1_start_date as timestamp,\n\t\tclass1_suspension_ind as string,\n\t\tclass1_vessel_id as string,\n\t\tclass2 as string,\n\t\tclass2_code as string,\n\t\tclass2_esp_ind as string,\n\t\tclass2_ice_class as string,\n\t\tclass2_ice_class_text as string,\n\t\tclass2_last_survey_date as timestamp,\n\t\tclass2_notation as string,\n\t\tclass2_provisional_end_date as timestamp,\n\t\tclass2_provisional_ind as string,\n\t\tclass2_rating as string,\n\t\tclass2_start_date as timestamp,\n\t\tclass2_suspension_ind as string,\n\t\tclass2_vessel_id as string,\n\t\tclass_changes_previous_3_years as decimal(38,18),\n\t\tcls_ind as string,\n\t\tco2_ind as string,\n\t\tcoil_ind as string,\n\t\tcoil_text as string,\n\t\tcollisions as decimal(38,18),\n\t\tcommercial_operator_id as decimal(38,18),\n\t\tcommercial_op_start_date as timestamp,\n\t\tcommon_boiler_type as string,\n\t\tcommon_gear_type as string,\n\t\tcommon_gear_type_code as string,\n\t\tcommon_propeller_type as string,\n\t\tcommon_propeller_type_code as string,\n\t\tconstruction_end as timestamp,\n\t\tconstruction_start as timestamp,\n\t\tconvention_69_ind as string,\n\t\tconversion_date as timestamp,\n\t\tconversion_text as string,\n\t\tcount_designation as double,\n\t\tcount_eng_builder as double,\n\t\tcount_gbowner_chg_5y as double,\n\t\tcow_ind as string,\n\t\tcurrent_flag as string,\n\t\tcurrent_flag_start_date as timestamp,\n\t\tcurrent_name as string,\n\t\tcylinder_arrangement as string,\n\t\tdead_date as timestamp,\n\t\tdeck_tank_capacity as decimal(38,18),\n\t\tdepth as decimal(38,18),\n\t\tdetentions_last_12_months as decimal(38,18),\n\t\tdetentions_last_24mon as decimal(38,18),\n\t\tdetentions_last_3_years as decimal(38,18),\n\t\tdetention_ind as string,\n\t\tdisplacement as decimal(38,18),\n\t\tdraft as decimal(38,18),\n\t\tdwt as decimal(38,18),\n\t\tearliest_engine_dob as timestamp,\n\t\tengine_action as string,\n\t\tengine_builder as string,\n\t\tengine_built_town as string,\n\t\tengine_designation as string,\n\t\tengine_designer as string,\n\t\tengine_position as string,\n\t\tengine_type as string,\n\t\tethylene_ind as string,\n\t\tflag as string,\n\t\tflag_changes_previous_3_years as decimal(38,18),\n\t\tflag_official_number as string,\n\t\tflash_point_60_ind as string,\n\t\tformula_dwt as decimal(38,18),\n\t\tfreeboard as decimal(38,18),\n\t\tfuel_capacity as decimal(38,18),\n\t\tfuel_consumption as string,\n\t\tfuel_type as string,\n\t\tfuel_type2 as string,\n\t\tgas_capacity as decimal(38,18),\n\t\tgas_max_pressure as decimal(38,18),\n\t\tgas_min_pressure as decimal(38,18),\n\t\tgearless_ind as string,\n\t\tgrain_capacity as decimal(38,18),\n\t\tgross as decimal(38,18),\n\t\thatch_type as string,\n\t\theat_exchangers as string,\n\t\theli_deck_ind as string,\n\t\thp as decimal(38,18),\n\t\thull_damage as decimal(38,18),\n\t\thull_design as string,\n\t\thull_type as string,\n\t\tigs_ind as string,\n\t\timo as decimal(38,18),\n\t\timo_rating_1 as string,\n\t\timo_rating_2 as string,\n\t\timo_rating_3 as string,\n\t\tincidents_result_in_pollution as decimal(38,18),\n\t\tincident_result_in_los_of_life as decimal(38,18),\n\t\tinmarsat_code as string,\n\t\tinmarsat_number as string,\n\t\tinspections_last_12_months as decimal(38,18),\n\t\tinspections_last_24mon as decimal(38,18),\n\t\tinspections_last_3_years as decimal(38,18),\n\t\tinspection_precis as string,\n\t\tktm as decimal(38,18),\n\t\tlane_length as decimal(38,18),\n\t\tlane_width as decimal(38,18),\n\t\tlatest_incident_precis as string,\n\t\tlatest_inspection_date as timestamp,\n\t\tlaunch_date as timestamp,\n\t\tlbp as decimal(38,18),\n\t\tliquid_capacity as decimal(38,18),\n\t\tliquid_capacity_barrels as decimal(38,18),\n\t\tlng_containment_ind as string,\n\t\tloa as decimal(38,18),\n\t\tloss_date as timestamp,\n\t\tlrg as decimal(38,18),\n\t\tlt_tonnes as decimal(38,18),\n\t\tmachinery_damage as decimal(38,18),\n\t\tmanifold_distance as decimal(38,18),\n\t\tmanifold_to_bow as decimal(38,18),\n\t\tmanifold_type as string,\n\t\tmaterial_of_build as string,\n\t\tmaximum_hatch_length as decimal(38,18),\n\t\tmaximum_hatch_width as decimal(38,18),\n\t\tmaximum_hold_depth as decimal(38,18),\n\t\tmaximum_hold_length as decimal(38,18),\n\t\tmaximum_hold_width as decimal(38,18),\n\t\tmaximum_individual_gear_swl as decimal(38,18),\n\t\tmaximum_rpm as decimal(38,18),\n\t\tmmsi as string,\n\t\tname_changes_previous_3_years as decimal(38,18),\n\t\tnet as decimal(38,18),\n\t\tnominal_owner_id as decimal(38,18),\n\t\tnominal_owner_start_date as timestamp,\n\t\tno_berths as decimal(38,18),\n\t\tno_bulkheads as decimal(38,18),\n\t\tno_cabins as decimal(38,18),\n\t\tno_centre_tanks as decimal(38,18),\n\t\tno_crew as decimal(38,18),\n\t\tno_cylinders as decimal(38,18),\n\t\tno_decks as decimal(38,18),\n\t\tno_deficiencies_last_12mon as decimal(38,18),\n\t\tno_deficiencies_last_24mon as decimal(38,18),\n\t\tno_engines as decimal(38,18),\n\t\tno_grades as decimal(38,18),\n\t\tno_lines as decimal(38,18),\n\t\tno_passengers as decimal(38,18),\n\t\tno_reefer_plugs as decimal(38,18),\n\t\tno_stainless_steel_tanks as decimal(38,18),\n\t\tno_watertight_compartments as decimal(38,18),\n\t\tno_wing_tanks as decimal(38,18),\n\t\tnumber_deficienci_last_3_year as decimal(38,18),\n\t\tnumber_owner as double,\n\t\torder_cancelled as timestamp,\n\t\torder_date as timestamp,\n\t\torder_value as decimal(38,18),\n\t\tore_capacity_tonnes as decimal(38,18),\n\t\tore_cargo_ind as string,\n\t\toriginal_sched_cons_end as timestamp,\n\t\tpanama_nrt as decimal(38,18),\n\t\tparallel_body_length as decimal(38,18),\n\t\tpiracy as decimal(38,18),\n\t\tpi_changes_previous_3_years as decimal(38,18),\n\t\tpi_club as string,\n\t\tpi_club_id as string,\n\t\tpi_start_date as timestamp,\n\t\tport_of_registry as string,\n\t\tpower_kw as decimal(38,18),\n\t\tpressurised_ind as string,\n\t\tprevious_flag as string,\n\t\tprevious_name as string,\n\t\tpropulsion_text as string,\n\t\tpropulsion_type as string,\n\t\tpump_capacity_cubic as decimal(38,18),\n\t\tpump_capacity_tonnes as decimal(38,18),\n\t\tpump_description as string,\n\t\trecord_last_updated as timestamp,\n\t\trefrigerated_capacity as decimal(38,18),\n\t\trefrigerated_ind as string,\n\t\trefrigerated_teu_capacity as decimal(38,18),\n\t\tregistered_owner_id as decimal(38,18),\n\t\tregistered_owner_start_date as timestamp,\n\t\tsbt_ind as string,\n\t\tscheduled_construction_end as timestamp,\n\t\tsemi_pressurised_ind as string,\n\t\tslop_tank_capacity as decimal(38,18),\n\t\tsnapshot_date as timestamp,\n\t\tspeed as decimal(38,18),\n\t\tspeed_type as string,\n\t\tspm_ind as string,\n\t\tstainles_steel_tanks as string,\n\t\tstart_date as timestamp,\n\t\tstatus as string,\n\t\tstern_load_discharge as string,\n\t\tstrengthened_for_heavy_cargo as string,\n\t\tstroke as decimal(38,18),\n\t\tstroke_type as decimal(38,18),\n\t\tsuez_nrt as decimal(38,18),\n\t\ttank_coated_ind as string,\n\t\ttank_coated_text as string,\n\t\ttank_text as string,\n\t\ttechnical_manager_id as decimal(38,18),\n\t\ttechnical_manager_start_date as timestamp,\n\t\tteu_14t_capacity as decimal(38,18),\n\t\tteu_capacity as decimal(38,18),\n\t\tteu_deck_capacity as decimal(38,18),\n\t\tteu_hold_capacity as decimal(38,18),\n\t\tteu_operation_capacity as decimal(38,18),\n\t\tthird_party_operator_id as decimal(38,18),\n\t\tthird_party_operator_start_dat as timestamp,\n\t\tthruster_ind as string,\n\t\ttotal_ac_current_generators as decimal(38,18),\n\t\ttotal_boilers as decimal(38,18),\n\t\ttotal_casualties as decimal(38,18),\n\t\ttotal_casualties_last_12_month as decimal(38,18),\n\t\ttotal_casualties_last_5_years as decimal(38,18),\n\t\ttotal_dc_current_generators as decimal(38,18),\n\t\ttotal_dead as decimal(38,18),\n\t\ttotal_detentions as decimal(38,18),\n\t\ttotal_generators as decimal(38,18),\n\t\ttotal_generator_power as decimal(38,18),\n\t\ttotal_hatches as decimal(38,18),\n\t\ttotal_holds as decimal(38,18),\n\t\ttotal_injured as decimal(38,18),\n\t\ttotal_inspections as decimal(38,18),\n\t\ttotal_lifting_gear as decimal(38,18),\n\t\ttotal_missing as decimal(38,18),\n\t\ttotal_propellers as decimal(38,18),\n\t\ttotal_pumps as decimal(38,18),\n\t\ttotal_tanks as decimal(38,18),\n\t\ttpcmi as decimal(38,18),\n\t\ttrailer_capacity as decimal(38,18),\n\t\tvcm_ind as string,\n\t\tvessel_builder as string,\n\t\tvessel_id as decimal(38,18),\n\t\tvessel_name as string,\n\t\tvessel_type as string,\n\t\tvessel_type_code as string,\n\t\tyard_number as string,\n\t\tyear_of_build as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> LlyodsVessel\nsource(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcross\nsource(output(\n\t\tcrcccode as decimal(38,18),\n\t\tcrccpers2 as decimal(38,18),\n\t\tcrccpers3 as decimal(38,18),\n\t\tcrccpers4 as decimal(38,18),\n\t\tcrclospro as decimal(38,18),\n\t\tcrcmdescr as string,\n\t\tcrcperinc as string,\n\t\tcrcratcod as string,\n\t\tcrcratcomp as decimal(38,18),\n\t\tcrcsdescr as string,\n\t\tcrcstopuse as string,\n\t\tcrcsw5 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> crc\nLlyodsVessel aggregate(groupBy(vessel_type,\n\t\tvessel_type_code),\n\tvessel_types = first(vessel_type)) ~> Deduplicator\ntcross filter(CODE_TYPE_ID == 45) ~> VesselType\nDeduplicator select(mapColumn(\n\t\tvessel_type_code\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> VesselTypeCode\nVesselType select(mapColumn(\n\t\tTarget_Code_vessel_type = TARGET_CODE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xrefvesseltype\nVesselTypeCode, xrefvesseltype union(byName: false)~> VesselTypeCrossRef\nVesselTypeGroup select(mapColumn(\n\t\tfp_3_ltr_code\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> CodeType\ncrc derive(NA = 'N/A',\n\t\tnot_applicable = 'Not Applicable',\n\t\tconst_number = toInteger(null()),\n\t\tfp_level5_desc = 'Not Applicable') ~> Constant\nConstant select(mapColumn(\n\t\tNA,\n\t\tfp_level_5_code = NA,\n\t\tfp_level_5_decode = not_applicable,\n\t\tfp_level_5_desc = not_applicable,\n\t\tfp_level_5_hull = const_number,\n\t\tfp_level_5_sub = NA,\n\t\tvsl_cefor_group = not_applicable,\n\t\tvsl_desc = not_applicable,\n\t\tvsl_gard_group = NA,\n\t\tvsl_marine_group = not_applicable,\n\t\tvsl_risk_group = NA,\n\t\tvsl_group1 = const_number,\n\t\tvsl_group1_desc = not_applicable,\n\t\tvsl_group1_sort = not_applicable,\n\t\tvsl_group2 = const_number,\n\t\tvsl_group2_desc = not_applicable,\n\t\tvsl_group2_sort = not_applicable,\n\t\tvsl_group3 = const_number,\n\t\tvsl_group3_desc = not_applicable,\n\t\tvsl_group3_sort = not_applicable,\n\t\tvsl_group4 = const_number,\n\t\tvsl_group4_desc = not_applicable,\n\t\tvsl_group4_sort = not_applicable,\n\t\tvsl_group5 = const_number,\n\t\tvsl_group5_desc = not_applicable,\n\t\tvsl_group5_sort = not_applicable,\n\t\tvsl_groupIV = const_number,\n\t\tvsl_groupIV_desc = not_applicable,\n\t\tvsl_groupIV_sort = not_applicable,\n\t\tvsl_groupLOH = const_number,\n\t\tvsl_groupLOH_desc = not_applicable,\n\t\tvsl_groupLOH_sort = not_applicable,\n\t\tvsl_size_group_code = not_applicable,\n\t\tfp_Lvl4_code = NA,\n\t\tfp_Lvl4_Group = const_number,\n\t\tfp_group_Lvl4_decode = not_applicable,\n\t\tfp_Lvl3_code = NA,\n\t\tfp_Lvl3_Group = const_number,\n\t\tfp_Lvl3_decode = not_applicable,\n\t\tvessel_gard_group = NA\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> NA\nVesselTypeCrossRef, CodeType join(vessel_type_code == fp_3_ltr_code,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> onlycrossref\nonlycrossref filter(iif(isNull(fp_3_ltr_code),1,0) == 1) ~> notInVslTypeGrp\nnotInVslTypeGrp derive(NA = 'N/A',\n\t\tnot_applicable = 'Not Applicable',\n\t\tconst_number = toInteger(null())) ~> DerivedColumn1\nDerivedColumn1 select(mapColumn(\n\t\tvessel_type_code,\n\t\tfp_level_5_code = NA,\n\t\tfp_level_5_decode = not_applicable,\n\t\tfp_level_5_desc = not_applicable,\n\t\tfp_level_5_hull = const_number,\n\t\tfp_level_5_sub = NA,\n\t\tvsl_cefor_group = not_applicable,\n\t\tvsl_desc = not_applicable,\n\t\tvsl_gard_group = NA,\n\t\tvsl_marine_group = not_applicable,\n\t\tvsl_risk_group = NA,\n\t\tvsl_group1 = const_number,\n\t\tvsl_group1_desc = not_applicable,\n\t\tvsl_group1_sort = not_applicable,\n\t\tvsl_group2 = const_number,\n\t\tvsl_group2_desc = not_applicable,\n\t\tvsl_group2_sort = not_applicable,\n\t\tvsl_group3 = const_number,\n\t\tvsl_group3_desc = not_applicable,\n\t\tvsl_group3_sort = not_applicable,\n\t\tvsl_group4 = const_number,\n\t\tvsl_group4_desc = not_applicable,\n\t\tvsl_group4_sort = not_applicable,\n\t\tvsl_group5 = const_number,\n\t\tvsl_group5_desc = not_applicable,\n\t\tvsl_group5_sort = not_applicable,\n\t\tvsl_groupIV = const_number,\n\t\tvsl_groupIV_desc = not_applicable,\n\t\tvsl_groupIV_sort = not_applicable,\n\t\tvsl_groupLOH = const_number,\n\t\tvsl_groupLOH_desc = not_applicable,\n\t\tvsl_groupLOH_sort = not_applicable,\n\t\tvsl_size_group_code = not_applicable,\n\t\tfp_Lvl4_code = NA,\n\t\tfp_Lvl4_Group = const_number,\n\t\tfp_group_Lvl4_decode = not_applicable,\n\t\tfp_Lvl3_code = NA,\n\t\tfp_Lvl3_Group = const_number,\n\t\tfp_Lvl3_decode = not_applicable,\n\t\tvessel_gard_group = NA\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> notin\nvesseltypegroupselected, notin, NA union(byName: false)~> finalunion\nVesselTypeGroup select(mapColumn(\n\t\tfp_3_ltr_code,\n\t\tfp_level_5_code,\n\t\tfp_level_5_decode,\n\t\tfp_level_5_desc,\n\t\tfp_level_5_hull,\n\t\tfp_level_5_sub,\n\t\tvsl_cefor_group,\n\t\tvsl_desc,\n\t\tvsl_gard_group,\n\t\tvsl_marine_group,\n\t\tvsl_risk_group,\n\t\tvsl_group1,\n\t\tvsl_group1_desc,\n\t\tvsl_group1_sort,\n\t\tvsl_group2,\n\t\tvsl_group2_desc,\n\t\tvsl_group2_sort,\n\t\tvsl_group3,\n\t\tvsl_group3_desc,\n\t\tvsl_group3_sort,\n\t\tvsl_group4,\n\t\tvsl_group4_desc,\n\t\tvsl_group4_sort,\n\t\tvsl_group5,\n\t\tvsl_group5_desc,\n\t\tvsl_group5_sort,\n\t\tvsl_groupIV,\n\t\tvsl_groupIV_desc,\n\t\tvsl_groupIV_sort,\n\t\tvsl_groupLOH,\n\t\tvsl_groupLOH_desc,\n\t\tvsl_groupLOH_sort,\n\t\tvsl_size_group_code = group_code_Size,\n\t\tfp_Lvl4_code,\n\t\tfp_Lvl4_Group,\n\t\tfp_group_Lvl4_decode = group_Lvl4_decode,\n\t\tfp_Lvl3_code = group_Lvl3_decode,\n\t\tfp_Lvl3_Group = Fp_Lvl3_Group,\n\t\tfp_Lvl3_decode = group_desc_Lvl3,\n\t\tVessel_Gard_Group\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> vesseltypegroupselected\nfinalunion derive(fp_3_ltr_code = iifNull(trim(fp_3_ltr_code),'N/A'),\n\t\tfp_level_5_code = iifNull(trim(fp_level_5_code),'N/A'),\n\t\tfp_level_5_decode = iifNull(trim(fp_level_5_decode),'N/A'),\n\t\tfp_level_5_desc = iifNull(trim(fp_level_5_desc),'N/A'),\n\t\tfp_level_5_hull = iifNull(fp_level_5_hull,0),\n\t\tfp_level_5_sub = iifNull(trim(fp_level_5_sub),'N/A'),\n\t\tvsl_cefor_group = iifNull(trim(vsl_cefor_group),'N/A'),\n\t\tvsl_desc = iifNull(trim(vsl_desc),'N/A'),\n\t\tvsl_gard_group = iifNull(trim(vsl_gard_group),'N/A'),\n\t\tvsl_marine_group = iifNull(trim(vsl_marine_group),'N/A'),\n\t\tvsl_risk_group = iifNull(trim(vsl_risk_group),'N/A'),\n\t\tvsl_group1 = iifNull((vsl_group1),0),\n\t\tvsl_group1_desc = iifNull(trim(vsl_group1_desc),'N/A'),\n\t\tvsl_group1_sort = iifNull(trim(vsl_group1_sort),'N/A'),\n\t\tvsl_group2 = iifNull((vsl_group2),0),\n\t\tvsl_group2_desc = iifNull(trim(vsl_group2_desc),'N/A'),\n\t\tvsl_group2_sort = iifNull(trim(vsl_group2_sort),'N/A'),\n\t\tvsl_group3 = iifNull((vsl_group3),0),\n\t\tvsl_group3_desc = iifNull(trim(vsl_group3_desc),'N/A'),\n\t\tvsl_group3_sort = iifNull(trim(vsl_group3_sort),'N/A'),\n\t\tvsl_group4 = iifNull((vsl_group4),0),\n\t\tvsl_group4_desc = iifNull(trim(vsl_group4_desc),'N/A'),\n\t\tvsl_group4_sort = iifNull(trim(vsl_group4_sort),'N/A'),\n\t\tvsl_group5 = iifNull((vsl_group5),0),\n\t\tvsl_group5_desc = iifNull(trim(vsl_group5_desc),'N/A'),\n\t\tvsl_group5_sort = iifNull(trim(vsl_group5_sort),'N/A'),\n\t\tvsl_groupIV = iifNull(vsl_groupIV,0),\n\t\tvsl_groupIV_desc = iifNull(trim(vsl_groupIV_desc),'N/A'),\n\t\tvsl_groupIV_sort = iifNull(trim(vsl_groupIV_sort),'N/A'),\n\t\tvsl_groupLOH = iifNull(vsl_groupLOH,0),\n\t\tvsl_groupLOH_desc = iifNull(trim(vsl_groupLOH_desc),'N/A'),\n\t\tvsl_groupLOH_sort = iifNull(trim(vsl_groupLOH_sort),'N/A'),\n\t\tvsl_size_group_code = iifNull(trim(vsl_size_group_code),'N/A'),\n\t\tfp_Lvl4_code = iifNull(trim(fp_Lvl4_code),'N/A'),\n\t\tfp_Lvl4_Group = iifNull(fp_Lvl4_Group,0),\n\t\tfp_group_Lvl4_decode = iifNull(trim(fp_group_Lvl4_decode),'N/A'),\n\t\tfp_Lvl3_code = iifNull(trim(fp_Lvl3_code),'N/A'),\n\t\tfp_Lvl3_Group = iifNull((fp_Lvl3_Group),0),\n\t\tfp_Lvl3_decode = iifNull(trim(fp_Lvl3_decode),'N/A'),\n\t\tVessel_Gard_Group = iifNull(trim(vsl_gard_group),'N/A')) ~> DefaultNull\nDefaultNull select(mapColumn(\n\t\tgrp_vessel_type_code_3ltr = fp_3_ltr_code,\n\t\tgrp_fp_level_5_code = fp_level_5_code,\n\t\tgrp_fp_level_5_decode = fp_level_5_decode,\n\t\tgrp_fp_level_5_desc = fp_level_5_desc,\n\t\tgrp_fp_level_5_hull = fp_level_5_hull,\n\t\tgrp_fp_level_5_sub = fp_level_5_sub,\n\t\tgrp_vsl_cefor_group = vsl_cefor_group,\n\t\tgrp_vsl_desc = vsl_desc,\n\t\tgrp_vsl_gard_group = vsl_gard_group,\n\t\tgrp_vsl_marine_group = vsl_marine_group,\n\t\tgrp_vsl_risk_group = vsl_risk_group,\n\t\tgrp_vsl_group1 = vsl_group1,\n\t\tgrp_vsl_group1_desc = vsl_group1_desc,\n\t\tgrp_vsl_group1_sort = vsl_group1_sort,\n\t\tgrp_vsl_group2 = vsl_group2,\n\t\tgrp_vsl_group2_desc = vsl_group2_desc,\n\t\tgrp_vsl_group2_sort = vsl_group2_sort,\n\t\tgrp_vsl_group3 = vsl_group3,\n\t\tgrp_vsl_group3_desc = vsl_group3_desc,\n\t\tgrp_vsl_group3_sort = vsl_group3_sort,\n\t\tgrp_vsl_group4 = vsl_group4,\n\t\tgrp_vsl_group4_desc = vsl_group4_desc,\n\t\tgrp_vsl_group4_sort = vsl_group4_sort,\n\t\tgrp_vsl_group5 = vsl_group5,\n\t\tgrp_vsl_group5_desc = vsl_group5_desc,\n\t\tgrp_vsl_group5_sort = vsl_group5_sort,\n\t\tgrp_vsl_groupIV = vsl_groupIV,\n\t\tgrp_vsl_groupIV_desc = vsl_groupIV_desc,\n\t\tgrp_vsl_groupIV_sort = vsl_groupIV_sort,\n\t\tgrp_vsl_groupLOH = vsl_groupLOH,\n\t\tgrp_vsl_groupLOH_desc = vsl_groupLOH_desc,\n\t\tgrp_vsl_groupLOH_sort = vsl_groupLOH_sort,\n\t\tgrp_vsl_size_group_code = vsl_size_group_code,\n\t\tgrp_fp_Lvl4_code = fp_Lvl4_code,\n\t\tgrp_fp_Lvl4_Group = fp_Lvl4_Group,\n\t\tgrp_fp_group_Lvl4_decode = fp_group_Lvl4_decode,\n\t\tgrp_fp_Lvl3_code = fp_Lvl3_code,\n\t\tgrp_fp_Lvl3_Group = fp_Lvl3_Group,\n\t\tgrp_fp_Lvl3_decode = fp_Lvl3_decode\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> renamingcolumns\nrenamingcolumns derive(top_key = 'ALL',\n\t\ttop_description = 'All Source Systems') ~> DeriveTopLevels\nDeriveTopLevels alterRow(upsertIf(iifNull(grp_vessel_type_code_3ltr,'A')!='A')) ~> AlterRow\nAlterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimVesselTyprGroup"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_fact_exch_rate')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "marts"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "stage_hlp_exchange_rate",
								"type": "DatasetReference"
							},
							"name": "hlpExchRate"
						},
						{
							"dataset": {
								"referenceName": "dim_currency",
								"type": "DatasetReference"
							},
							"name": "dimCurrency"
						},
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "dimTime"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "fact_exchange_rate",
								"type": "DatasetReference"
							},
							"name": "factExchangeRate"
						}
					],
					"transformations": [
						{
							"name": "LkpCurFrom"
						},
						{
							"name": "SelectColumns"
						},
						{
							"name": "LkpCurTo"
						},
						{
							"name": "SelectRelevantColumns"
						},
						{
							"name": "LkpExchDate"
						},
						{
							"name": "SelectToReduceCol"
						},
						{
							"name": "Deduplicator"
						},
						{
							"name": "AlterRowUpsert"
						}
					],
					"script": "source(output(\n\t\tcurrency_code_from as string,\n\t\tcurrency_code_to as string,\n\t\tcurrency_id_from as decimal(38,18),\n\t\tcurrency_id_to as decimal(38,18),\n\t\tday as timestamp,\n\t\trate as double\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> hlpExchRate\nsource(output(\n\t\tdim_key as long,\n\t\ttop_code as string,\n\t\ttop_description as string,\n\t\tcur_code as string,\n\t\tcur_description as string,\n\t\tcurr_last_exchange_rate_to_usd as decimal(12,2)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> dimCurrency\nsource(output(\n\t\taccounting_month_end_date as timestamp,\n\t\taccounting_month_id as double,\n\t\taccounting_month_key as decimal(38,18),\n\t\taccounting_month_of_quarter as double,\n\t\taccounting_month_of_year as double,\n\t\taccounting_month_start_date as timestamp,\n\t\taccounting_month_time_span as double,\n\t\taccounting_qtr_end_date as timestamp,\n\t\taccounting_qtr_of_year as double,\n\t\taccounting_qtr_start_date as timestamp,\n\t\taccounting_qtr_time_span as double,\n\t\taccounting_quarter_id as double,\n\t\taccounting_quarter_key as decimal(38,18),\n\t\taccounting_year_end_date as timestamp,\n\t\taccounting_year_id as double,\n\t\taccounting_year_key as decimal(38,18),\n\t\taccounting_year_number as double,\n\t\taccounting_year_start_date as timestamp,\n\t\taccounting_year_time_span as double,\n\t\tall_years as string,\n\t\tcalendar_date_id as double,\n\t\tcalendar_date_key as timestamp,\n\t\tday as timestamp,\n\t\tday_name as string,\n\t\tday_of_accounting_month as double,\n\t\tday_of_accounting_quarter as double,\n\t\tday_of_accounting_year as double,\n\t\tday_of_policy_month as double,\n\t\tday_of_policy_quarter as double,\n\t\tday_of_policy_year as double,\n\t\tday_of_underwriting_month as double,\n\t\tday_of_underwriting_quarter as double,\n\t\tday_of_underwriting_year as double,\n\t\tdimension_key as double,\n\t\tpolicy_month_end_date as timestamp,\n\t\tpolicy_month_id as double,\n\t\tpolicy_month_key as decimal(38,18),\n\t\tpolicy_month_name as string,\n\t\tpolicy_month_of_quarter as double,\n\t\tpolicy_month_of_year as double,\n\t\tpolicy_month_start_date as timestamp,\n\t\tpolicy_month_time_span as double,\n\t\tpolicy_qtr_end_date as timestamp,\n\t\tpolicy_qtr_of_year as double,\n\t\tpolicy_qtr_start_date as timestamp,\n\t\tpolicy_qtr_time_span as double,\n\t\tpolicy_quarter_id as double,\n\t\tpolicy_quarter_key as decimal(38,18),\n\t\tpolicy_year_end_date as timestamp,\n\t\tpolicy_year_id as double,\n\t\tpolicy_year_key as decimal(38,18),\n\t\tpolicy_year_number as double,\n\t\tpolicy_year_start_date as timestamp,\n\t\tpolicy_year_time_span as double,\n\t\ttop_id as double,\n\t\ttop_key as decimal(38,18),\n\t\tunderwriting_month_end_date as timestamp,\n\t\tunderwriting_month_id as double,\n\t\tunderwriting_month_key as decimal(38,18),\n\t\tunderwriting_month_of_quarter as double,\n\t\tunderwriting_month_of_year as double,\n\t\tunderwriting_month_start_date as timestamp,\n\t\tunderwriting_month_time_span as double,\n\t\tunderwriting_qtr_end_date as timestamp,\n\t\tunderwriting_qtr_of_year as double,\n\t\tunderwriting_qtr_start_date as timestamp,\n\t\tunderwriting_qtr_time_span as double,\n\t\tunderwriting_quarter_id as double,\n\t\tunderwriting_quarter_key as decimal(38,18),\n\t\tunderwriting_year_end_date as timestamp,\n\t\tunderwriting_year_id as double,\n\t\tunderwriting_year_key as decimal(38,18),\n\t\tunderwriting_year_number as double,\n\t\tunderwriting_year_start_date as timestamp,\n\t\tunderwriting_year_time_span as double\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> dimTime\nhlpExchRate, dimCurrency lookup(currency_code_from == cur_code,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LkpCurFrom\nLkpCurFrom select(mapColumn(\n\t\tday,\n\t\trate,\n\t\tcur_dim_key_from = dim_key,\n\t\teach(match(startsWith(name,'currency_')),\n\t\t\t'source_'+$$ = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectColumns\nSelectColumns, dimCurrency lookup(source_currency_code_to == cur_code,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LkpCurTo\nLkpCurTo select(mapColumn(\n\t\tsource_day = day,\n\t\tsource_rate = rate,\n\t\tcur_dim_key_from,\n\t\tsource_currency_code_from,\n\t\tsource_currency_code_to,\n\t\tsource_currency_id_from,\n\t\tsource_currency_id_to,\n\t\tcur_dim_key_to = dim_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectRelevantColumns\nSelectRelevantColumns, dimTime lookup(source_day == day,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LkpExchDate\nLkpExchDate select(mapColumn(\n\t\tdim_time = dimension_key,\n\t\texchange_rate = source_rate,\n\t\tdim_currency_from = cur_dim_key_from,\n\t\tdim_currency_to = cur_dim_key_to,\n\t\tfrom_currency_code = source_currency_code_from,\n\t\tto_currency_code = source_currency_code_to,\n\t\texchange_date = day\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectToReduceCol\nSelectToReduceCol aggregate(groupBy(dim_time,\n\t\texchange_rate,\n\t\tdim_currency_from,\n\t\tdim_currency_to,\n\t\tfrom_currency_code,\n\t\tto_currency_code),\n\texchange_date = first(exchange_date)) ~> Deduplicator\nDeduplicator alterRow(upsertIf((!isNull(dim_time))||(!isNull(from_currency_code))||(isNull(to_currency_code)))) ~> AlterRowUpsert\nAlterRowUpsert sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['fact_exchange_rate.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> factExchangeRate"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_hlp_exchange_rate_usd')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_stage"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "stage_hlp_exchange_rate",
								"type": "DatasetReference"
							},
							"name": "hlpExhangeRate"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "hlp_exchange_rate_to_usd",
								"type": "DatasetReference"
							},
							"name": "hlpExchangeRateUSD"
						}
					],
					"transformations": [
						{
							"name": "FltrUSDCurrency"
						}
					],
					"script": "source(output(\n\t\tcurrency_code_from as string,\n\t\tcurrency_code_to as string,\n\t\tcurrency_id_from as decimal(38,18),\n\t\tcurrency_id_to as decimal(38,18),\n\t\tday as timestamp,\n\t\trate as double\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tformat: 'parquet') ~> hlpExhangeRate\nhlpExhangeRate filter(currency_code_to=='USD') ~> FltrUSDCurrency\nFltrUSDCurrency sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['stage_hlp_exchange_rate_to_usd.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> hlpExchangeRateUSD"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_agreement_pa')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "Pagatable"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "Pagztable"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "Ppebtable"
						},
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcrossreference"
						},
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "SrcSfCompany"
						},
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "DimTime"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_agreement",
								"type": "DatasetReference"
							},
							"name": "PreDimAgreement"
						}
					],
					"transformations": [
						{
							"name": "pebtableselect"
						},
						{
							"name": "pebtablemax"
						},
						{
							"name": "MaxPebver"
						},
						{
							"name": "pebisolan",
							"description": "Get last pebisolan pr pabpeaid"
						},
						{
							"name": "agatable"
						},
						{
							"name": "agztable"
						},
						{
							"name": "AgaAgz"
						},
						{
							"name": "AgaPeb"
						},
						{
							"name": "AgaCol"
						},
						{
							"name": "pebtable",
							"description": "Get last pebisolan pr pebpeaid"
						},
						{
							"name": "ParisMarketArea",
							"description": "source_system=PARIS and code_type_id=460"
						},
						{
							"name": "XrefMarketArea",
							"description": "code_type_id=460"
						},
						{
							"name": "ParisEmployee",
							"description": "source_system=PARIS and code_type_id=329"
						},
						{
							"name": "XrefEmpDefClmHandler",
							"description": "Default Claim Handler - Employee - 329"
						},
						{
							"name": "ParisVesslType",
							"description": "source_system=PARIS and code_type_id=45"
						},
						{
							"name": "XrefVesselType",
							"description": "code_type_id=45"
						},
						{
							"name": "ParisMarketSegment",
							"description": "source_system=PARIS and code_type_id=806"
						},
						{
							"name": "XrefMarketSegment",
							"description": "code_type_id=806"
						},
						{
							"name": "XrefEmpDefClmAdjuster",
							"description": "Default Claim Adjuster - Employee - 329"
						},
						{
							"name": "XrefEmpUW",
							"description": "Underwriter - Employee - 329"
						},
						{
							"name": "XrefEmpUwResp",
							"description": "Responsible Underwriter - Employee - 329"
						},
						{
							"name": "XrefEmpUwAss",
							"description": "Underwriter Assistant - Employee - 329"
						},
						{
							"name": "ParisAgreementTypeDetail",
							"description": "Source_system=PARIS and code_type_id=813"
						},
						{
							"name": "XrefAgreementTypeDet",
							"description": "Agreement Type Detail - 813"
						},
						{
							"name": "ParisOffice",
							"description": "Source_system=PARIS and code_type_id=112"
						},
						{
							"name": "XrefOffice",
							"description": "code_tye_id=112"
						},
						{
							"name": "ParisUwAssistTeam",
							"description": "Source_system=PARIS and code_type_id=809"
						},
						{
							"name": "XrefUwAssistTeam",
							"description": "Code_type_id=809"
						},
						{
							"name": "AgaBroker",
							"description": "Include broker_id"
						},
						{
							"name": "ParisCompany",
							"description": "Source_system='PARIS'"
						},
						{
							"name": "SfCompanyBroker",
							"description": "Broker name and id"
						},
						{
							"name": "SfCompanyClient"
						},
						{
							"name": "JoinOffice",
							"description": "Include Office_name"
						},
						{
							"name": "JoinAgreementTypeDet",
							"description": "Include Agreement Type Details"
						},
						{
							"name": "JoinUwAssistTeam",
							"description": "Include Underwriting Assistant Team"
						},
						{
							"name": "JoinUwAssist",
							"description": "Include Underwriter Assistant"
						},
						{
							"name": "JoinUw",
							"description": "Include Underwriter"
						},
						{
							"name": "JoinUwResp",
							"description": "Include Responsible Underwriter"
						},
						{
							"name": "JoinDefClmAdj",
							"description": "Include Default Claim Adjuster"
						},
						{
							"name": "JoinSfClient"
						},
						{
							"name": "JoinSfBroker"
						},
						{
							"name": "JoinMarketArea"
						},
						{
							"name": "JoinMarketSegment"
						},
						{
							"name": "JoinVesselType"
						},
						{
							"name": "UwYear",
							"description": "Select Underwriting year"
						},
						{
							"name": "JoinUwYear"
						},
						{
							"name": "AgreementRef",
							"description": "Agreement Reference"
						},
						{
							"name": "AgtUwYrMarket",
							"description": "Agreement Type, UwYear, UwYrdays, Market Area and Market Segment columns"
						},
						{
							"name": "JoinDefClmHandl"
						},
						{
							"name": "Select1",
							"description": "Include all target columns"
						}
					],
					"script": "source(output(\n\t\tagaadjsign as string,\n\t\tagaadmcode as string,\n\t\tagaagaid as string,\n\t\tagaagname as string,\n\t\tagaagno as decimal(38,18),\n\t\tagaagnorf as decimal(38,18),\n\t\tagaagtype as decimal(38,18),\n\t\tagaalgid as string,\n\t\tagaareacd as string,\n\t\tagaassetno as decimal(38,18),\n\t\tagaassetsubno as decimal(38,18),\n\t\tagaausign as string,\n\t\tagaautoconpol as string,\n\t\tagaavttrkeep as string,\n\t\tagaavttrnote as string,\n\t\tagaavttrpeaid as decimal(38,18),\n\t\tagaavttrpros as decimal(38,18),\n\t\tagaavttrstatus as string,\n\t\tagaavttrynsw as string,\n\t\tagabusnbranch as decimal(38,18),\n\t\tagabusncla as decimal(38,18),\n\t\tagabusndiv as decimal(38,18),\n\t\tagabusnregion as decimal(38,18),\n\t\tagabusnsec as decimal(38,18),\n\t\tagacantxt as string,\n\t\tagacashbefcovdate as timestamp,\n\t\tagacashbeforecover as string,\n\t\tagaccpid as string,\n\t\tagachartradeteam as string,\n\t\tagaclasstype as string,\n\t\tagaclmsign as string,\n\t\tagaclmuat as string,\n\t\tagaclosedate as timestamp,\n\t\tagaclosesign as string,\n\t\tagacloseynsw as string,\n\t\tagacomfacnote as string,\n\t\tagacomfacpeaid as decimal(38,18),\n\t\tagacomfacynsw as string,\n\t\tagacomp2 as decimal(38,18),\n\t\tagacompdisckeep as string,\n\t\tagacompdiscnote as string,\n\t\tagacompdiscpeaid as decimal(38,18),\n\t\tagacompdiscpros as decimal(38,18),\n\t\tagacompdiscynsw as string,\n\t\tagacomtarnote as string,\n\t\tagacomtarpeaid as decimal(38,18),\n\t\tagacomtarstknote as string,\n\t\tagacomtarstkpeaid as decimal(38,18),\n\t\tagacomtarstkynsw as string,\n\t\tagacomtarynsw as string,\n\t\tagaconcern as decimal(38,18),\n\t\tagaconnectsw as string,\n\t\tagaconsrnote as string,\n\t\tagaconsrynsw as string,\n\t\tagacontinsagaid as string,\n\t\tagacontinsagno as decimal(38,18),\n\t\tagacontinsynsw as string,\n\t\tagacrdate as timestamp,\n\t\tagacrsign as string,\n\t\tagacumul as string,\n\t\tagadatcan as timestamp,\n\t\tagadatest as timestamp,\n\t\tagadatora as timestamp,\n\t\tagadatore as timestamp,\n\t\tagadatpca as timestamp,\n\t\tagadecltyp as string,\n\t\tagadwbs as string,\n\t\tagaeldocynsw as string,\n\t\tagaelinvynsw as string,\n\t\tagaendate as timestamp,\n\t\tagaenhour as decimal(38,18),\n\t\tagaentrytype as string,\n\t\tagaeosign as string,\n\t\tagafileref as decimal(38,18),\n\t\tagafixprnote as string,\n\t\tagafixprpeaid as decimal(38,18),\n\t\tagafixprynsw as string,\n\t\tagafromcomp as decimal(38,18),\n\t\tagagday as decimal(38,18),\n\t\tagagen1keep as string,\n\t\tagagen1note as string,\n\t\tagagen1peaid as decimal(38,18),\n\t\tagagen1prov as decimal(38,18),\n\t\tagagen1ynsw as string,\n\t\tagagen2keep as string,\n\t\tagagen2note as string,\n\t\tagagen2peaid as decimal(38,18),\n\t\tagagen2prov as decimal(38,18),\n\t\tagagen2ynsw as string,\n\t\tagagen3keep as string,\n\t\tagagen3note as string,\n\t\tagagen3peaid as decimal(38,18),\n\t\tagagen3prov as decimal(38,18),\n\t\tagagen3ynsw as string,\n\t\tagagident as string,\n\t\tagagmonth as decimal(38,18),\n\t\tagagtype as string,\n\t\tagahealthdate as timestamp,\n\t\tagahealthynsw as string,\n\t\tagaincprovkeep as string,\n\t\tagaincprovnote as string,\n\t\tagaincprovpeaid as decimal(38,18),\n\t\tagaincprovpros as decimal(38,18),\n\t\tagaincprovynsw as string,\n\t\tagaincrebkeep as string,\n\t\tagaincrebnote as string,\n\t\tagaincrebpeaid as decimal(38,18),\n\t\tagaincrebpros as decimal(38,18),\n\t\tagaincrebynsw as string,\n\t\tagaindustrytxt as string,\n\t\tagainstti as string,\n\t\tagaintnote as string,\n\t\tagaisic as string,\n\t\tagaiyear as decimal(38,18),\n\t\tagaknvmark as string,\n\t\tagaktocred as decimal(38,18),\n\t\tagaktocust as decimal(38,18),\n\t\tagaktodeb as decimal(38,18),\n\t\tagaliabendate as timestamp,\n\t\tagalocpolissued as string,\n\t\tagalongname as string,\n\t\tagalostcode as string,\n\t\tagalosttxt35 as string,\n\t\tagaludate as timestamp,\n\t\tagalusign as string,\n\t\tagamaiper as decimal(38,18),\n\t\tagamgrpnote as string,\n\t\tagamgrpynsw as string,\n\t\tagamincurr as string,\n\t\tagaminpre as decimal(38,18),\n\t\taganoterm as decimal(38,18),\n\t\tagansalecom as decimal(38,18),\n\t\taganscomynsw as string,\n\t\taganumpers as decimal(38,18),\n\t\tagaoffice as decimal(38,18),\n\t\tagaoiltyp as decimal(38,18),\n\t\tagaopencover as string,\n\t\tagaordercode as string,\n\t\tagaordertxt35 as string,\n\t\tagaorgcrdate as timestamp,\n\t\tagaorgins as decimal(38,18),\n\t\tagaoxno as decimal(38,18),\n\t\tagaoxrefid as string,\n\t\tagaoyrno as decimal(38,18),\n\t\tagaoyrnote as string,\n\t\tagaoyrto as decimal(38,18),\n\t\tagapeoid as string,\n\t\tagapictype as string,\n\t\tagapwcode as decimal(38,18),\n\t\tagapwfrdate as timestamp,\n\t\tagaratcod as string,\n\t\tagaratemodel as decimal(38,18),\n\t\tagarefcod as string,\n\t\tagareftxt as string,\n\t\tagaremove as decimal(38,18),\n\t\tagarenbatchid as decimal(38,18),\n\t\tagarencod as decimal(38,18),\n\t\tagarentxt as string,\n\t\tagasalesdiv as decimal(38,18),\n\t\tagasetfreq as decimal(38,18),\n\t\tagasettldetprt as string,\n\t\tagashut as string,\n\t\tagasitid as string,\n\t\tagaskipinstadynsw as string,\n\t\tagasource as decimal(38,18),\n\t\tagastat1 as string,\n\t\tagastat2 as string,\n\t\tagastateareacd as string,\n\t\tagastdate as timestamp,\n\t\tagasthour as decimal(38,18),\n\t\tagaswo as string,\n\t\tagatocomp as decimal(38,18),\n\t\tagatrackit as string,\n\t\tagatrackit1 as string,\n\t\tagatrackit2 as string,\n\t\tagatrackit3 as string,\n\t\tagatreatas as string,\n\t\tagaturnover as decimal(38,18),\n\t\tagatzone as string,\n\t\tagauat as string,\n\t\tagaufafpynsw as string,\n\t\tagausage as string,\n\t\tagausecod as string,\n\t\tagauwsign as string,\n\t\tagawbs as string,\n\t\tagawbscust as string,\n\t\tagawntnocperiod as decimal(38,18),\n\t\tagawnttext35 as string,\n\t\tagawntynsw as string,\n\t\tagaxmednote as string,\n\t\tagaxmedpeaid as decimal(38,18),\n\t\tagaxmedynsw as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> Pagatable\nsource(output(\n\t\tagzaccadrpeaid as decimal(38,18),\n\t\tagzactnodate as timestamp,\n\t\tagzactnoofemp as decimal(38,18),\n\t\tagzagzid as string,\n\t\tagzamtcod as string,\n\t\tagzbusntyp as decimal(38,18),\n\t\tagzcedent as decimal(38,18),\n\t\tagzcefoty as string,\n\t\tagzclmadrpeaid as decimal(38,18),\n\t\tagzclmlead as decimal(38,18),\n\t\tagzcooroccynsw as string,\n\t\tagzcshind as decimal(38,18),\n\t\tagzcurrgrosepi as decimal(38,18),\n\t\tagzcurrosgrosepi as decimal(38,18),\n\t\tagzdefcurr as string,\n\t\tagzdefexchrate as decimal(38,18),\n\t\tagzdefinstcalctype as decimal(38,18),\n\t\tagzdefinstpertype as decimal(38,18),\n\t\tagzdefintrst as string,\n\t\tagzdefwarrsw as string,\n\t\tagzepicurr as string,\n\t\tagzextadjynsw as string,\n\t\tagzfagntno as decimal(38,18),\n\t\tagzgtepi as decimal(38,18),\n\t\tagzgvalue as decimal(38,18),\n\t\tagzinstadynz as string,\n\t\tagzleadownline as string,\n\t\tagzndisc as decimal(38,18),\n\t\tagznoofemp as decimal(38,18),\n\t\tagznoofobjepi as decimal(38,18),\n\t\tagzoforder as decimal(38,18),\n\t\tagzordtxt35 as string,\n\t\tagzosgrosepi as decimal(38,18),\n\t\tagzosnetepi as decimal(38,18),\n\t\tagzosnpml as decimal(38,18),\n\t\tagzospml as decimal(38,18),\n\t\tagzourlin as decimal(38,18),\n\t\tagzratind as decimal(38,18),\n\t\tagztogrosepi as decimal(38,18),\n\t\tagztonetepi as decimal(38,18),\n\t\tagztonpml as decimal(38,18),\n\t\tagztotind as decimal(38,18),\n\t\tagztotpml as decimal(38,18),\n\t\tagzuwradrpeaid as decimal(38,18),\n\t\tagzvescod as string,\n\t\tagzwarrenty as decimal(38,18),\n\t\tagzwroforder as decimal(38,18),\n\t\tagzwrshare as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> Pagztable\nsource(output(\n\t\tpebbrdate as timestamp,\n\t\tpebcivilstatus as decimal(38,18),\n\t\tpebconbusncla as decimal(38,18),\n\t\tpebconbusndiv as decimal(38,18),\n\t\tpebconbusnsec as decimal(38,18),\n\t\tpebconcomp2 as decimal(38,18),\n\t\tpebconoffice as decimal(38,18),\n\t\tpebdistrict as string,\n\t\tpebdunco as decimal(38,18),\n\t\tpebemlcurr as string,\n\t\tpebemlmdescr as string,\n\t\tpebetcbroker as string,\n\t\tpebfortsector as decimal(38,18),\n\t\tpebforttrade as string,\n\t\tpebgeneml as decimal(38,18),\n\t\tpebgroup as decimal(38,18),\n\t\tpebhourprice as decimal(38,18),\n\t\tpebinstadynz as string,\n\t\tpebisolan as string,\n\t\tpebkycapprdate as timestamp,\n\t\tpebkycapproved as string,\n\t\tpebkyccompany as decimal(38,18),\n\t\tpebkyccompdescr as string,\n\t\tpebkycid as string,\n\t\tpebludate as timestamp,\n\t\tpeblusign as string,\n\t\tpebmacheml as decimal(38,18),\n\t\tpebmansanctdescr as string,\n\t\tpebmansanction as string,\n\t\tpebmdescr as string,\n\t\tpebmvaynsw as string,\n\t\tpebnmisic as string,\n\t\tpebnmnyk as string,\n\t\tpeboffsanctdescr as string,\n\t\tpeboffsanction as string,\n\t\tpebonrisk as string,\n\t\tpebonriskdate as timestamp,\n\t\tpebpaylevel as decimal(38,18),\n\t\tpebpeaid as decimal(38,18),\n\t\tpebpebid as string,\n\t\tpebpeoid as string,\n\t\tpebpeoopeaid as decimal(38,18),\n\t\tpebpersacc as decimal(38,18),\n\t\tpebpever as decimal(38,18),\n\t\tpebpibregdate as timestamp,\n\t\tpebpibregsign as string,\n\t\tpebpidcname as string,\n\t\tpebpidid as decimal(38,18),\n\t\tpebpricecurr as string,\n\t\tpebqadate as timestamp,\n\t\tpebqasign as string,\n\t\tpebqastatus as string,\n\t\tpebratcod as string,\n\t\tpebratcomp as decimal(38,18),\n\t\tpebratedate as timestamp,\n\t\tpebratludate as timestamp,\n\t\tpebratsign as string,\n\t\tpebreason as string,\n\t\tpebressign as string,\n\t\tpebsitid as string,\n\t\tpebsupporter as string,\n\t\tpebtaxno as string,\n\t\tpebtypelevel as decimal(38,18),\n\t\tpebusstate as string,\n\t\tpebvaldate as timestamp,\n\t\tpebverstat as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> Ppebtable\nsource(output(\n\t\tsource_code_key as string,\n\t\tsource_system as string,\n\t\ttarget_code as string,\n\t\ttarget_description as string,\n\t\tcode_type_id as double,\n\t\tcode2 as string,\n\t\tom_x_ref as string,\n\t\tcode_type as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcrossreference\nsource(output(\n\t\taccount_resp_me as string,\n\t\taccount_resp_pi as string,\n\t\taccount_status as string,\n\t\tclient_lost_reason as string,\n\t\tcompany_email as string,\n\t\tcompany_id as double,\n\t\tcompany_name as string,\n\t\tcompany_owner_full_name as string,\n\t\tcompany_owner_id as string,\n\t\tcountry as string,\n\t\tcuo_full_name as string,\n\t\tcuo_user_id as string,\n\t\tdate_inserted as timestamp,\n\t\tdate_updated as timestamp,\n\t\tgard_contact_id as string,\n\t\tmarket_area_code as string,\n\t\tmarket_area_description as string,\n\t\tmarket_area_id as string,\n\t\tparent_company_id as double,\n\t\tparent_company_name as string,\n\t\tparis_gic_id as double,\n\t\tprimary_contact_email as string,\n\t\tprimary_contact_name as string,\n\t\tsf_last_updated_date as timestamp,\n\t\tsource_system as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\trowUrlColumn: 'sf_company',\n\tformat: 'parquet') ~> SrcSfCompany\nsource(output(\n\t\taccounting_month_end_date as timestamp,\n\t\taccounting_month_id as double,\n\t\taccounting_month_key as decimal(38,18),\n\t\taccounting_month_of_quarter as double,\n\t\taccounting_month_of_year as double,\n\t\taccounting_month_start_date as timestamp,\n\t\taccounting_month_time_span as double,\n\t\taccounting_qtr_end_date as timestamp,\n\t\taccounting_qtr_of_year as double,\n\t\taccounting_qtr_start_date as timestamp,\n\t\taccounting_qtr_time_span as double,\n\t\taccounting_quarter_id as double,\n\t\taccounting_quarter_key as decimal(38,18),\n\t\taccounting_year_end_date as timestamp,\n\t\taccounting_year_id as double,\n\t\taccounting_year_key as decimal(38,18),\n\t\taccounting_year_number as double,\n\t\taccounting_year_start_date as timestamp,\n\t\taccounting_year_time_span as double,\n\t\tall_years as string,\n\t\tcalendar_date_id as double,\n\t\tcalendar_date_key as timestamp,\n\t\tday as timestamp,\n\t\tday_name as string,\n\t\tday_of_accounting_month as double,\n\t\tday_of_accounting_quarter as double,\n\t\tday_of_accounting_year as double,\n\t\tday_of_policy_month as double,\n\t\tday_of_policy_quarter as double,\n\t\tday_of_policy_year as double,\n\t\tday_of_underwriting_month as double,\n\t\tday_of_underwriting_quarter as double,\n\t\tday_of_underwriting_year as double,\n\t\tdimension_key as double,\n\t\tpolicy_month_end_date as timestamp,\n\t\tpolicy_month_id as double,\n\t\tpolicy_month_key as decimal(38,18),\n\t\tpolicy_month_name as string,\n\t\tpolicy_month_of_quarter as double,\n\t\tpolicy_month_of_year as double,\n\t\tpolicy_month_start_date as timestamp,\n\t\tpolicy_month_time_span as double,\n\t\tpolicy_qtr_end_date as timestamp,\n\t\tpolicy_qtr_of_year as double,\n\t\tpolicy_qtr_start_date as timestamp,\n\t\tpolicy_qtr_time_span as double,\n\t\tpolicy_quarter_id as double,\n\t\tpolicy_quarter_key as decimal(38,18),\n\t\tpolicy_year_end_date as timestamp,\n\t\tpolicy_year_id as double,\n\t\tpolicy_year_key as decimal(38,18),\n\t\tpolicy_year_number as double,\n\t\tpolicy_year_start_date as timestamp,\n\t\tpolicy_year_time_span as double,\n\t\ttop_id as double,\n\t\ttop_key as decimal(38,18),\n\t\tunderwriting_month_end_date as timestamp,\n\t\tunderwriting_month_id as double,\n\t\tunderwriting_month_key as decimal(38,18),\n\t\tunderwriting_month_of_quarter as double,\n\t\tunderwriting_month_of_year as double,\n\t\tunderwriting_month_start_date as timestamp,\n\t\tunderwriting_month_time_span as double,\n\t\tunderwriting_qtr_end_date as timestamp,\n\t\tunderwriting_qtr_of_year as double,\n\t\tunderwriting_qtr_start_date as timestamp,\n\t\tunderwriting_qtr_time_span as double,\n\t\tunderwriting_quarter_id as double,\n\t\tunderwriting_quarter_key as decimal(38,18),\n\t\tunderwriting_year_end_date as timestamp,\n\t\tunderwriting_year_id as double,\n\t\tunderwriting_year_key as decimal(38,18),\n\t\tunderwriting_year_number as double,\n\t\tunderwriting_year_start_date as timestamp,\n\t\tunderwriting_year_time_span as double\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> DimTime\nPpebtable select(mapColumn(\n\t\tpebpeaid,\n\t\tpebpever,\n\t\tpebisolan\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> pebtableselect\nPpebtable select(mapColumn(\n\t\tpebpeaid,\n\t\tpebpever\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> pebtablemax\npebtablemax aggregate(groupBy(pebpeaid),\n\tpebpever = max(pebpever)) ~> MaxPebver\npebtableselect, MaxPebver join(pebtableselect@pebpeaid == MaxPebver@pebpeaid\n\t&& pebtableselect@pebpever == MaxPebver@pebpever,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> pebisolan\nPagatable select(mapColumn(\n\t\tagaagaid,\n\t\tagaiyear,\n\t\tagaagno,\n\t\tagaagname,\n\t\tagaoffice,\n\t\tagabusndiv,\n\t\tagabusnsec,\n\t\tagabusncla,\n\t\tagasource,\n\t\tagaorgins,\n\t\tagastdate,\n\t\tagaendate,\n\t\tagauwsign,\n\t\tagaausign,\n\t\tagaclmsign,\n\t\tagaisic,\n\t\tagaadjsign,\n\t\tagaeosign,\n\t\tagasitid,\n\t\tagaadjsign,\n\t\tagaintnote,\n\t\tagadatest,\n\t\tagauat,\n\t\tagaordercode\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> agatable\nPagztable select(mapColumn(\n\t\tagzagzid,\n\t\tagzcefoty,\n\t\tagzcurrgrosepi,\n\t\tagzepicurr,\n\t\tagzextadjynsw,\n\t\tagzfagntno,\n\t\tagzgtepi,\n\t\tagznoofobjepi\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> agztable\nagatable, agztable join(agaagaid == agzagzid,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> AgaAgz\nAgaAgz, pebtable join(agasource == pebpeaid,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> AgaPeb\nAgaPeb select(mapColumn(\n\t\tagaagaid,\n\t\tagaiyear,\n\t\tagaagno,\n\t\tagaagname,\n\t\tagaoffice,\n\t\tagabusndiv,\n\t\tagabusnsec,\n\t\tagabusncla,\n\t\tagasource,\n\t\tagaorgins,\n\t\tagastdate,\n\t\tagaendate,\n\t\tagauwsign,\n\t\tagaausign,\n\t\tagaclmsign,\n\t\tagaisic,\n\t\tagaadjsign,\n\t\tagaeosign,\n\t\tagasitid,\n\t\tagaintnote,\n\t\tagadatest,\n\t\tagauat,\n\t\tagzagzid,\n\t\tagzcefoty,\n\t\tagzcurrgrosepi,\n\t\tagzepicurr,\n\t\tagzextadjynsw,\n\t\tagzfagntno,\n\t\tagzgtepi,\n\t\tagznoofobjepi,\n\t\tpebisolan,\n\t\tagaordercode\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> AgaCol\npebisolan select(mapColumn(\n\t\tpebpeaid = pebtableselect@pebpeaid,\n\t\tpebpever = pebtableselect@pebpever,\n\t\tpebisolan\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> pebtable\ntcrossreference filter(source_system=='PARIS' && code_type_id==460) ~> ParisMarketArea\nParisMarketArea select(mapColumn(\n\t\tsource_code_key_market_area = source_code_key,\n\t\ttarget_code_market_area = target_code,\n\t\ttarget_desc_market_area = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefMarketArea\ntcrossreference filter(source_system=='PARIS' && code_type_id==329) ~> ParisEmployee\nParisEmployee select(mapColumn(\n\t\tsource_code_key_def_clm_h = source_code_key,\n\t\ttarget_code_def_clm_h = target_code\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefEmpDefClmHandler\ntcrossreference filter(source_system=='PARIS' && code_type_id==45) ~> ParisVesslType\nParisVesslType select(mapColumn(\n\t\tsource_code_key_vessel_type = source_code_key,\n\t\ttarget_code_vessel_type = target_code,\n\t\ttarget_desc_vessel_type = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefVesselType\ntcrossreference filter(source_system=='PARIS' && code_type_id==806) ~> ParisMarketSegment\nParisMarketSegment select(mapColumn(\n\t\tsource_code_key_MarkSegemnt = source_code_key,\n\t\ttarget_code_MarkSegemnt = target_code,\n\t\ttarget_desc_MarkSegemnt = target_description,\n\t\tcode2_MarkSegemnt = code2\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefMarketSegment\nParisEmployee select(mapColumn(\n\t\tsource_code_defclmadj = source_code_key,\n\t\ttarget_code_defclmadj = target_code\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefEmpDefClmAdjuster\nParisEmployee select(mapColumn(\n\t\tsource_code_key_UW = source_code_key,\n\t\ttarget_code_UW = target_code,\n\t\ttarget_desc_UW = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefEmpUW\nParisEmployee select(mapColumn(\n\t\tsource_code_key_UwResp = source_code_key,\n\t\ttarget_code_UwResp = target_code,\n\t\ttarget_desc_UwResp = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefEmpUwResp\nParisEmployee select(mapColumn(\n\t\tsource_system_uwass = source_code_key,\n\t\ttarget_code_uwass = target_code,\n\t\ttarget_desc_uwass = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefEmpUwAss\ntcrossreference filter(source_system=='PARIS' && code_type_id==813) ~> ParisAgreementTypeDetail\nParisAgreementTypeDetail select(mapColumn(\n\t\tsource_code_key_agt_det = source_code_key,\n\t\ttarge_code_agt_det = target_code,\n\t\ttarget_desc_agt_det = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefAgreementTypeDet\ntcrossreference filter(source_system=='PARIS' && code_type_id==112) ~> ParisOffice\nParisOffice select(mapColumn(\n\t\tsource_code_key_office = source_code_key,\n\t\ttarget_desc_office = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefOffice\ntcrossreference filter(source_system=='PARIS' && code_type_id==809) ~> ParisUwAssistTeam\nParisUwAssistTeam select(mapColumn(\n\t\tsource_code_key_uwassteam = source_code_key,\n\t\ttarget_code_uwassteam = target_code,\n\t\ttarget_desc_uwassteam = target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> XrefUwAssistTeam\nAgaCol derive(broker_id = case(agabusncla==8, iifNull(agzfagntno,case(agasource==agaorgins, toDecimal(null()), agasource)), case(agasource==agaorgins, toDecimal(null()), agasource)),\n\t\tagaoffice_string = toString(agaoffice,'##########0')) ~> AgaBroker\nSrcSfCompany filter(source_system=='Paris') ~> ParisCompany\nParisCompany select(mapColumn(\n\t\tsf_company_id_broker = company_id,\n\t\tsf_company_name_broker = company_name,\n\t\tsf_paris_gic_id_broker = paris_gic_id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SfCompanyBroker\nParisCompany select(mapColumn(\n\t\tsf_client_lost_reason = client_lost_reason,\n\t\tsf_company_id_client = company_id,\n\t\tsf_company_name_client = company_name,\n\t\tsf_company_owner_full_name = company_owner_full_name,\n\t\tsf_market_area_code = market_area_code,\n\t\tsf_market_area_description = market_area_description,\n\t\tsf_source_system_id = paris_gic_id,\n\t\tsf_source_system = source_system,\n\t\tsf_company\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SfCompanyClient\nAgaBroker, XrefOffice join(toString(agaoffice,'########0') == source_code_key_office,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinOffice\nJoinOffice, XrefAgreementTypeDet join(toString(agabusncla,'#########0') == source_code_key_agt_det,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinAgreementTypeDet\nJoinAgreementTypeDet, XrefUwAssistTeam join(agauat == source_code_key_uwassteam,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinUwAssistTeam\nJoinUwAssistTeam, XrefEmpUwAss join(agaausign == source_system_uwass,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinUwAssist\nJoinUwAssist, XrefEmpUW join(agauwsign == source_code_key_UW,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinUw\nJoinUw, XrefEmpUwResp join(agaeosign == source_code_key_UwResp,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinUwResp\nJoinUwResp, XrefEmpDefClmAdjuster join(agaadjsign == source_code_defclmadj,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinDefClmAdj\nJoinUwYear, SfCompanyClient join(agaorgins == sf_source_system_id,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinSfClient\nJoinSfClient, SfCompanyBroker join(agasource == sf_paris_gic_id_broker,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinSfBroker\nJoinDefClmHandl, XrefMarketArea join(agasitid == source_code_key_market_area,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinMarketArea\nJoinMarketArea, XrefMarketSegment join(pebisolan == source_code_key_MarkSegemnt,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinMarketSegment\nJoinMarketSegment, XrefVesselType join(agzcefoty == source_code_key_vessel_type,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinVesselType\nDimTime select(mapColumn(\n\t\tday,\n\t\tunderwriting_year_number,\n\t\tunderwriting_year_start_date,\n\t\tunderwriting_year_end_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> UwYear\nJoinVesselType, UwYear join(agastdate == day,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinUwYear\nAgtUwYrMarket derive(agreement_reference = concat(toString(agaiyear,'0000'), Agreement_type , lpad(toString(agaagno,'#####0'),6,'0')),\n\t\tna_desc = 'Not Applicable',\n\t\tna_id = 1,\n\t\tna_code = 'N') ~> AgreementRef\nJoinSfBroker derive(Agreement_type = case(agabusndiv==1, 'M', case(agabusndiv==2, 'E', case(agabusndiv==3, 'B', 'P'))),\n\t\tagr_uw_year = case(agabusnsec==91, toString(agaiyear,'0000'), toString(underwriting_year_number,'0000')),\n\t\tagr_uw_year_numeric = case(agabusnsec==91, agaiyear, toDecimal(underwriting_year_number,4,0)),\n\t\tagr_uw_year_days = toDecimal(underwriting_year_end_date - underwriting_year_start_date,3,0) + 1,\n\t\tagr_market_segment_code = case(target_code_market_area=='OWN', 'OWN', \r\ncase( in(['N/A','NA'],iifNull(target_code_market_area,'N/A')), 'NA', 'SPEC')),\n\t\tagr_market_segment = case(target_code_market_area=='OWN', 'Shipowners', \r\ncase( in(['N/A','NA'],iifNull(target_code_market_area,'N/A')), 'Not Assigned', 'Specialty')),\n\t\tagr_market_segment_split_code = target_code_market_area,\n\t\tagr_market_segment_split = target_desc_market_area,\n\t\tagr_market_area_code = case(target_code_market_area == 'OWN', target_code_MarkSegemnt, target_code_market_area),\n\t\tagr_market_area = case(target_code_market_area == 'OWN', target_desc_MarkSegemnt, target_desc_market_area),\n\t\tagr_market_area_sort = case(target_code_market_area == 'OWN', code2_MarkSegemnt, \r\nconcat('Z',target_desc_market_area)),\n\t\tagr_sf_key = concat(sf_source_system,toString(sf_source_system_id))) ~> AgtUwYrMarket\nJoinDefClmAdj, XrefEmpDefClmHandler join(agaclmsign == source_code_key_def_clm_h,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinDefClmHandl\nAgreementRef select(mapColumn(\n\t\tpk_key = agaagaid,\n\t\tagr_date_start = agastdate,\n\t\tagr_date_end = agaendate,\n\t\tagr_uw_year,\n\t\tagr_reference = agreement_reference,\n\t\tagr_office = target_desc_office,\n\t\tagr_uw_code = target_code_UW,\n\t\tagr_uw_description = target_desc_UW,\n\t\tagr_agreement_name = agaagname,\n\t\tagr_market_area_code,\n\t\tagr_market_area_desc = agr_market_area,\n\t\tagr_member_number = agaorgins,\n\t\tagr_sf_market_area_code = sf_market_area_code,\n\t\tagr_sf_market_area_desc = sf_market_area_description,\n\t\tagr_sf_company_id = sf_company_id_client,\n\t\tagr_sf_key,\n\t\tagr_sf_client_lost_reason = sf_client_lost_reason,\n\t\tagr_sf_company_name_client = sf_company_name_client,\n\t\tagr_sf_company_owner = sf_company_owner_full_name,\n\t\tagr_sf_company_name_broker = sf_company_name_broker,\n\t\tagr_sf_top_group_client = na_desc,\n\t\tagr_sf_top_group_client_id = na_id,\n\t\tagr_sf_company_broker_id = sf_company_id_broker,\n\t\tagr_sf_top_group_broker = na_desc,\n\t\tagr_sf_top_group_broker_id = na_id,\n\t\tagr_def_clhndl_dry_cargo_pri = na_desc,\n\t\tagr_def_clhndl_pi_crew_pri = na_desc,\n\t\tagr_def_clhandl_casualty_pri = na_desc,\n\t\tagr_def_clhandl_defence_pri = na_desc,\n\t\tagr_def_clhandl_liquid_ca_pri = na_desc,\n\t\tagr_def_clhandl_environm_pri = na_desc,\n\t\tagr_def_clhndl_dry_cargo_sec = na_desc,\n\t\tagr_def_clhndl_pi_crew_sec = na_desc,\n\t\tagr_def_clhandl_casualty_sec = na_desc,\n\t\tagr_def_clhandl_defence_sec = na_desc,\n\t\tagr_def_clhandl_liquid_ca_sec = na_desc,\n\t\tagr_def_clhandl_environm_sec = na_desc,\n\t\tagr_dev_claims_handler_paris = target_code_def_clm_h,\n\t\tagr_uw_assist_code = target_code_uwass,\n\t\tagr_uw_assist_description = target_desc_uwass,\n\t\tagr_club_retention = na_id,\n\t\tcharterers_trad_clm_team_ind = na_code,\n\t\tagr_def_claim_adjuster = target_code_defclmadj,\n\t\tagr_dummy_ind = na_code,\n\t\tagr_club_retention_stat = na_id,\n\t\tagr_abatement_usd = na_id,\n\t\tagr_abatement_stat = na_id,\n\t\tagr_uw_year_days,\n\t\tagr_resp_uw_code = target_code_UwResp,\n\t\tagr_resp_uw_desc = target_desc_UwResp,\n\t\tagr_ext_adjuster_ind = agzextadjynsw,\n\t\tagr_order_code = agaordercode,\n\t\tagr_internal_note = againtnote,\n\t\tagr_date_established = agadatest,\n\t\tagr_market_segm_cnt_grp_code = target_code_MarkSegemnt,\n\t\tagr_market_segm_country_group = target_desc_MarkSegemnt,\n\t\tagr_market_segm_cnt_grp_sort = code2_MarkSegemnt,\n\t\tagr_market_segment_code,\n\t\tagr_market_segment,\n\t\tagr_market_segment_split_code,\n\t\tagr_market_segment_split,\n\t\tagr_market_area_sort,\n\t\tagr_uw_assist_team_code = target_code_uwassteam,\n\t\tagr_uw_assist_team_desc = target_desc_uwassteam,\n\t\tagr_agreement_type_detail_code = targe_code_agt_det,\n\t\tagr_agreement_type_detail_desc = target_desc_agt_det,\n\t\tagr_est_total_gross_ton = agzgtepi,\n\t\tagr_main_vessel_type_code = target_code_vessel_type,\n\t\tagr_main_vessel_type_desc = target_desc_vessel_type,\n\t\tagr_est_premium_currency_code = agzepicurr,\n\t\tagr_est_premium_org = agzcurrgrosepi\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_agreement.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> PreDimAgreement"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_agreement_type')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcrossreference"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_agreement_type",
								"type": "DatasetReference"
							},
							"name": "preDimAgreementType"
						}
					],
					"transformations": [
						{
							"name": "agreementtype"
						},
						{
							"name": "deduplicator"
						},
						{
							"name": "renameOutputColumn"
						},
						{
							"name": "addLastUpdatedBy"
						},
						{
							"name": "alterrow"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcrossreference\ntcrossreference filter(CODE_TYPE_ID == 113) ~> agreementtype\nagreementtype aggregate(groupBy(TARGET_DESCRIPTION),\n\tTARGET_CODE = first(TARGET_CODE)) ~> deduplicator\ndeduplicator select(mapColumn(\n\t\tagt_description = TARGET_DESCRIPTION,\n\t\tagt_key = TARGET_CODE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> renameOutputColumn\nrenameOutputColumn derive(last_updated_by = 'pre_dim_agreement_type') ~> addLastUpdatedBy\naddLastUpdatedBy alterRow(upsertIf(!isNull(agt_key))) ~> alterrow\nalterrow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_agreement_type.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimAgreementType"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_business_area')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcrossreference"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_business_area",
								"type": "DatasetReference"
							},
							"name": "preDimBusinessArea"
						}
					],
					"transformations": [
						{
							"name": "businessarea"
						},
						{
							"name": "deduplicator"
						},
						{
							"name": "expression"
						},
						{
							"name": "xrefBusarea"
						},
						{
							"name": "predimbusareatable"
						},
						{
							"name": "alterrow"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcrossreference\ntcrossreference filter(CODE_TYPE_ID==106 && TARGET_CODE!='PI') ~> businessarea\nxrefBusarea aggregate(groupBy(bus_description),\n\tbus_key = first(bus_key)) ~> deduplicator\ndeduplicator derive(grp_key = case(in(['EN','BU'],bus_key), 'EG', case(in(['PM', 'PF'], bus_key), 'PI', bus_key)),\n\t\tgrp_description = case(in(['EN','BU'],bus_key), 'Energy+', case(in(['PM', 'PF'], bus_key), 'P&I', bus_description)),\n\t\tbua_key = case(in(['PM','PF'],bus_key), 'PI', bus_key),\n\t\tbua_description = case(in(['PM','PF'],bus_key), 'P&I', bus_description),\n\t\tlast_updated_by = 'm_pre_dim_business_area') ~> expression\nbusinessarea select(mapColumn(\n\t\tbus_key = TARGET_CODE,\n\t\tbus_description = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xrefBusarea\nexpression select(mapColumn(\n\t\tbus_description,\n\t\tbus_key,\n\t\tgrp_key,\n\t\tgrp_description,\n\t\tbua_key,\n\t\tbua_description,\n\t\tlast_updated_by\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> predimbusareatable\npredimbusareatable alterRow(upsertIf(!isNull(bus_key))) ~> alterrow\nalterrow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_business_area.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimBusinessArea"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_claim_detail_pa')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Pre DIM claim detail from Paris ",
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcrossreference"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_claim_detail_pa",
								"type": "DatasetReference"
							},
							"name": "preDimClaimPA"
						}
					],
					"transformations": [
						{
							"name": "parisClaimDetail"
						},
						{
							"name": "deduplicator"
						},
						{
							"name": "xrefcld"
						},
						{
							"name": "alterRow"
						},
						{
							"name": "lastupdatedby"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcrossreference\ntcrossreference filter(SOURCE_SYSTEM=='PARIS' && CODE_TYPE_ID==775) ~> parisClaimDetail\nxrefcld aggregate(groupBy(cld_description),\n\tcld_key = first(cld_key)) ~> deduplicator\nparisClaimDetail select(mapColumn(\n\t\tcld_key = TARGET_CODE,\n\t\tcld_description = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xrefcld\nlastupdatedby alterRow(upsertIf(!isNull(cld_key))) ~> alterRow\ndeduplicator derive(last_updated_by = 'pre_dim_claim_detail') ~> lastupdatedby\nalterRow sink(input(\n\t\tagt_description as string,\n\t\tagt_key as string,\n\t\tlast_updated_by as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_claim_detail_pa.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimClaimPA"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_country')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "vcrossreference"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_country",
								"type": "DatasetReference"
							},
							"name": "preDimCountry"
						}
					],
					"transformations": [
						{
							"name": "country50"
						},
						{
							"name": "area219"
						},
						{
							"name": "regionA374"
						},
						{
							"name": "region367"
						},
						{
							"name": "region219"
						},
						{
							"name": "join1xRefCountryRegion"
						},
						{
							"name": "xRefCountry50"
						},
						{
							"name": "xRefRegion219"
						},
						{
							"name": "xRefArea219"
						},
						{
							"name": "Join1"
						},
						{
							"name": "area3"
						},
						{
							"name": "JoinxRefCountryRegionA"
						},
						{
							"name": "xRefRegionA374"
						},
						{
							"name": "JoinxRefCountryRegionARegion"
						},
						{
							"name": "xRefRegion367"
						},
						{
							"name": "Join0"
						},
						{
							"name": "area2"
						},
						{
							"name": "JoinCountryRegion"
						},
						{
							"name": "JoinArea"
						},
						{
							"name": "area1"
						},
						{
							"name": "setOperation"
						},
						{
							"name": "deduplicator"
						},
						{
							"name": "expression"
						},
						{
							"name": "alterRow"
						},
						{
							"name": "predimcountrytable"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tPARENT_CODE_TYPE_ID as double,\n\t\tPARENT_TARGET_CODE as string,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> vcrossreference\nvcrossreference filter(CODE_TYPE_ID==50) ~> country50\nvcrossreference filter(CODE_TYPE_ID==219) ~> area219\nvcrossreference filter(CODE_TYPE_ID==374) ~> regionA374\nvcrossreference filter(CODE_TYPE_ID==367) ~> region367\nvcrossreference filter(CODE_TYPE_ID==219) ~> region219\nxRefCountry50, xRefRegion219 join(country_parent_target_code == region_target_code\n\t&& country_parent_code_type_id == region_code_type_id,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> join1xRefCountryRegion\ncountry50 select(mapColumn(\n\t\tcountry_source_code_key = SOURCE_CODE_KEY,\n\t\tcountry_source_system = SOURCE_SYSTEM,\n\t\tcountry_target_code = TARGET_CODE,\n\t\tcountry_target_description = TARGET_DESCRIPTION,\n\t\tcountry_code_type = CODE_TYPE,\n\t\tcountry_code_type_id = CODE_TYPE_ID,\n\t\tcountry_parent_code_type_id = PARENT_CODE_TYPE_ID,\n\t\tcountry_parent_target_code = PARENT_TARGET_CODE,\n\t\tcountry_code2 = CODE2,\n\t\tcountry_om_x_ref = OM_X_REF\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefCountry50\nregion219 select(mapColumn(\n\t\tregion_source_code_key = SOURCE_CODE_KEY,\n\t\tregion_source_system = SOURCE_SYSTEM,\n\t\tregion_target_code = TARGET_CODE,\n\t\tregion_target_description = TARGET_DESCRIPTION,\n\t\tregion_code_type = CODE_TYPE,\n\t\tregion_code_type_id = CODE_TYPE_ID,\n\t\tregion_parent_code_type_id = PARENT_CODE_TYPE_ID,\n\t\tregion_parent_target_code = PARENT_TARGET_CODE,\n\t\tregion_code2 = CODE2,\n\t\tregion_om_x_ref = OM_X_REF\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefRegion219\narea219 select(mapColumn(\n\t\tarea_source_code_key = SOURCE_CODE_KEY,\n\t\tarea_source_system = SOURCE_SYSTEM,\n\t\tarea_target_code = TARGET_CODE,\n\t\tarea_target_description = TARGET_DESCRIPTION,\n\t\tarea_code_type = CODE_TYPE,\n\t\tarea_code_type_id = CODE_TYPE_ID,\n\t\tarea_parent_code_type_id = PARENT_CODE_TYPE_ID,\n\t\tarea_parent_target_code = PARENT_TARGET_CODE,\n\t\tarea_code2 = CODE2,\n\t\tarea_om_x_ref = OM_X_REF\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefArea219\njoin1xRefCountryRegion, xRefArea219 join(country_parent_target_code == area_target_code\n\t&& country_parent_code_type_id == area_code_type_id,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> Join1\nJoin1 select(mapColumn(\n\t\tcountry_target_code,\n\t\tcountry_target_description,\n\t\tcountry_code2,\n\t\tcountry_om_x_ref,\n\t\tregion_target_code,\n\t\tregion_target_description,\n\t\tarea_target_code,\n\t\tarea_target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> area3\nxRefCountry50, xRefRegionA374 join(country_parent_code_type_id == region_A_code_type_id\n\t&& country_parent_target_code == region_A_target_code,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinxRefCountryRegionA\nregionA374 select(mapColumn(\n\t\tregion_A_source_code_key = SOURCE_CODE_KEY,\n\t\tregion_A_source_system = SOURCE_SYSTEM,\n\t\tregion_A_target_code = TARGET_CODE,\n\t\tregion_A_target_description = TARGET_DESCRIPTION,\n\t\tregion_A_code_type = CODE_TYPE,\n\t\tregion_A_code_type_id = CODE_TYPE_ID,\n\t\tregion_A_parent_code_type_id = PARENT_CODE_TYPE_ID,\n\t\tregion_A_parent_target_code = PARENT_TARGET_CODE,\n\t\tregion_A_code2 = CODE2,\n\t\tregion_A_om_x_ref = OM_X_REF\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefRegionA374\nJoinxRefCountryRegionA, xRefRegion367 join(region_A_parent_code_type_id == region_code_type_id\n\t&& region_A_parent_target_code == region_target_code,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinxRefCountryRegionARegion\nregion367 select(mapColumn(\n\t\tregion_source_code_key = SOURCE_CODE_KEY,\n\t\tregion_source_system = SOURCE_SYSTEM,\n\t\tregion_target_code = TARGET_CODE,\n\t\tregion_target_description = TARGET_DESCRIPTION,\n\t\tregion_code_type = CODE_TYPE,\n\t\tregion_code_type_id = CODE_TYPE_ID,\n\t\tregion_parent_code_type_id = PARENT_CODE_TYPE_ID,\n\t\tregion_parent_target_code = PARENT_TARGET_CODE,\n\t\tregion_code2 = CODE2,\n\t\tregion_om_x_ref = OM_X_REF\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefRegion367\nJoinxRefCountryRegionARegion, xRefArea219 join(region_parent_code_type_id == area_code_type_id\n\t&& region_parent_target_code == area_target_code,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> Join0\nJoin0 select(mapColumn(\n\t\tcountry_target_code,\n\t\tcountry_target_description,\n\t\tcountry_code2,\n\t\tcountry_om_x_ref,\n\t\tregion_target_code,\n\t\tregion_target_description,\n\t\tarea_target_code,\n\t\tarea_target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> area2\nxRefCountry50, xRefRegion367 join(country_parent_code_type_id == region_code_type_id\n\t&& country_parent_target_code == region_target_code,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinCountryRegion\nJoinCountryRegion, xRefArea219 join(region_parent_code_type_id == area_code_type_id\n\t&& region_parent_target_code == area_target_code,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinArea\nJoinArea select(mapColumn(\n\t\tcountry_target_code,\n\t\tcountry_target_description,\n\t\tcountry_code2,\n\t\tcountry_om_x_ref,\n\t\tregion_target_code,\n\t\tregion_target_description,\n\t\tarea_target_code,\n\t\tarea_target_description\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> area1\narea1, area2, area3 union(byName: true)~> setOperation\nsetOperation aggregate(groupBy(country_target_description,\n\t\tcountry_code2,\n\t\tcountry_om_x_ref,\n\t\tregion_target_code,\n\t\tregion_target_description,\n\t\tarea_target_code,\n\t\tarea_target_description),\n\tcountry_target_code = first(country_target_code)) ~> deduplicator\ndeduplicator derive(ar2_target_code = case\n(\n    compare(area_target_code,'AME')==0, area_target_code, \n    (\n        case\n        (\n            compare(area_target_code,'ASI')==0, area_target_code, \n            (\n                case\n                    (\n                        compare(area_target_code,'EUR')==0, \n                        \n                            case\n                                (\n                                    compare(region_target_code,'SCA')==0, region_target_code, area_target_code \n                                ), \n                                case\n                                    (\n                                        compare(area_target_code,'RUS')==0, 'EUR', 'OTH'\n                                    ) \n                        \n                    )\n            )\n        )\n    )\n),\n\t\tar2_target_description = case\n(\n    compare(area_target_code,'AME')==0, area_target_description, \n    (\n        case\n        (\n            compare(area_target_code,'ASI')==0, area_target_description, \n            (\n                case\n                    (\n                        compare(area_target_code,'EUR')==0, \n                        \n                            case\n                                (\n                                    compare(region_target_code,'SCA')==0, region_target_description, area_target_description \n                                ), \n                                case\n                                    (\n                                        compare(area_target_code,'RUS')==0, 'Europe', 'Other'\n                                    ) \n                        \n                    )\n            )\n        )\n    )\n),\n\t\tlast_updated_by = 'm_pre_dim_country',\n\t\tcon_2ltr_code = '',\n\t\tcon_country_name = '',\n\t\tcon_oecd = '',\n\t\tcon_currency_code = '',\n\t\tcon_eu = '') ~> expression\npredimcountrytable alterRow(upsertIf(!isNull(pk_key))) ~> alterRow\nexpression select(mapColumn(\n\t\tpk_key = country_target_code,\n\t\treg_code = region_target_code,\n\t\treg_description = region_target_description,\n\t\tar1_code = area_target_code,\n\t\tar1_description = area_target_description,\n\t\tar2_code = ar2_target_code,\n\t\tar2_description = ar2_target_description,\n\t\tlast_updated_by,\n\t\tcon_2ltr_code,\n\t\tcon_country_name,\n\t\tcon_oecd,\n\t\tcon_currency_code,\n\t\tcon_eu\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> predimcountrytable\nalterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_country.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimCountry"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_coverage')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "TCrossReference"
						},
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "CoverageGroup"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_coverage",
								"type": "DatasetReference"
							},
							"name": "preDimCoverageInsert"
						}
					],
					"transformations": [
						{
							"name": "FilterProdGroups",
							"description": "Filtering rows on 'CODE_TYPE_ID' =-3"
						},
						{
							"name": "filterCoverageCodes",
							"description": "Filtering rows on 'CODE_TYPE_ID' = 122 (Coverage code)"
						},
						{
							"name": "xRefCoverage",
							"description": "Removing unused columns"
						},
						{
							"name": "xRefprodGroups",
							"description": "Removing unused columns"
						},
						{
							"name": "CoverageCodeProdGroup"
						},
						{
							"name": "Deduplicate"
						},
						{
							"name": "DerviveProdGroupProdDesc",
							"description": "Creating prd product_group and pruduct_desc"
						},
						{
							"name": "LookupCoverageGroup"
						},
						{
							"name": "SelectOutputColumns"
						},
						{
							"name": "LastUpdatedBy",
							"description": "Creating constant 'lastUpdatedBy'"
						},
						{
							"name": "AlterRow"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> TCrossReference\nsource(output(\n\t\tcoverage_code as string,\n\t\tcoverage_desc as string,\n\t\tdate_inserted as timestamp,\n\t\tdate_updated as timestamp,\n\t\tenergy_exp_group_code as string,\n\t\tenergy_exp_group_desc as string,\n\t\texposure_group_code as string,\n\t\texposure_group_desc as string,\n\t\tgic_group_code as string,\n\t\tgic_group_desc as string,\n\t\tinserted_by as string,\n\t\tlayer_group_code as string,\n\t\tlayer_group_descr as string,\n\t\tpk_coverage_group as double,\n\t\tsort_order as double,\n\t\tupdated_by as string,\n\t\twar_indicator as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> CoverageGroup\nTCrossReference filter(CODE_TYPE_ID == -3) ~> FilterProdGroups\nTCrossReference filter(CODE_TYPE_ID == 122) ~> filterCoverageCodes\nfilterCoverageCodes select(mapColumn(\n\t\tcoverage_source_code = SOURCE_CODE_KEY,\n\t\tsource_system = SOURCE_SYSTEM,\n\t\tcoverage_target_code = TARGET_CODE,\n\t\tcoverage_target_desc = TARGET_DESCRIPTION,\n\t\tcode_type = CODE_TYPE,\n\t\tcode_type_id = CODE_TYPE_ID,\n\t\tcode2 = CODE2\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefCoverage\nFilterProdGroups select(mapColumn(\n\t\tcoverage_source_code = SOURCE_CODE_KEY,\n\t\tprd_group_target_code = TARGET_CODE,\n\t\tsource_system = SOURCE_SYSTEM,\n\t\tprd_group_target_desc = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xRefprodGroups\nxRefCoverage, xRefprodGroups join(xRefCoverage@coverage_source_code == xRefprodGroups@coverage_source_code\n\t&& xRefCoverage@source_system == xRefprodGroups@source_system,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> CoverageCodeProdGroup\nDerviveProdGroupProdDesc aggregate(groupBy(coverage_target_code,\n\t\tproduct_group,\n\t\tproduct_descr,\n\t\tcode2),\n\tcoverage_target_desc = first(coverage_target_desc)) ~> Deduplicate\nCoverageCodeProdGroup derive(product_group = coalesce(prd_group_target_code,'N/A'),\n\t\tproduct_descr = coalesce(prd_group_target_desc, 'Not Applicable')) ~> DerviveProdGroupProdDesc\nDeduplicate, CoverageGroup lookup(coverage_target_code == coverage_code,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupCoverageGroup\nLastUpdatedBy select(mapColumn(\n\t\tpk_key = coverage_target_code,\n\t\tcov_description = coverage_target_desc,\n\t\tcov_exposure_group_code = exposure_group_code,\n\t\tcov_exposure_group_desc = exposure_group_desc,\n\t\tgrp_key = product_group,\n\t\tgrp_description = product_descr,\n\t\tcov_energy_exp_group_code = energy_exp_group_code,\n\t\tcov_energy_exp_group_desc = energy_exp_group_desc,\n\t\tcov_layer_group_code = layer_group_code,\n\t\tcov_layer_group_descr = layer_group_descr,\n\t\tcov_gic_group_code = gic_group_code,\n\t\tcov_gic_group_desc = gic_group_desc,\n\t\tcov_3ltr_code = code2,\n\t\tlast_updated_by\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectOutputColumns\nLookupCoverageGroup derive(last_updated_by = 'm_pre_dim_coverage') ~> LastUpdatedBy\nSelectOutputColumns alterRow(upsertIf(!isNull(pk_key))) ~> AlterRow\nAlterRow sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_coverage.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimCoverageInsert"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_currency')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "HlpExchangeRateToUsd"
						},
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tCrossReference"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_currency",
								"type": "DatasetReference"
							},
							"name": "preDimCurrency"
						}
					],
					"transformations": [
						{
							"name": "FilterDates",
							"description": "Filtering rows on 'EXCHANGE_FROM_DATE' <= currentTimestamp"
						},
						{
							"name": "exchrateToUSD",
							"description": "Removing and renaming of columns"
						},
						{
							"name": "SelectExhangeRate",
							"description": "Removing unused columns"
						},
						{
							"name": "NewestExchangeDates",
							"description": "Get newest ExchangeFromDate for each currency"
						},
						{
							"name": "JoinNewestDateWithRate",
							"description": "Inner join to get newest exchange rate for each currency"
						},
						{
							"name": "LastKnownRate",
							"description": "Creating/updating columns"
						},
						{
							"name": "RemoveUnusedColumns"
						},
						{
							"name": "Deduplicate"
						},
						{
							"name": "RemoveExtraColumn",
							"description": "Remove duplicated column"
						},
						{
							"name": "Expression",
							"description": "Case currency from is USD, rate equals 1.\nAdd last_updated_by column"
						},
						{
							"name": "LookupAllCurrencies"
						},
						{
							"name": "SelectOutputColums",
							"description": "Selecting and renaming relevant columns"
						},
						{
							"name": "ReplaceNull",
							"description": "Replacing null values with N/A"
						},
						{
							"name": "AlterRow",
							"description": "Upsert if not null"
						},
						{
							"name": "xrefCurrency"
						}
					],
					"script": "source(output(\n\t\tFROM_CURRENCY_ID as double,\n\t\tTO_CURRENCY_ID as double,\n\t\tEXCHANGE_FROM_DATE as timestamp,\n\t\tEXCHANGE_RATE as decimal(38,18),\n\t\tEXCHANGE_TO_DATE as timestamp,\n\t\tFROM_CURRENCY_CODE as string,\n\t\tTO_CURRENCY_CODE as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> HlpExchangeRateToUsd\nsource(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tCrossReference\nexchrateToUSD filter(exchange_from_date <= currentTimestamp()) ~> FilterDates\nHlpExchangeRateToUsd select(mapColumn(\n\t\texchange_from_date = EXCHANGE_FROM_DATE,\n\t\texchange_rate = EXCHANGE_RATE,\n\t\tfrom_currency_code = FROM_CURRENCY_CODE,\n\t\tto_currency_code = TO_CURRENCY_CODE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> exchrateToUSD\nexchrateToUSD select(mapColumn(\n\t\texchange_rate,\n\t\tfrom_currency_code,\n\t\texchange_from_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectExhangeRate\nFilterDates aggregate(groupBy(from_currency_code),\n\tEXCHANGE_FROM_DATE = max(exchange_from_date)) ~> NewestExchangeDates\nNewestExchangeDates, SelectExhangeRate join(NewestExchangeDates@from_currency_code == SelectExhangeRate@from_currency_code\n\t&& NewestExchangeDates@EXCHANGE_FROM_DATE == SelectExhangeRate@exchange_from_date,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> JoinNewestDateWithRate\nRemoveExtraColumn derive(exchange_rate = case(exchange_rate==0, toDecimal(null()),toDecimal(exchange_rate))) ~> LastKnownRate\nxrefCurrency select(mapColumn(\n\t\ttarget_code = TARGET_CODE,\n\t\ttarget_description = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveUnusedColumns\nRemoveUnusedColumns aggregate(groupBy(target_code),\n\ttarget_description = first(target_description)) ~> Deduplicate\nJoinNewestDateWithRate select(mapColumn(\n\t\tfrom_currency_code = NewestExchangeDates@from_currency_code,\n\t\texchange_rate,\n\t\tfrom_currency_code = SelectExhangeRate@from_currency_code,\n\t\texchange_from_date = SelectExhangeRate@exchange_from_date\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveExtraColumn\nReplaceNull derive(curr_last_exchange_rate_to_usd = case(from_currency_code=='USD', toDecimal(1), exchange_rate),\n\t\tlast_updated_by = 'm_pre_dim_currency') ~> Expression\nDeduplicate, LastKnownRate lookup(target_code == from_currency_code,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LookupAllCurrencies\nExpression select(mapColumn(\n\t\tpk_key = target_code,\n\t\tcur_description = target_description,\n\t\tcurr_last_exchange_rate_to_usd,\n\t\tlast_updated_by\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectOutputColums\nLookupAllCurrencies derive(from_currency_code = case(isNull(from_currency_code),'N/A',from_currency_code)) ~> ReplaceNull\nSelectOutputColums alterRow(upsertIf(!isNull(pk_key))) ~> AlterRow\ntCrossReference filter(CODE_TYPE_ID == 124) ~> xrefCurrency\nAlterRow sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_currency.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimCurrency"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_employee')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcrossreference"
						},
						{
							"dataset": {
								"referenceName": "Agresso",
								"type": "DatasetReference"
							},
							"name": "udvAgressoEmployee"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_employee",
								"type": "DatasetReference"
							},
							"name": "preDimEmployee"
						}
					],
					"transformations": [
						{
							"name": "employee"
						},
						{
							"name": "deduplicator"
						},
						{
							"name": "xrefEmployee"
						},
						{
							"name": "empname"
						},
						{
							"name": "LkpUdvAgsEmployee"
						},
						{
							"name": "deduplicator0"
						},
						{
							"name": "alterRow"
						},
						{
							"name": "addLastupdatedby"
						},
						{
							"name": "predimemployeetable"
						},
						{
							"name": "emp1Pos1"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcrossreference\nsource(output(\n\t\tEMPLOYEE_ID as string,\n\t\tCOMPANY as string,\n\t\tCOMPANY_NAME as string,\n\t\tMAIN_EMPLOYER as decimal(38,18),\n\t\tCONTRACT_TYPE as string,\n\t\tCONTRACT_DESCRIPTION as string,\n\t\tFIRST_NAME as string,\n\t\tLAST_NAME as string,\n\t\tAD_NAME as string,\n\t\tJOBPHONE as string,\n\t\tSHORTPHONE as string,\n\t\tJOBMOBILE as string,\n\t\tEMAIL as string,\n\t\tCOSTCENTER as string,\n\t\tCOSTCENTER_DATE_FROM as timestamp,\n\t\tCOSTCENTER_DATE_TO as timestamp,\n\t\tCOSTCENTER_DESCRIPTION as string,\n\t\tCOSTCENTER_MANAGER as string,\n\t\tHR_MANAGER as string,\n\t\tLAST_UPDATE as timestamp,\n\t\tPOSITION as string,\n\t\tMAIN_POSITION as decimal(38,18),\n\t\tPOSITION_TITLE as string,\n\t\tPOSTIION_DATE_FROM as timestamp,\n\t\tPOSITION_DATE_TO as timestamp,\n\t\tSENIORITY as string,\n\t\tSENIORITY_TITLE as string,\n\t\tDISPLAY_NAME as string,\n\t\tOFFICE as string,\n\t\tSTATUS as string,\n\t\tSTATUS_DESCRIPTION as string,\n\t\tCONTRACT_DATE_FROM as timestamp,\n\t\tCONTRACT_DATE_TO as timestamp,\n\t\tSTATUS_DATE_FROM as timestamp,\n\t\tSTATUS_DATE_TO as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\twildcardPaths:['Agresso/s_udv_ags_employee.parquet']) ~> udvAgressoEmployee\ntcrossreference filter(CODE_TYPE_ID == 329) ~> employee\nxrefEmployee aggregate(groupBy(target_description_employee),\n\ttarget_code_employee = first(target_code_employee)) ~> deduplicator\nemployee select(mapColumn(\n\t\teach(match(name=='TARGET_CODE'||name=='TARGET_DESCRIPTION'),\n\t\t\tlower($$)+'_employee' = $$)\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xrefEmployee\nLkpUdvAgsEmployee derive(emp_name = substring(target_description_employee, 1, 40)) ~> empname\ndeduplicator, emp1Pos1 lookup(target_code_employee == AD_NAME,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> LkpUdvAgsEmployee\nempname aggregate(groupBy(EMPLOYEE_ID,\n\t\tFIRST_NAME,\n\t\tLAST_NAME,\n\t\tJOBMOBILE,\n\t\tEMAIL,\n\t\tOFFICE,\n\t\temp_name,\n\t\tJOBPHONE),\n\ttarget_code_employee = first(target_code_employee)) ~> deduplicator0\npredimemployeetable alterRow(upsertIf(!isNull(emp_source_key))) ~> alterRow\ndeduplicator0 derive(last_updated_by = 'pre_dim_employee',\n\t\tincident_team_code = '',\n\t\tincident_team_desc = '') ~> addLastupdatedby\naddLastupdatedby select(mapColumn(\n\t\temp_source_key = target_code_employee,\n\t\tagresso_emp_id = EMPLOYEE_ID,\n\t\temp_first_name = FIRST_NAME,\n\t\temp_last_name = LAST_NAME,\n\t\temp_job_mobile = JOBMOBILE,\n\t\temp_job_email = EMAIL,\n\t\tmain_gard_office_location = OFFICE,\n\t\temp_name,\n\t\tlast_updated_by,\n\t\tincident_team_code,\n\t\tincident_team_desc,\n\t\temp_job_phone = JOBPHONE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> predimemployeetable\nudvAgressoEmployee filter(MAIN_EMPLOYER == 1 && MAIN_POSITION == 1 && POSTIION_DATE_FROM <= fromUTC(currentTimestamp(), 'CET')) ~> emp1Pos1\nalterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_employee.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimEmployee"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_guarantee_pa')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "pea"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "lga"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_guarantee_pa",
								"type": "DatasetReference"
							},
							"name": "PreDimGuarantee"
						}
					],
					"transformations": [
						{
							"name": "PeaTable"
						},
						{
							"name": "LgaTable"
						},
						{
							"name": "PeaLga"
						},
						{
							"name": "expression"
						},
						{
							"name": "SelectedColumns"
						}
					],
					"script": "source(output(\n\t\tpeaaaddbo as decimal(38,18),\n\t\tpeaaccaddynsw as string,\n\t\tpeaaclmadv as decimal(38,18),\n\t\tpeaaclmbo as decimal(38,18),\n\t\tpeaaclobo as decimal(38,18),\n\t\tpeaacorbo as decimal(38,18),\n\t\tpeaaddbor as decimal(38,18),\n\t\tpeaaddmailfreq as decimal(38,18),\n\t\tpeaalternatepayer as decimal(38,18),\n\t\tpeaaprobo as decimal(38,18),\n\t\tpeabirtno as string,\n\t\tpeabirtws as decimal(38,18),\n\t\tpeacalamt as decimal(38,18),\n\t\tpeacalcurr as string,\n\t\tpeaccint as string,\n\t\tpeaccintr as decimal(38,18),\n\t\tpeacclamt as decimal(38,18),\n\t\tpeacclcurr as string,\n\t\tpeaccode as decimal(38,18),\n\t\tpeaclamailfreq as decimal(38,18),\n\t\tpeaclmadv as decimal(38,18),\n\t\tpeaclmbor as decimal(38,18),\n\t\tpeaclmintynsw as string,\n\t\tpeaclmmailfreq as decimal(38,18),\n\t\tpeaclobor as decimal(38,18),\n\t\tpeaclomet as decimal(38,18),\n\t\tpeaclosmailfreq as decimal(38,18),\n\t\tpeacolid as string,\n\t\tpeacomp2 as decimal(38,18),\n\t\tpeacorbo as decimal(38,18),\n\t\tpeacorrmailfreq as decimal(38,18),\n\t\tpeacrdate as timestamp,\n\t\tpeacrmid as decimal(38,18),\n\t\tpeacrsign as string,\n\t\tpeacruser as decimal(38,18),\n\t\tpeacustomerid as string,\n\t\tpeadueday as decimal(38,18),\n\t\tpeaendate as timestamp,\n\t\tpeaextid as string,\n\t\tpeaextid2 as string,\n\t\tpeaexttransfer as string,\n\t\tpeaexttransfer2 as string,\n\t\tpeafromcomp as decimal(38,18),\n\t\tpeaie2busndiv as decimal(38,18),\n\t\tpeaie2busnse as decimal(38,18),\n\t\tpeaie3busndiv as decimal(38,18),\n\t\tpeaie3busnse as decimal(38,18),\n\t\tpeaiebusndiv as decimal(38,18),\n\t\tpeaiebusnse as decimal(38,18),\n\t\tpeaiecon1 as decimal(38,18),\n\t\tpeaiecon2 as decimal(38,18),\n\t\tpeaiecon3 as decimal(38,18),\n\t\tpeaiecon4 as decimal(38,18),\n\t\tpeaiecon5 as decimal(38,18),\n\t\tpeaiecond as string,\n\t\tpeaiediv as string,\n\t\tpeaieint as string,\n\t\tpeaieint1 as string,\n\t\tpeaieint2 as string,\n\t\tpeaieint3 as string,\n\t\tpeaieint4 as string,\n\t\tpeaieint5 as string,\n\t\tpeaiesect as string,\n\t\tpeaincreday as decimal(38,18),\n\t\tpeaingiro as decimal(38,18),\n\t\tpeaingiroludate as timestamp,\n\t\tpeaingirolusign as string,\n\t\tpeaingirono as string,\n\t\tpeainvisible as string,\n\t\tpeaiselectronic as string,\n\t\tpeaiyear as decimal(38,18),\n\t\tpeaknvmark as string,\n\t\tpealang2 as string,\n\t\tpealeicode as string,\n\t\tpealudate as timestamp,\n\t\tpealusign as string,\n\t\tpealuuser as decimal(38,18),\n\t\tpeamailcndnsplit as string,\n\t\tpeamailsizemb as decimal(38,18),\n\t\tpeamailuseservadress as string,\n\t\tpeamasked as string,\n\t\tpeamaxper as decimal(38,18),\n\t\tpeamdescr as string,\n\t\tpeamexamt as decimal(38,18),\n\t\tpeamexcdate as timestamp,\n\t\tpeamexcurr as string,\n\t\tpeamexpro as decimal(38,18),\n\t\tpeanopdue as decimal(38,18),\n\t\tpeanopurr as string,\n\t\tpeanotaco as decimal(38,18),\n\t\tpeanotdays as decimal(38,18),\n\t\tpeanotlay as decimal(38,18),\n\t\tpeanotsort as decimal(38,18),\n\t\tpeaorgno as string,\n\t\tpeaorigmemberfrom as decimal(38,18),\n\t\tpeaoutcreday as decimal(38,18),\n\t\tpeaoutgiro as decimal(38,18),\n\t\tpeaoutgiroludate as timestamp,\n\t\tpeaoutgirolusign as string,\n\t\tpeaoutgirono as string,\n\t\tpeapeaid as decimal(38,18),\n\t\tpeapersid as string,\n\t\tpeapersrfl as decimal(38,18),\n\t\tpeapibregsign as string,\n\t\tpeaprobor as decimal(38,18),\n\t\tpeaprovmailfreq as decimal(38,18),\n\t\tpeapurtyp as decimal(38,18),\n\t\tpearesdat as timestamp,\n\t\tpeasex as string,\n\t\tpeastaamt as decimal(38,18),\n\t\tpeastaniv as decimal(38,18),\n\t\tpeastatyp as decimal(38,18),\n\t\tpeastdate as timestamp,\n\t\tpeastensw as decimal(38,18),\n\t\tpeastopcod as decimal(38,18),\n\t\tpeastoppremnote as string,\n\t\tpeastopuse as string,\n\t\tpeasttniv as decimal(38,18),\n\t\tpeasttprmclm as decimal(38,18),\n\t\tpeasubtype as decimal(38,18),\n\t\tpeasw10 as string,\n\t\tpeaswink as decimal(38,18),\n\t\tpeaswrun as decimal(38,18),\n\t\tpeausecolfee as string,\n\t\tpeavatno as string,\n\t\tpeavendorid as string,\n\t\tpeaxlcurr as string,\n\t\tpeaxlpoin as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> pea\nsource(output(\n\t\tlgacandate as timestamp,\n\t\tlgaclmcat as string,\n\t\tlgaclmtype as string,\n\t\tlgacrcode as string,\n\t\tlgacrcrdate as timestamp,\n\t\tlgacrcrsign as string,\n\t\tlgacrdate as timestamp,\n\t\tlgacrlgaid as string,\n\t\tlgacrsign as string,\n\t\tlgacrynsw as string,\n\t\tlgaendate as timestamp,\n\t\tlgaguaamt as decimal(38,18),\n\t\tlgaguacurr as string,\n\t\tlgaintnote as string,\n\t\tlgaintynsw as string,\n\t\tlgajurisdiction as string,\n\t\tlgaknvmark as string,\n\t\tlgalcaid as string,\n\t\tlgalccid as string,\n\t\tlgalgaid as string,\n\t\tlgaln2 as decimal(38,18),\n\t\tlgaludate as timestamp,\n\t\tlgalusign as string,\n\t\tlgaobocname as string,\n\t\tlgaobopeaid as decimal(38,18),\n\t\tlgareceiver as decimal(38,18),\n\t\tlgastatus as string,\n\t\tlgastdate as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> lga\npea select(mapColumn(\n\t\tpeapeaid,\n\t\tpeamdescr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> PeaTable\nlga select(mapColumn(\n\t\tlgalcaid,\n\t\tlgalgaid,\n\t\tlgacrcode,\n\t\tlgastdate,\n\t\tlgaendate,\n\t\tlgaintnote,\n\t\tlgacrcrdate,\n\t\tlgareceiver,\n\t\tlgastatus\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> LgaTable\nPeaTable, LgaTable join(peapeaid == lgareceiver,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> PeaLga\nPeaLga derive(Gut_Key = concat('P', lgalgaid),\n\t\tGut_Type_Description = case (lgacrcode == 'C','Provided Guarantee',\r\n       case(lgacrcode == 'R','Received Guarantee','Received Counter Guarantee'\r\n           )\r\n     ),\n\t\tGut_Guarantee_Status = case (lgastatus == 'A','Open',\r\n       case(lgastatus == 'R','Closed','Closed'\r\n           )\r\n     ),\n\t\tGut_Inc_Key = concat('P', lgalcaid),\n\t\tGut_open_ind = case (lgastatus == 'A','Y',\r\n       case(lgastatus == 'R','N','N'\r\n           )\r\n     ),\n\t\tGut_Guarantee_type_Code = lgacrcode) ~> expression\nexpression select(mapColumn(\n\t\tGut_Date_Given = lgastdate,\n\t\tGut_Guarantee_Issued_To = peamdescr,\n\t\tGut_Guarantee_Remarks = lgaintnote,\n\t\tGut_Date_Expiry = lgaendate,\n\t\tGut_Date_Created = lgacrcrdate,\n\t\teach(match(left(name,3)=='Gut'))\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectedColumns\nSelectedColumns sink(input(\n\t\tagt_description as string,\n\t\tagt_key as string,\n\t\tlast_updated_by as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_guarantee_pa.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> PreDimGuarantee"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_partner_me')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "paa"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "pea"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "peb"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "pez"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "qtbtable"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "crctable"
						},
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "tcrossreference"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "pectable"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "cbsttable"
						},
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "cbstable2"
						},
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "SfCompany"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_partner",
								"type": "DatasetReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "maxpeb"
						},
						{
							"name": "pebmaxpeb"
						},
						{
							"name": "pebdunco"
						},
						{
							"name": "Prtstatusjoin"
						},
						{
							"name": "peatable"
						},
						{
							"name": "Prtstatus"
						},
						{
							"name": "prtpea"
						},
						{
							"name": "crcselected"
						},
						{
							"name": "peacrc"
						},
						{
							"name": "paatable"
						},
						{
							"name": "Paafiltered"
						},
						{
							"name": "crcpaa"
						},
						{
							"name": "peztable"
						},
						{
							"name": "paapez"
						},
						{
							"name": "lookupState"
						},
						{
							"name": "pebtable"
						},
						{
							"name": "Expression1"
						},
						{
							"name": "Select1"
						},
						{
							"name": "lookupCapital"
						},
						{
							"name": "Select2"
						},
						{
							"name": "lookupCompSubtype"
						},
						{
							"name": "Select3"
						},
						{
							"name": "lookupCountry"
						},
						{
							"name": "Select4"
						},
						{
							"name": "lookupContractType"
						},
						{
							"name": "Select5"
						},
						{
							"name": "DerivedColumn1"
						},
						{
							"name": "Lookup2"
						},
						{
							"name": "partner"
						},
						{
							"name": "DerivedColumn3"
						},
						{
							"name": "constantBroker"
						},
						{
							"name": "DerivedColumn4"
						},
						{
							"name": "constantcontract"
						},
						{
							"name": "Union1"
						},
						{
							"name": "deduplicate"
						},
						{
							"name": "state"
						},
						{
							"name": "capital"
						},
						{
							"name": "country"
						},
						{
							"name": "Select8"
						},
						{
							"name": "selectedcolumns"
						},
						{
							"name": "compsubtype"
						}
					],
					"script": "source(output(\n\t\tpaabusncla as decimal(38,18),\n\t\tpaabusnsec as decimal(38,18),\n\t\tpaacaddrcountry as string,\n\t\tpaacaddress1 as string,\n\t\tpaacaddress2 as string,\n\t\tpaacaddress3 as string,\n\t\tpaacaddress4 as string,\n\t\tpaacaddress5 as string,\n\t\tpaacaddrpostal as string,\n\t\tpaaccmail as string,\n\t\tpaacfax as string,\n\t\tpaacname as string,\n\t\tpaacname2 as string,\n\t\tpaacontcname as string,\n\t\tpaacontcphone as string,\n\t\tpaacontemail as string,\n\t\tpaacontmobcphone as string,\n\t\tpaacontpeaid as decimal(38,18),\n\t\tpaacphone as string,\n\t\tpaactelex as string,\n\t\tpaafunct as decimal(38,18),\n\t\tpaaintnet as string,\n\t\tpaaintnote as string,\n\t\tpaalcname as string,\n\t\tpaalongname as string,\n\t\tpaamail as string,\n\t\tpaapeaid as decimal(38,18),\n\t\tpaarevcname as string,\n\t\tpaascname as string,\n\t\tpaaspbusndiv as decimal(38,18),\n\t\tpaawww as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> paa\nsource(output(\n\t\tpeaaaddbo as decimal(38,18),\n\t\tpeaaccaddynsw as string,\n\t\tpeaaclmadv as decimal(38,18),\n\t\tpeaaclmbo as decimal(38,18),\n\t\tpeaaclobo as decimal(38,18),\n\t\tpeaacorbo as decimal(38,18),\n\t\tpeaaddbor as decimal(38,18),\n\t\tpeaaddmailfreq as decimal(38,18),\n\t\tpeaalternatepayer as decimal(38,18),\n\t\tpeaaprobo as decimal(38,18),\n\t\tpeabirtno as string,\n\t\tpeabirtws as decimal(38,18),\n\t\tpeacalamt as decimal(38,18),\n\t\tpeacalcurr as string,\n\t\tpeaccint as string,\n\t\tpeaccintr as decimal(38,18),\n\t\tpeacclamt as decimal(38,18),\n\t\tpeacclcurr as string,\n\t\tpeaccode as decimal(38,18),\n\t\tpeaclamailfreq as decimal(38,18),\n\t\tpeaclmadv as decimal(38,18),\n\t\tpeaclmbor as decimal(38,18),\n\t\tpeaclmintynsw as string,\n\t\tpeaclmmailfreq as decimal(38,18),\n\t\tpeaclobor as decimal(38,18),\n\t\tpeaclomet as decimal(38,18),\n\t\tpeaclosmailfreq as decimal(38,18),\n\t\tpeacolid as string,\n\t\tpeacomp2 as decimal(38,18),\n\t\tpeacorbo as decimal(38,18),\n\t\tpeacorrmailfreq as decimal(38,18),\n\t\tpeacrdate as timestamp,\n\t\tpeacrmid as decimal(38,18),\n\t\tpeacrsign as string,\n\t\tpeacruser as decimal(38,18),\n\t\tpeacustomerid as string,\n\t\tpeadueday as decimal(38,18),\n\t\tpeaendate as timestamp,\n\t\tpeaextid as string,\n\t\tpeaextid2 as string,\n\t\tpeaexttransfer as string,\n\t\tpeaexttransfer2 as string,\n\t\tpeafromcomp as decimal(38,18),\n\t\tpeaie2busndiv as decimal(38,18),\n\t\tpeaie2busnse as decimal(38,18),\n\t\tpeaie3busndiv as decimal(38,18),\n\t\tpeaie3busnse as decimal(38,18),\n\t\tpeaiebusndiv as decimal(38,18),\n\t\tpeaiebusnse as decimal(38,18),\n\t\tpeaiecon1 as decimal(38,18),\n\t\tpeaiecon2 as decimal(38,18),\n\t\tpeaiecon3 as decimal(38,18),\n\t\tpeaiecon4 as decimal(38,18),\n\t\tpeaiecon5 as decimal(38,18),\n\t\tpeaiecond as string,\n\t\tpeaiediv as string,\n\t\tpeaieint as string,\n\t\tpeaieint1 as string,\n\t\tpeaieint2 as string,\n\t\tpeaieint3 as string,\n\t\tpeaieint4 as string,\n\t\tpeaieint5 as string,\n\t\tpeaiesect as string,\n\t\tpeaincreday as decimal(38,18),\n\t\tpeaingiro as decimal(38,18),\n\t\tpeaingiroludate as timestamp,\n\t\tpeaingirolusign as string,\n\t\tpeaingirono as string,\n\t\tpeainvisible as string,\n\t\tpeaiselectronic as string,\n\t\tpeaiyear as decimal(38,18),\n\t\tpeaknvmark as string,\n\t\tpealang2 as string,\n\t\tpealeicode as string,\n\t\tpealudate as timestamp,\n\t\tpealusign as string,\n\t\tpealuuser as decimal(38,18),\n\t\tpeamailcndnsplit as string,\n\t\tpeamailsizemb as decimal(38,18),\n\t\tpeamailuseservadress as string,\n\t\tpeamasked as string,\n\t\tpeamaxper as decimal(38,18),\n\t\tpeamdescr as string,\n\t\tpeamexamt as decimal(38,18),\n\t\tpeamexcdate as timestamp,\n\t\tpeamexcurr as string,\n\t\tpeamexpro as decimal(38,18),\n\t\tpeanopdue as decimal(38,18),\n\t\tpeanopurr as string,\n\t\tpeanotaco as decimal(38,18),\n\t\tpeanotdays as decimal(38,18),\n\t\tpeanotlay as decimal(38,18),\n\t\tpeanotsort as decimal(38,18),\n\t\tpeaorgno as string,\n\t\tpeaorigmemberfrom as decimal(38,18),\n\t\tpeaoutcreday as decimal(38,18),\n\t\tpeaoutgiro as decimal(38,18),\n\t\tpeaoutgiroludate as timestamp,\n\t\tpeaoutgirolusign as string,\n\t\tpeaoutgirono as string,\n\t\tpeapeaid as decimal(38,18),\n\t\tpeapersid as string,\n\t\tpeapersrfl as decimal(38,18),\n\t\tpeapibregsign as string,\n\t\tpeaprobor as decimal(38,18),\n\t\tpeaprovmailfreq as decimal(38,18),\n\t\tpeapurtyp as decimal(38,18),\n\t\tpearesdat as timestamp,\n\t\tpeasex as string,\n\t\tpeastaamt as decimal(38,18),\n\t\tpeastaniv as decimal(38,18),\n\t\tpeastatyp as decimal(38,18),\n\t\tpeastdate as timestamp,\n\t\tpeastensw as decimal(38,18),\n\t\tpeastopcod as decimal(38,18),\n\t\tpeastoppremnote as string,\n\t\tpeastopuse as string,\n\t\tpeasttniv as decimal(38,18),\n\t\tpeasttprmclm as decimal(38,18),\n\t\tpeasubtype as decimal(38,18),\n\t\tpeasw10 as string,\n\t\tpeaswink as decimal(38,18),\n\t\tpeaswrun as decimal(38,18),\n\t\tpeausecolfee as string,\n\t\tpeavatno as string,\n\t\tpeavendorid as string,\n\t\tpeaxlcurr as string,\n\t\tpeaxlpoin as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> pea\nsource(output(\n\t\tpebbrdate as timestamp,\n\t\tpebcivilstatus as decimal(38,18),\n\t\tpebconbusncla as decimal(38,18),\n\t\tpebconbusndiv as decimal(38,18),\n\t\tpebconbusnsec as decimal(38,18),\n\t\tpebconcomp2 as decimal(38,18),\n\t\tpebconoffice as decimal(38,18),\n\t\tpebdistrict as string,\n\t\tpebdunco as decimal(38,18),\n\t\tpebemlcurr as string,\n\t\tpebemlmdescr as string,\n\t\tpebetcbroker as string,\n\t\tpebfortsector as decimal(38,18),\n\t\tpebforttrade as string,\n\t\tpebgeneml as decimal(38,18),\n\t\tpebgroup as decimal(38,18),\n\t\tpebhourprice as decimal(38,18),\n\t\tpebinstadynz as string,\n\t\tpebisolan as string,\n\t\tpebkycapprdate as timestamp,\n\t\tpebkycapproved as string,\n\t\tpebkyccompany as decimal(38,18),\n\t\tpebkyccompdescr as string,\n\t\tpebkycid as string,\n\t\tpebludate as timestamp,\n\t\tpeblusign as string,\n\t\tpebmacheml as decimal(38,18),\n\t\tpebmansanctdescr as string,\n\t\tpebmansanction as string,\n\t\tpebmdescr as string,\n\t\tpebmvaynsw as string,\n\t\tpebnmisic as string,\n\t\tpebnmnyk as string,\n\t\tpeboffsanctdescr as string,\n\t\tpeboffsanction as string,\n\t\tpebonrisk as string,\n\t\tpebonriskdate as timestamp,\n\t\tpebpaylevel as decimal(38,18),\n\t\tpebpeaid as decimal(38,18),\n\t\tpebpebid as string,\n\t\tpebpeoid as string,\n\t\tpebpeoopeaid as decimal(38,18),\n\t\tpebpersacc as decimal(38,18),\n\t\tpebpever as decimal(38,18),\n\t\tpebpibregdate as timestamp,\n\t\tpebpibregsign as string,\n\t\tpebpidcname as string,\n\t\tpebpidid as decimal(38,18),\n\t\tpebpricecurr as string,\n\t\tpebqadate as timestamp,\n\t\tpebqasign as string,\n\t\tpebqastatus as string,\n\t\tpebratcod as string,\n\t\tpebratcomp as decimal(38,18),\n\t\tpebratedate as timestamp,\n\t\tpebratludate as timestamp,\n\t\tpebratsign as string,\n\t\tpebreason as string,\n\t\tpebressign as string,\n\t\tpebsitid as string,\n\t\tpebsupporter as string,\n\t\tpebtaxno as string,\n\t\tpebtypelevel as decimal(38,18),\n\t\tpebusstate as string,\n\t\tpebvaldate as timestamp,\n\t\tpebverstat as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> peb\nsource(output(\n\t\tpezdefaccrebynsw as string,\n\t\tpezdefagtnol as decimal(38,18),\n\t\tpezdefbusnbranch as decimal(38,18),\n\t\tpezdefbusncla as decimal(38,18),\n\t\tpezdefbusndiv as decimal(38,18),\n\t\tpezdefbusnsec as decimal(38,18),\n\t\tpezdefccpid as string,\n\t\tpezdefcomcod as string,\n\t\tpezdefcurr as string,\n\t\tpezdefinstcalctype as decimal(38,18),\n\t\tpezdefmortg as decimal(38,18),\n\t\tpezdefncomm as decimal(38,18),\n\t\tpezdefoffice as decimal(38,18),\n\t\tpezdeftarcodof as string,\n\t\tpezpezid as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> pez\nsource(output(\n\t\tqtbdispynsw as string,\n\t\tqtbfieldn as string,\n\t\tqtbmdescr as string,\n\t\tqtbsdescr as string,\n\t\tqtbvalue as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> qtbtable\nsource(output(\n\t\tcrcccode as decimal(38,18),\n\t\tcrccpers2 as decimal(38,18),\n\t\tcrccpers3 as decimal(38,18),\n\t\tcrccpers4 as decimal(38,18),\n\t\tcrclospro as decimal(38,18),\n\t\tcrcmdescr as string,\n\t\tcrcperinc as string,\n\t\tcrcratcod as string,\n\t\tcrcratcomp as decimal(38,18),\n\t\tcrcsdescr as string,\n\t\tcrcstopuse as string,\n\t\tcrcsw5 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> crctable\nsource(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcrossreference\nsource(output(\n\t\tpeccofobl as string,\n\t\tpeccofopt as decimal(38,18),\n\t\tpecconpeaid as decimal(38,18),\n\t\tpeccontyp as string,\n\t\tpecdepint as decimal(38,18),\n\t\tpecdepity as string,\n\t\tpecduedate as timestamp,\n\t\tpecextkey as string,\n\t\tpecibnrpr as decimal(38,18),\n\t\tpeciyear as decimal(38,18),\n\t\tpecmanfee as decimal(38,18),\n\t\tpecnoofyr as decimal(38,18),\n\t\tpecnoufyr as decimal(38,18),\n\t\tpecpcaid as string,\n\t\tpecpecid as decimal(38,18),\n\t\tpecprocom as decimal(38,18),\n\t\tpecprosw1 as string,\n\t\tpecprosw2 as string,\n\t\tpecsw5 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> pectable\nsource(output(\n\t\tcbsaddper as decimal(38,18),\n\t\tcbsagform as string,\n\t\tcbsaowreb as decimal(38,18),\n\t\tcbsautocl as decimal(38,18),\n\t\tcbsbusnbranch as decimal(38,18),\n\t\tcbsbusnsec as decimal(38,18),\n\t\tcbscnform as string,\n\t\tcbscrewform as string,\n\t\tcbsdefcondco as decimal(38,18),\n\t\tcbsdefpayer as string,\n\t\tcbsdnform as string,\n\t\tcbsetcpremium as string,\n\t\tcbslang2 as string,\n\t\tcbsmdescr as string,\n\t\tcbsmutual as string,\n\t\tcbspitype as string,\n\t\tcbsrefcod as string,\n\t\tcbsrenew as decimal(38,18),\n\t\tcbsrenewendrule as decimal(38,18),\n\t\tcbsrenewperiod as decimal(38,18),\n\t\tcbssdescr as string,\n\t\tcbssiidef as string,\n\t\tcbsstopuse as string,\n\t\tcbssw10 as string,\n\t\tcbstarynsw as string,\n\t\tcbstaxappl as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> cbsttable\nsource(output(\n\t\tcbsaddper as decimal(38,18),\n\t\tcbsagform as string,\n\t\tcbsaowreb as decimal(38,18),\n\t\tcbsautocl as decimal(38,18),\n\t\tcbsbusnbranch as decimal(38,18),\n\t\tcbsbusnsec as decimal(38,18),\n\t\tcbscnform as string,\n\t\tcbscrewform as string,\n\t\tcbsdefcondco as decimal(38,18),\n\t\tcbsdefpayer as string,\n\t\tcbsdnform as string,\n\t\tcbsetcpremium as string,\n\t\tcbslang2 as string,\n\t\tcbsmdescr as string,\n\t\tcbsmutual as string,\n\t\tcbspitype as string,\n\t\tcbsrefcod as string,\n\t\tcbsrenew as decimal(38,18),\n\t\tcbsrenewendrule as decimal(38,18),\n\t\tcbsrenewperiod as decimal(38,18),\n\t\tcbssdescr as string,\n\t\tcbssiidef as string,\n\t\tcbsstopuse as string,\n\t\tcbssw10 as string,\n\t\tcbstarynsw as string,\n\t\tcbstaxappl as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> cbstable2\nsource(output(\n\t\taccount_resp_me as string,\n\t\taccount_resp_pi as string,\n\t\taccount_status as string,\n\t\tclient_lost_reason as string,\n\t\tcompany_email as string,\n\t\tcompany_id as double,\n\t\tcompany_name as string,\n\t\tcompany_owner_full_name as string,\n\t\tcompany_owner_id as string,\n\t\tcountry as string,\n\t\tcuo_full_name as string,\n\t\tcuo_user_id as string,\n\t\tdate_inserted as timestamp,\n\t\tdate_updated as timestamp,\n\t\tgard_contact_id as string,\n\t\tmarket_area_code as string,\n\t\tmarket_area_description as string,\n\t\tmarket_area_id as string,\n\t\tparent_company_id as double,\n\t\tparent_company_name as string,\n\t\tparis_gic_id as double,\n\t\tprimary_contact_email as string,\n\t\tprimary_contact_name as string,\n\t\tsf_last_updated_date as timestamp,\n\t\tsource_system as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> SfCompany\npeb aggregate(groupBy(pebpeaid),\n\tMAXPEBPEVER = max(pebpever)) ~> maxpeb\npebtable, maxpeb join(pebtable@pebpeaid == maxpeb@pebpeaid\n\t&& pebpever == MAXPEBPEVER,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> pebmaxpeb\nqtbtable filter(qtbfieldn=='pebdunco') ~> pebdunco\npebmaxpeb, pebdunco join(pebdunco == toInteger(qtbvalue),\n\tjoinType:'left',\n\tbroadcast: 'auto')~> Prtstatusjoin\npea select(mapColumn(\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> peatable\nPrtstatusjoin select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid = pebtable@pebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tPebpever = pebpever,\n\t\tpebdunco,\n\t\tpebpeaid = maxpeb@pebpeaid,\n\t\tMAXPEBPEVER,\n\t\tQTBFIELDN = qtbfieldn,\n\t\tQTBVALUE = qtbvalue,\n\t\tQTBMDESCR = qtbmdescr,\n\t\tQTBSDESCR = qtbsdescr,\n\t\tQTBDISPYNSW = qtbdispynsw\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Prtstatus\nPrtstatus, peatable join(pebpeaid == peapeaid,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> prtpea\ncrctable select(mapColumn(\n\t\tcrcratcod,\n\t\tcrcmdescr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> crcselected\nprtpea, crcselected join(pebratcod == crcratcod,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> peacrc\npaa select(mapColumn(\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> paatable\npaatable filter(iifNull(paafunct,0) ==0) ~> Paafiltered\npeacrc, Paafiltered join(peapeaid == paapeaid,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> crcpaa\npez select(mapColumn(\n\t\tpezpezid,\n\t\tpezdefbusnbranch\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> peztable\ncrcpaa, peztable join(peapeaid == pezpezid,\n\tjoinType:'inner',\n\tbroadcast: 'auto')~> paapez\nExpression1, state lookup(pebtaxno == SOURCE_CODE_KEY,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookupState\npeb select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tpebpever,\n\t\tpebdunco\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> pebtable\npaapez derive(Key = concat('P',toString(peapeaid)),\n\t\t{Partner Name} = iifNull(trim(paalongname),iifNull(trim(paacname, peamdescr))),\n\t\tAddress = concat(trim(paacaddress1),iif(isNull((concat(trim(paacaddress2),concat(trim(paacaddress3), trim(paacaddress4))))),' ',paacaddress2)),\n\t\t{Rating Code} = case(isNull(pebratcod),'N/A',pebratcod),\n\t\t{Rating Code desc} = case(isNull(crcmdescr),'N/A',crcmdescr),\n\t\t{Partner Short Name} = peamdescr,\n\t\tPezdefbusnbranch = toString(pezdefbusnbranch),\n\t\tpeasubtype = toString(peasubtype),\n\t\t{Source System} = 'PARIS',\n\t\t{Code Type State} = 368,\n\t\t{Code Type Capital} = 116,\n\t\t{Code Type Comp Sub} = 795,\n\t\t{Code Type Country} = 50) ~> Expression1\nlookupState select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tPebpever,\n\t\tpebdunco,\n\t\tMAXPEBPEVER,\n\t\tQTBFIELDN,\n\t\tQTBVALUE,\n\t\tQTBMDESCR,\n\t\tQTBSDESCR,\n\t\tQTBDISPYNSW,\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2,\n\t\tcrcratcod,\n\t\tcrcmdescr,\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex,\n\t\tpezpezid,\n\t\tKey,\n\t\t{Partner Name},\n\t\tAddress,\n\t\t{Rating Code},\n\t\t{Rating Code desc},\n\t\t{Partner Short Name},\n\t\tPezdefbusnbranch = Expression1@Pezdefbusnbranch,\n\t\t{Source System},\n\t\t{Code Type State},\n\t\t{Code Type Capital},\n\t\t{Code Type Comp Sub},\n\t\t{Code Type Country},\n\t\tSOURCE_CODE_KEY,\n\t\tSOURCE_SYSTEM,\n\t\t{State Code} = TARGET_CODE,\n\t\t{State Description} = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1, capital lookup(Pezdefbusnbranch == tcrossreference@SOURCE_CODE_KEY,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookupCapital\nlookupCapital select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tPebpever,\n\t\tpebdunco,\n\t\tMAXPEBPEVER,\n\t\tQTBFIELDN,\n\t\tQTBVALUE,\n\t\tQTBMDESCR,\n\t\tQTBSDESCR,\n\t\tQTBDISPYNSW,\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2,\n\t\tcrcratcod,\n\t\tcrcmdescr,\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex,\n\t\tpezpezid,\n\t\tKey,\n\t\t{Partner Name},\n\t\tAddress,\n\t\t{Rating Code},\n\t\t{Rating Code desc},\n\t\t{Partner Short Name},\n\t\tPezdefbusnbranch,\n\t\t{Source System},\n\t\t{Code Type State},\n\t\t{Code Type Capital},\n\t\t{Code Type Comp Sub},\n\t\t{Code Type Country},\n\t\t{State Code},\n\t\t{State Description},\n\t\t{Capital Code} = TARGET_CODE,\n\t\t{Capital Description} = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select2\nSelect2, compsubtype lookup(peasubtype == SOURCE_CODE_KEY,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookupCompSubtype\nlookupCompSubtype select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tPebpever,\n\t\tpebdunco,\n\t\tMAXPEBPEVER,\n\t\tQTBFIELDN,\n\t\tQTBVALUE,\n\t\tQTBMDESCR,\n\t\tQTBSDESCR,\n\t\tQTBDISPYNSW,\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2,\n\t\tcrcratcod,\n\t\tcrcmdescr,\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex,\n\t\tpezpezid,\n\t\tKey,\n\t\t{Partner Name},\n\t\tAddress,\n\t\t{Rating Code},\n\t\t{Rating Code desc},\n\t\t{Partner Short Name},\n\t\tPezdefbusnbranch,\n\t\t{Source System},\n\t\t{Code Type State},\n\t\t{Code Type Capital},\n\t\t{Code Type Comp Sub},\n\t\t{Code Type Country},\n\t\t{State Code},\n\t\t{State Description},\n\t\t{Capital Code},\n\t\t{Capital Description},\n\t\t{Company Sub Code} = TARGET_CODE,\n\t\t{Company Sub Description} = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select3\nSelect3, country lookup(pebisolan == SOURCE_CODE_KEY,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookupCountry\nlookupCountry select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tPebpever,\n\t\tpebdunco,\n\t\tMAXPEBPEVER,\n\t\tQTBFIELDN,\n\t\tQTBVALUE,\n\t\tQTBMDESCR,\n\t\tQTBSDESCR,\n\t\tQTBDISPYNSW,\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2,\n\t\tcrcratcod,\n\t\tcrcmdescr,\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex,\n\t\tpezpezid,\n\t\tKey,\n\t\t{Partner Name},\n\t\tAddress,\n\t\t{Rating Code},\n\t\t{Rating Code desc},\n\t\t{Partner Short Name},\n\t\tPezdefbusnbranch,\n\t\t{Source System},\n\t\t{Code Type State},\n\t\t{Code Type Capital},\n\t\t{Code Type Comp Sub},\n\t\t{Code Type Country},\n\t\t{State Code},\n\t\t{State Description},\n\t\t{Capital Code},\n\t\t{Capital Description},\n\t\t{Domicile Code} = TARGET_CODE,\n\t\t{Domicile Description} = TARGET_DESCRIPTION,\n\t\t{Company Sub Code},\n\t\t{Company Sub Description}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select4\nSelect4, pectable lookup(peapeaid == pecpecid,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> lookupContractType\nlookupContractType select(mapColumn(\n\t\tpebpebid,\n\t\tpebpeaid,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno,\n\t\tPebpever,\n\t\tpebdunco,\n\t\tMAXPEBPEVER,\n\t\tQTBFIELDN,\n\t\tQTBVALUE,\n\t\tQTBMDESCR,\n\t\tQTBSDESCR,\n\t\tQTBDISPYNSW,\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2,\n\t\tcrcratcod,\n\t\tcrcmdescr,\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex,\n\t\tpezpezid,\n\t\tKey,\n\t\t{Partner Name},\n\t\tAddress,\n\t\t{Rating Code},\n\t\t{Rating Code desc},\n\t\t{Partner Short Name},\n\t\tPezdefbusnbranch,\n\t\t{Source System},\n\t\t{Code Type State},\n\t\t{Code Type Capital},\n\t\t{Code Type Comp Sub},\n\t\t{Code Type Country},\n\t\t{State Code},\n\t\t{State Description},\n\t\t{Capital Code},\n\t\t{Capital Description},\n\t\t{Domicile Code},\n\t\t{Domicile Description},\n\t\tpeccontype = peccontyp,\n\t\t{Company Sub Code},\n\t\t{Company Sub Description}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select5\nSelect5 derive({Contract Type} = case(peccontype == '0' , 'NORMAL',case(peccontype == '1','WAR',case(peccontype == '9','XL','OTHER')))) ~> DerivedColumn1\nDerivedColumn1, paa lookup(pebratcomp == paa@paapeaid,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'auto')~> Lookup2\nLookup2 select(mapColumn(\n\t\tkey = Key,\n\t\t{Partner Name},\n\t\tAddress,\n\t\tpebdunco,\n\t\tQtbmdescr = QTBMDESCR,\n\t\tAddress1 = Select5@paacaddress1,\n\t\tAddress2 = Select5@paacaddress2,\n\t\tAddress3 = Select5@paacaddress3,\n\t\tAddress4 = Select5@paacaddress4,\n\t\tpaacaddress3 = Select5@paacaddress3,\n\t\t{Rating Company} = paa@paacname,\n\t\tPebratcod = pebratcod,\n\t\t{Rating Code desc},\n\t\tPebratedate = pebratedate,\n\t\t{Domicile Code},\n\t\t{Domicile Description},\n\t\tPeaccode = peaccode,\n\t\t{Capital Code},\n\t\t{Capital Description},\n\t\t{Company Sub code} = {Company Sub Code},\n\t\t{Company Sub Description},\n\t\tState = {State Description},\n\t\t{Paacname RatingComp} = paa@paacname,\n\t\tPeaextid2 = peaextid2,\n\t\t{Contract Type}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> partner\ncbsttable derive(Key = 'PDIR99',\n\t\t{Partner Name} = 'Direct Placed',\n\t\tAddress = 'Not Applicable',\n\t\tpebdunco = toDecimal(null()),\n\t\tDuncodesc = 'Not Applicable',\n\t\tAddress1 = 'Not Applicable',\n\t\tAddress2 = 'Not Applicable',\n\t\tAddress3 = 'Not Applicable',\n\t\tAddress4 = 'Not Applicable',\n\t\t{Rating Company} = 'Not Applicable',\n\t\t{Rating Code} = 'N/A',\n\t\t{Rating Code Description} = 'Not Applicable',\n\t\t{Rating Date} = toTimestamp(case(1!=1,1)),\n\t\t{Domicile Code} = 'N/A',\n\t\t{Domicile Description} = 'Not Applicable',\n\t\tPeacode = toDecimal(null()),\n\t\t{Capital Code} = toString(null()),\n\t\t{Capital Description} = toString(null()),\n\t\t{Company Sub code} = toString(null()),\n\t\t{Company Sub Desc} = toString(null()),\n\t\tState = 'N/A',\n\t\tPeaextid2 = toString(null()),\n\t\t{Contract Type} = toString(null())) ~> DerivedColumn3\nDerivedColumn3 select(mapColumn(\n\t\tkey = Key,\n\t\t{Partner Name},\n\t\tAddress,\n\t\tpebdunco,\n\t\tQtbmdescr = Duncodesc,\n\t\tAddress1,\n\t\tAddress2,\n\t\tAddress3,\n\t\tAddress4,\n\t\t{Rating Company},\n\t\tPebratcod = {Rating Code},\n\t\t{Rating Code desc} = {Rating Code Description},\n\t\tPebratedate = {Rating Date},\n\t\t{Domicile Code},\n\t\t{Domicile Description},\n\t\tPeaccode = Peacode,\n\t\t{Capital Code},\n\t\t{Capital Description},\n\t\t{Company Sub code},\n\t\t{Company Sub Description} = {Company Sub Desc},\n\t\tState,\n\t\tPeaextid2,\n\t\t{Contract Type}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> constantBroker\ncbstable2 derive({Partner Name} = 'Facultativ',\n\t\t{Pk Key} = 'PFACULTATIV',\n\t\tAddress = 'Not Applicable',\n\t\tAddress1 = 'Not Applicable',\n\t\tAddress2 = 'Not Applicable',\n\t\tAddress3 = 'Not Applicable',\n\t\tAddress4 = 'Not Applicable',\n\t\t{Rating Company} = 'Not Applicable',\n\t\t{Rating Code} = 'N/A',\n\t\t{Rating Code desc} = 'Not Applicable',\n\t\t{Domicile Description} = 'Not Applicable',\n\t\tPebratedate = toTimestamp(case(1!=1,1)),\n\t\tCity = 'N/A',\n\t\tState = 'N/A',\n\t\tPebdunco = toDecimal(null()),\n\t\tDuncodesc = 'Not Applicable',\n\t\t{Pea Lei Code} = toString(null()),\n\t\tPeaccode = toDecimal(null()),\n\t\t{Contract Type} = 'OTHER') ~> DerivedColumn4\nDerivedColumn4 select(mapColumn(\n\t\tkey = {Pk Key},\n\t\t{Partner Name},\n\t\tAddress,\n\t\tpebdunco = Pebdunco,\n\t\tQtbmdescr = Duncodesc,\n\t\tAddress1,\n\t\tAddress2,\n\t\tAddress3,\n\t\tAddress4,\n\t\t{Rating Company},\n\t\tPebratcod = {Rating Company},\n\t\t{Rating Code desc},\n\t\tPebratedate,\n\t\t{Domicile Code} = City,\n\t\t{Domicile Description},\n\t\tPeaccode,\n\t\t{Capital Code} = {Pea Lei Code},\n\t\t{Capital Description} = {Pea Lei Code},\n\t\t{Company Sub code} = {Pea Lei Code},\n\t\t{Company Sub Description} = {Pea Lei Code},\n\t\tState,\n\t\t{Contract Type},\n\t\tPeaextid2 = {Pea Lei Code}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> constantcontract\npartner, constantBroker, constantcontract union(byName: true)~> Union1\nUnion1 aggregate(groupBy(Key = key),\n\teach(match(name!='key'), $$ = first($$))) ~> deduplicate\ntcrossreference filter(CODE_TYPE_ID == 368 && SOURCE_SYSTEM == 'PARIS') ~> state\ntcrossreference filter(CODE_TYPE_ID == 116 && SOURCE_SYSTEM == 'PARIS') ~> capital\ntcrossreference filter(CODE_TYPE_ID == 50 && SOURCE_SYSTEM == 'PARIS') ~> country\nSfCompany select(mapColumn(\n\t\taccount_resp_me,\n\t\taccount_resp_pi,\n\t\taccount_status,\n\t\tclient_lost_reason,\n\t\tcompany_email,\n\t\tcompany_id,\n\t\tcompany_name,\n\t\tcompany_owner_full_name,\n\t\tcompany_owner_id,\n\t\tcountry,\n\t\tcuo_full_name,\n\t\tcuo_user_id,\n\t\tdate_inserted,\n\t\tdate_updated,\n\t\tgard_contact_id,\n\t\tmarket_area_code,\n\t\tmarket_area_description,\n\t\tmarket_area_id,\n\t\tparent_company_id,\n\t\tparent_company_name,\n\t\tparis_gic_id,\n\t\tprimary_contact_email,\n\t\tprimary_contact_name,\n\t\tsf_last_updated_date,\n\t\tsource_system\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select8\ndeduplicate select(mapColumn(\n\t\tKey,\n\t\tPartner_Name = {Partner Name},\n\t\tAddress,\n\t\tpebdunco,\n\t\tQtbmdescr,\n\t\tAddress1,\n\t\tAddress2,\n\t\tAddress3,\n\t\tAddress4,\n\t\tRating_Company = {Rating Company},\n\t\tPebratcod,\n\t\tRating_Code_desc = {Rating Code desc},\n\t\tPebratedate,\n\t\tDomicile_Code = {Domicile Code},\n\t\tDomicile_Description = {Domicile Description},\n\t\tPeaccode,\n\t\tCapital_Code = {Capital Code},\n\t\tCapital_Description = {Capital Description},\n\t\tCompany_Sub_code = {Company Sub code},\n\t\tCompany_Sub_Description = {Company Sub Description},\n\t\tState,\n\t\tPeaextid = Peaextid2,\n\t\tContract_Type = {Contract Type}\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> selectedcolumns\ntcrossreference filter(CODE_TYPE_ID == 795 && SOURCE_SYSTEM == 'PARIS') ~> compsubtype\nselectedcolumns sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_premium_type')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Other",
								"type": "DatasetReference"
							},
							"name": "TCrossref"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_premium_type",
								"type": "DatasetReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [
						{
							"name": "CodeTypePremiumType"
						},
						{
							"name": "Deduplicator"
						},
						{
							"name": "DerivedColumn2"
						},
						{
							"name": "Select1"
						}
					],
					"script": "source(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> TCrossref\nTCrossref filter(CODE_TYPE_ID == 802) ~> CodeTypePremiumType\nCodeTypePremiumType aggregate(groupBy(TARGET_CODE,\n\t\tTARGET_DESCRIPTION),\n\tCODE_TYPE = max(CODE_TYPE_ID)) ~> Deduplicator\nDeduplicator derive(Map_date = toDate(case(1!=1,1)),\n\t\tPk_key_pty = TARGET_CODE,\n\t\tPty_code = TARGET_CODE,\n\t\tPty_Description = TARGET_DESCRIPTION,\n\t\tInserted_By = 'M_PRE_DIM_PREMIUM_TYPE',\n\t\tDate_Inserted = currentDate(),\n\t\tLast_Updated_By = 'M_PRE_DIM_PREMIUM_TYPE',\n\t\tDate_Last_Updated = currentDate(),\n\t\tPty_Source_Column = 'TARGET_CODE',\n\t\tPty_Source_system = 'MAPPINGSYSTEM') ~> DerivedColumn2\nDerivedColumn2 select(mapColumn(\n\t\tMap_date,\n\t\tPk_key_pty,\n\t\tPty_code,\n\t\tPty_Description,\n\t\tInserted_By,\n\t\tDate_Inserted,\n\t\tLast_Updated_By,\n\t\tDate_Last_Updated,\n\t\tPty_Source_Column,\n\t\tPty_Source_system\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nSelect1 sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_premium_type_me')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Paris",
								"type": "DatasetReference"
							},
							"name": "ipa"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "dim_premium_type",
								"type": "DatasetReference"
							},
							"name": "predimpremtype"
						}
					],
					"transformations": [
						{
							"name": "ipatcode"
						},
						{
							"name": "ipatable"
						}
					],
					"script": "source(output(\n\t\tipaabatementpercentage as decimal(38,18),\n\t\tipaaccrebamtp as decimal(38,18),\n\t\tipaaccrebbase as decimal(38,18),\n\t\tipaaccrebp as decimal(38,18),\n\t\tipaaccrebsh as decimal(38,18),\n\t\tipaadarea as string,\n\t\tipaadcom as decimal(38,18),\n\t\tipaadcomc as decimal(38,18),\n\t\tipaaddst as decimal(38,18),\n\t\tipaadicomamtp as decimal(38,18),\n\t\tipaadicombase as decimal(38,18),\n\t\tipaadicomp as decimal(38,18),\n\t\tipaadmfee as decimal(38,18),\n\t\tipaadocomamtp as decimal(38,18),\n\t\tipaadocombase as decimal(38,18),\n\t\tipaadocomp as decimal(38,18),\n\t\tipaagaid as string,\n\t\tipaagbaseamtp as decimal(38,18),\n\t\tipaagtynsw as string,\n\t\tipaapprovestatus as string,\n\t\tipaassetsubno as decimal(38,18),\n\t\tipabonusamt as decimal(38,18),\n\t\tipabonusndisc as decimal(38,18),\n\t\tipaccqid as string,\n\t\tipaclodate as timestamp,\n\t\tipaclstat as decimal(38,18),\n\t\tipacosig1 as string,\n\t\tipacosig2 as string,\n\t\tipacrdate as timestamp,\n\t\tipacrsign as string,\n\t\tipacurr as string,\n\t\tipadwbsname as string,\n\t\tipaeingrpre as decimal(38,18),\n\t\tipaendate as timestamp,\n\t\tipaenhour as decimal(38,18),\n\t\tipaeoutpre as decimal(38,18),\n\t\tipagnsw as decimal(38,18),\n\t\tipagrossamtp as decimal(38,18),\n\t\tipagrossprem as decimal(38,18),\n\t\tipaicaid as string,\n\t\tipaienteredprem as decimal(38,18),\n\t\tipainaid as string,\n\t\tipaindate as timestamp,\n\t\tipainstad as decimal(38,18),\n\t\tipainstcalctype as decimal(38,18),\n\t\tipainstpertype as decimal(38,18),\n\t\tipaipaid as string,\n\t\tipairatecrew as decimal(38,18),\n\t\tipaiusdgt as decimal(38,18),\n\t\tipaknvmark as string,\n\t\tipalastinstamtp as decimal(38,18),\n\t\tipalastinstperc as decimal(38,18),\n\t\tipalisig1 as string,\n\t\tipalisig2 as string,\n\t\tipaludate as timestamp,\n\t\tipalusign as string,\n\t\tipamaninsynsw as string,\n\t\tipamarketripercentage as decimal(38,18),\n\t\tipaminprem as decimal(38,18),\n\t\tipaminrate as decimal(38,18),\n\t\tipanatpre as decimal(38,18),\n\t\tipanetamtp as decimal(38,18),\n\t\tipanetprem as decimal(38,18),\n\t\tipanote as string,\n\t\tipanoterm as decimal(38,18),\n\t\tipaobno as decimal(38,18),\n\t\tipaorate as decimal(38,18),\n\t\tipaotherexpences as decimal(38,18),\n\t\tipaousdgt as decimal(38,18),\n\t\tipapcdtxt as string,\n\t\tipapcod2 as string,\n\t\tipapcode as string,\n\t\tipapdays as decimal(38,18),\n\t\tipapocid as string,\n\t\tipapocprtln3 as decimal(38,18),\n\t\tipapolnn19 as string,\n\t\tipapoolpercentage as decimal(38,18),\n\t\tipapremn3 as decimal(38,18),\n\t\tipapremri as string,\n\t\tipaprfcomamtp as decimal(38,18),\n\t\tipaprfcombase as decimal(38,18),\n\t\tipaprfcomp as decimal(38,18),\n\t\tipaprocomamtp as decimal(38,18),\n\t\tipaprocombase as decimal(38,18),\n\t\tipaprocomp as decimal(38,18),\n\t\tiparate as decimal(38,18),\n\t\tiparatype as string,\n\t\tiparelcallamtp as decimal(38,18),\n\t\tiparelcallperc as decimal(38,18),\n\t\tipareopenipaid as string,\n\t\tiparesig1 as decimal(38,18),\n\t\tiparesig2 as decimal(38,18),\n\t\tiparetndisc as decimal(38,18),\n\t\tiparetynsw as string,\n\t\tiparicalcdate as timestamp,\n\t\tiparipercentage as decimal(38,18),\n\t\tiparistor as decimal(38,18),\n\t\tiparoundrule as string,\n\t\tipasecrebamtp as decimal(38,18),\n\t\tipasecrebbase as decimal(38,18),\n\t\tipasecrebp as decimal(38,18),\n\t\tipaslipsw as string,\n\t\tipastdate as timestamp,\n\t\tipasthour as decimal(38,18),\n\t\tipatarifamt as decimal(38,18),\n\t\tipatarifndisc as decimal(38,18),\n\t\tipataxamt as decimal(38,18),\n\t\tipataxgnsw as decimal(38,18),\n\t\tipatxcom as decimal(38,18),\n\t\tipatxcomc as decimal(38,18),\n\t\tipavalueicaid as string,\n\t\tipavalueipaid as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> ipa\nipa select(mapColumn(\n\t\tipaipaid,\n\t\tipapcode,\n\t\tipapcod2\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ipatcode\nipatcode derive(Pty_Code = iif( upper(trim(ipapcod2)) == 'XB','SMD',\r\n    iif(upper(trim(ipapcod2)) == 'XP','AJD',\r\n         iif(upper(trim(ipapcod2)) == 'XR','SRE',\r\n             iif(upper(trim(ipapcod2)) == 'XM','SMD',\r\n             iif(upper(trim(ipapcod2)) == 'XX','SMD',\r\n             iif(upper(trim(ipapcode)) == 'A','GAD',\r\n             iif(upper(trim(ipapcod2)) == 'C','CAN',\r\n             iif(upper(trim(ipapcod2)) == 'F','OTH',\r\n             iif(upper(trim(ipapcod2)) == 'G','GER',\r\n             iif(upper(trim(ipapcod2)) == 'L','LAY',\r\n             iif(upper(trim(ipapcod2)) == 'O','ORG',\r\n             iif(upper(trim(ipapcod2)) == 'P','PRO',\r\n             iif(upper(trim(ipapcod2)) == 'Q','OTH',\r\n             iif(upper(trim(ipapcod2)) == 'R','RVA',\r\n             iif(upper(trim(ipapcod2)) == 'S','SAL',\r\n             iif(upper(trim(ipapcod2)) == 'T','TRI',\r\n             iif(upper(trim(ipapcod2)) == 'X','OTH',\r\n                'N/A'\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                )\r\n            )\r\n        )\r\n     ),\n\t\tPty_Description = iif( upper(trim(ipapcod2)) == 'XB','Minimum & Deposit',\r\n    iif(upper(trim(ipapcod2)) == 'XP','Adjustment Premium',\r\n         iif(upper(trim(ipapcod2)) == 'XR','Reinstatement Premium',\r\n         iif(upper(trim(ipapcod2)) == 'XM','Minimum & Deposit',\r\n         iif(upper(trim(ipapcod2)) == 'XX','Minimum & Deposit',\r\n         iif(upper(trim(ipapcode)) == 'A','General Add',\r\n         iif(upper(trim(ipapcod2)) == 'C','Cancel',\r\n         iif(upper(trim(ipapcod2)) == 'F','Other',\r\n         iif(upper(trim(ipapcod2)) == 'G','General Return',\r\n         iif(upper(trim(ipapcod2)) == 'L','Layup',\r\n         iif(upper(trim(ipapcod2)) == 'O','Original',\r\n         iif(upper(trim(ipapcod2)) == 'P','Prolongation',\r\n         iif(upper(trim(ipapcod2)) == 'Q','Other',\r\n         iif(upper(trim(ipapcod2)) == 'R','Return Value',\r\n         iif(upper(trim(ipapcod2)) == 'S','Sale/Stop',\r\n         iif(upper(trim(ipapcod2)) == 'T','Trip',\r\n         iif(upper(trim(ipapcod2)) == 'X','Other',\r\n                'Not Applicable'\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                    )\r\n                )\r\n            )\r\n        )\r\n     ),\n\t\tPty_Source_code = case(in(['XB','XP','XR','XM','XX'],trim(upper(ipapcod2))),ipapcod2,ipapcode),\n\t\tSource_column = case(in(['XB','XP','XR','XM','XX'],trim(upper(ipapcod2))),'ipapcod2','ipapcode'),\n\t\tSource_System = 'PARIS',\n\t\tDate_inserted = currentDate(),\n\t\tDate_Last_Updated = currentDate(),\n\t\tInserted_By = 'M_PRE_DIM_PREMIUM_TYPE_ME',\n\t\tLast_Updated_by = 'M_PRE_DIM_PREMIUM_TYPE_ME',\n\t\tMap_date = toDate(case(1!=1,1))) ~> ipatable\nipatable sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_premium_type.parquet'],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> predimpremtype"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/m_pre_dim_source_system')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"folder": {
					"name": "dwh_prepare/pre_dim"
				},
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Oltp05",
								"type": "DatasetReference"
							},
							"name": "StaSourceSystem"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "pre_dim_source_system",
								"type": "DatasetReference"
							},
							"name": "preDimSourceSystem"
						}
					],
					"transformations": [
						{
							"name": "RemoveUnusedColumns"
						},
						{
							"name": "NotApplicable"
						},
						{
							"name": "NotApplicableRow"
						},
						{
							"name": "UnionWithNotApplicable"
						},
						{
							"name": "LastUpdatedBy"
						},
						{
							"name": "AlterRow"
						}
					],
					"script": "source(output(\n\t\tactive as string,\n\t\tdescription as string,\n\t\tinserted_by as string,\n\t\tinserted_date as timestamp,\n\t\tpk_source_system as string,\n\t\tupdated_by as string,\n\t\tupdated_date as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> StaSourceSystem\nStaSourceSystem select(mapColumn(\n\t\tactive,\n\t\tdescription,\n\t\tpk_source_system\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveUnusedColumns\nRemoveUnusedColumns derive(pk_source_system = 'N/A',\n\t\tdescription = 'Not Applicable') ~> NotApplicable\nNotApplicable aggregate(groupBy(pk_source_system),\n\tdescription = first(description)) ~> NotApplicableRow\nRemoveUnusedColumns, NotApplicableRow union(byName: true)~> UnionWithNotApplicable\nUnionWithNotApplicable derive(last_updated_by = 'm_pre_dim_source_system') ~> LastUpdatedBy\nLastUpdatedBy alterRow(upsertIf(!isNull(pk_source_system))) ~> AlterRow\nAlterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_source_system.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> preDimSourceSystem"
				}
			},
			"dependsOn": []
		}
	]
}