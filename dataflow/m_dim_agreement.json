{
	"name": "m_dim_agreement",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "pre_dim_agreement",
						"type": "DatasetReference"
					},
					"name": "PreDimAgreement"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "dim_agreement",
						"type": "DatasetReference"
					},
					"name": "DimAgreement"
				}
			],
			"transformations": [
				{
					"name": "Aggregate1"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "ExtraColumns"
				}
			],
			"script": "source(output(\n\t\tpk_key as string,\n\t\tagr_sf_client_lost_reason as string,\n\t\tagr_sf_company_name_broker as string,\n\t\tagr_def_clhandl_casualty_pri as string,\n\t\tagr_sf_company_owner as string,\n\t\tagr_uw_description as string,\n\t\tagr_dummy_ind as string,\n\t\tagr_market_area_desc as string,\n\t\tagr_agreement_type_detail_code as string,\n\t\tagr_abatement_usd as decimal(28,10),\n\t\tgic_cover_request_id as decimal(28,10),\n\t\tagr_sf_company_name_client as string,\n\t\tgic_small_craft_ind as decimal(28,10),\n\t\tagr_date_end as date,\n\t\tagr_agreement_type_detail_desc as string,\n\t\tagr_main_vessel_type_code as string,\n\t\tagr_def_clhandl_defence_pri as string,\n\t\tagr_def_clhandl_defence_sec as string,\n\t\tagr_main_vessel_type_desc as string,\n\t\tagr_uw_assist_team_desc as string,\n\t\tagr_market_area_short_desc as string,\n\t\tagr_date_established as date,\n\t\tagr_def_clhandl_environm_sec as string,\n\t\tagr_sf_market_area_desc as string,\n\t\tagr_uw_year as string,\n\t\tagr_order_code as string,\n\t\tinserted_by as string,\n\t\tagr_sf_top_group_broker_id as decimal(28,10),\n\t\tagr_sf_company_id as decimal(28,10),\n\t\tagr_est_premium_org as decimal(28,10),\n\t\tagr_def_clhndl_pi_crew_pri as string,\n\t\tlast_updated_by as string,\n\t\tagr_uw_code as string,\n\t\tagr_reference as string,\n\t\tagr_internal_note as string,\n\t\tagr_main_office_ind as string,\n\t\tagr_abatement_stat as decimal(28,10),\n\t\tdate_inserted as timestamp,\n\t\tagr_resp_uw_desc as string,\n\t\tagr_sf_market_area_short_desc as string,\n\t\tagr_def_clhndl_dry_cargo_sec as string,\n\t\tagr_club_retention_stat as decimal(28,10),\n\t\tagr_uw_assist_description as string,\n\t\tagr_market_segment_code as string,\n\t\tagr_sf_market_area_code as string,\n\t\tagr_def_clhndl_pi_crew_sec as string,\n\t\tagr_uw_assist_code as string,\n\t\tagr_sf_key as string,\n\t\tdate_last_updated as timestamp,\n\t\tagr_club_retention as decimal(28,10),\n\t\tagr_sf_top_group_broker as string,\n\t\tagr_est_total_gross_ton as decimal(28,10),\n\t\tagr_uw_assist_team_code as string,\n\t\tagr_resp_uw_code as string,\n\t\tagr_def_clhandl_casualty_sec as string,\n\t\tagr_sf_company_broker_id as decimal(28,10),\n\t\tagr_sf_top_group_client as string,\n\t\tagr_uw_year_days as decimal(28,10),\n\t\tagr_market_segment_split_code as string,\n\t\tagr_def_clhandl_liquid_ca_pri as string,\n\t\tagr_market_segm_cnt_grp_code as string,\n\t\toffice as string,\n\t\tagr_def_claim_adjuster as string,\n\t\tagr_market_segment as string,\n\t\tcharterers_trad_clm_team_ind as string,\n\t\tagr_market_segm_cnt_grp_sort as string,\n\t\tagr_est_premium_currency_code as string,\n\t\tagr_def_clhandl_environm_pri as string,\n\t\tagr_market_segm_country_group as string,\n\t\tagr_ext_adjuster_ind as string,\n\t\tagr_def_claims_handler_paris as string,\n\t\tagr_member_number as decimal(28,10),\n\t\tagr_date_start as date,\n\t\tagr_market_segment_split as string,\n\t\tagr_market_area_sort as string,\n\t\tagr_def_clhndl_dry_cargo_pri as string,\n\t\tagr_agreement_name as string,\n\t\tagr_def_clhandl_liquid_ca_sec as string,\n\t\tagr_sf_top_group_client_id as decimal(28,10),\n\t\tagr_market_area_code as string,\n\t\tagr_est_number_of_objects as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'select * from dwh_prepare.pre_dim_agreement',\n\tformat: 'query') ~> PreDimAgreement\nPreDimAgreement aggregate(groupBy(pk_key),\n\teach(match(name!='pk_key'), $$ = max($$))) ~> Aggregate1\nExtraColumns alterRow(upsertIf(true())) ~> AlterRow1\nAggregate1 derive(top_description = 'All Agreements',\n\t\tagr_uw_year = toInteger(agr_uw_year)) ~> ExtraColumns\nAlterRow1 sink(input(\n\t\tdimension_key as long,\n\t\tagr_clm_hdl_defence as string,\n\t\tagr_clm_hdl_mande as string,\n\t\tagr_market_area_short_desc as string,\n\t\tagr_agreement_type_detail_code as string,\n\t\tagr_main_office_ind as string,\n\t\tagr_est_premium_currency_code as string,\n\t\tagr_resp_uw_code as string,\n\t\tagr_agreement_name as string,\n\t\tagr_clm_hdl_environmental as string,\n\t\tagr_agreement_type_detail_desc as string,\n\t\tagr_sf_top_group_client as string,\n\t\tagr_market_area_sort as string,\n\t\tagr_office as string,\n\t\tagr_market_segment_split_code as string,\n\t\ttop_description as string,\n\t\tagr_sf_key as string,\n\t\tagr_sf_top_group_client_id as long,\n\t\tagr_market_segment_split as string,\n\t\tagr_club_retention_stat as decimal(28,10),\n\t\tagr_market_area_code as string,\n\t\tagr_est_premium_org as decimal(28,10),\n\t\tagr_uw_assist_code as string,\n\t\tagr_sf_market_area_desc as string,\n\t\tagr_date_end as date,\n\t\tagr_member_number as decimal(28,10),\n\t\tagr_clm_adjuster as string,\n\t\tagr_market_segm_cnt_grp_code as string,\n\t\ttop_key as string,\n\t\tagr_market_segm_cnt_grp_sort as string,\n\t\tagr_sf_company_name_client as string,\n\t\tagr_clm_hdl_cargo_dry as string,\n\t\tagr_main_vessel_type_desc as string,\n\t\tagr_dummy_ind as string,\n\t\tagr_uw_year_days as integer,\n\t\tagr_market_area_desc as string,\n\t\tagr_clm_hdl_pers_inj_and_crew as string,\n\t\tagr_ext_adjuster_ind as string,\n\t\tagr_order_code as string,\n\t\tagr_sf_top_group_broker as string,\n\t\tagr_sf_company_broker_id as long,\n\t\tagr_sf_company_owner as string,\n\t\tagr_abatement_usd as decimal(28,10),\n\t\tagr_abatement_stat as decimal(28,10),\n\t\tagr_date_start as date,\n\t\tagr_uw_assist_team_code as string,\n\t\ttop_id as long,\n\t\tagr_market_segment_code as string,\n\t\tcharterers_trad_clm_team_ind as string,\n\t\tagr_uw_assist_team_desc as string,\n\t\tagr_sf_market_area_short_desc as string,\n\t\tagr_id as long,\n\t\tagr_key as string,\n\t\tagr_uw_code as string,\n\t\tagr_sf_top_group_broker_id as long,\n\t\tagr_clm_hdl_cargo_liquid as string,\n\t\tagr_sf_client_lost_reason as string,\n\t\tagr_uw_description as string,\n\t\tagr_sf_company_name_broker as string,\n\t\tagr_uw_assist_description as string,\n\t\tagr_sf_market_area_code as string,\n\t\tagr_est_total_gross_ton as decimal(28,10),\n\t\tagr_internal_note as string,\n\t\tagr_main_vessel_type_code as string,\n\t\tagr_club_retention as decimal(28,10),\n\t\tagr_market_segment as string,\n\t\tagr_market_segm_country_group as string,\n\t\tagr_sf_company_id as long,\n\t\tagr_date_established as date,\n\t\tagr_clm_hdl_casualty_and_prop as string,\n\t\tagr_resp_uw_desc as string,\n\t\tagr_uw_year as integer,\n\t\tagr_reference as string,\n\t\tagr_est_number_of_objects as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['pk_key'],\n\tformat: 'table',\n\tmapColumn(\n\t\tagr_market_area_short_desc,\n\t\tagr_agreement_type_detail_code,\n\t\tagr_main_office_ind,\n\t\tagr_est_premium_currency_code,\n\t\tagr_resp_uw_code,\n\t\tagr_agreement_name,\n\t\tagr_agreement_type_detail_desc,\n\t\tagr_sf_top_group_client,\n\t\tagr_market_area_sort,\n\t\tagr_office = office,\n\t\tagr_market_segment_split_code,\n\t\ttop_description,\n\t\tagr_sf_key,\n\t\tagr_sf_top_group_client_id,\n\t\tagr_market_segment_split,\n\t\tagr_club_retention_stat,\n\t\tagr_market_area_code,\n\t\tagr_est_premium_org,\n\t\tagr_uw_assist_code,\n\t\tagr_sf_market_area_desc,\n\t\tagr_date_end,\n\t\tagr_member_number,\n\t\tagr_market_segm_cnt_grp_code,\n\t\tagr_market_segm_cnt_grp_sort,\n\t\tagr_sf_company_name_client,\n\t\tagr_main_vessel_type_desc,\n\t\tagr_dummy_ind,\n\t\tagr_uw_year_days,\n\t\tagr_market_area_desc,\n\t\tagr_ext_adjuster_ind,\n\t\tagr_order_code,\n\t\tagr_sf_top_group_broker,\n\t\tagr_sf_company_broker_id,\n\t\tagr_sf_company_owner,\n\t\tagr_abatement_usd,\n\t\tagr_abatement_stat,\n\t\tagr_date_start,\n\t\tagr_uw_assist_team_code,\n\t\tagr_market_segment_code,\n\t\tcharterers_trad_clm_team_ind,\n\t\tagr_uw_assist_team_desc,\n\t\tagr_sf_market_area_short_desc,\n\t\tagr_key = pk_key,\n\t\tagr_uw_code,\n\t\tagr_sf_top_group_broker_id,\n\t\tagr_sf_client_lost_reason,\n\t\tagr_uw_description,\n\t\tagr_sf_company_name_broker,\n\t\tagr_uw_assist_description,\n\t\tagr_sf_market_area_code,\n\t\tagr_est_total_gross_ton,\n\t\tagr_internal_note,\n\t\tagr_main_vessel_type_code,\n\t\tagr_club_retention,\n\t\tagr_market_segment,\n\t\tagr_market_segm_country_group,\n\t\tagr_sf_company_id,\n\t\tagr_date_established,\n\t\tagr_resp_uw_desc,\n\t\tagr_uw_year,\n\t\tagr_reference,\n\t\tagr_est_number_of_objects\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimAgreement"
		}
	}
}