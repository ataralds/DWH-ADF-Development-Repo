{
	"name": "m_dim_agreement",
	"properties": {
		"folder": {
			"name": "marts"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "pre_dim_agreement",
						"type": "DatasetReference"
					},
					"name": "PreDimAgreement"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "dim_agreement",
						"type": "DatasetReference"
					},
					"name": "DimAgreement"
				}
			],
			"transformations": [
				{
					"name": "Aggregate1"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "ExtraColumns"
				},
				{
					"name": "Select1"
				}
			],
			"script": "source(output(\n\t\tpk_key as string,\n\t\tagr_sf_client_lost_reason as string,\n\t\tagr_sf_company_name_broker as string,\n\t\tagr_def_clhandl_casualty_pri as string,\n\t\tagr_sf_company_owner as string,\n\t\tagr_uw_description as string,\n\t\tagr_dummy_ind as string,\n\t\tagr_market_area_desc as string,\n\t\tagr_agreement_type_detail_code as string,\n\t\tagr_abatement_usd as decimal(28,10),\n\t\tagr_sf_company_name_client as string,\n\t\tagr_date_end as date,\n\t\tagr_agreement_type_detail_desc as string,\n\t\tagr_main_vessel_type_code as string,\n\t\tagr_def_clhandl_defence_pri as string,\n\t\tagr_def_clhandl_defence_sec as string,\n\t\tagr_main_vessel_type_desc as string,\n\t\tagr_uw_assist_team_desc as string,\n\t\tagr_market_area_short_desc as string,\n\t\tagr_date_established as date,\n\t\tagr_sf_market_area_desc as string,\n\t\tagr_uw_year as string,\n\t\tagr_order_code as string,\n\t\tagr_sf_top_group_broker_id as decimal(28,10),\n\t\tagr_sf_company_id as decimal(28,10),\n\t\tagr_est_premium_org as decimal(28,10),\n\t\tagr_def_clhndl_pi_crew_pri as string,\n\t\tagr_uw_code as string,\n\t\tagr_reference as string,\n\t\tagr_internal_note as string,\n\t\tagr_main_office_ind as string,\n\t\tagr_abatement_stat as decimal(28,10),\n\t\tdate_inserted as timestamp,\n\t\tagr_resp_uw_desc as string,\n\t\tagr_sf_market_area_short_desc as string,\n\t\tagr_club_retention_stat as decimal(28,10),\n\t\tagr_uw_assist_description as string,\n\t\tagr_market_segment_code as string,\n\t\tagr_sf_market_area_code as string,\n\t\tagr_uw_assist_code as string,\n\t\tagr_sf_key as string,\n\t\tagr_club_retention as decimal(28,10),\n\t\tagr_sf_top_group_broker as string,\n\t\tagr_est_total_gross_ton as decimal(28,10),\n\t\tagr_uw_assist_team_code as string,\n\t\tagr_resp_uw_code as string,\n\t\tagr_sf_company_broker_id as decimal(28,10),\n\t\tagr_sf_top_group_client as string,\n\t\tagr_uw_year_days as decimal(28,10),\n\t\tagr_market_segment_split_code as string,\n\t\tagr_def_clhandl_liquid_ca_pri as string,\n\t\tagr_market_segm_cnt_grp_code as string,\n\t\toffice as string,\n\t\tagr_def_claim_adjuster as string,\n\t\tagr_market_segment as string,\n\t\tcharterers_trad_clm_team_ind as string,\n\t\tagr_market_segm_cnt_grp_sort as string,\n\t\tagr_est_premium_currency_code as string,\n\t\tagr_def_clhandl_environm_pri as string,\n\t\tagr_market_segm_country_group as string,\n\t\tagr_ext_adjuster_ind as string,\n\t\tagr_def_claims_handler_paris as string,\n\t\tagr_member_number as decimal(28,10),\n\t\tagr_date_start as date,\n\t\tagr_market_segment_split as string,\n\t\tagr_market_area_sort as string,\n\t\tagr_def_clhndl_dry_cargo_pri as string,\n\t\tagr_agreement_name as string,\n\t\tagr_sf_top_group_client_id as decimal(28,10),\n\t\tagr_market_area_code as string,\n\t\tagr_est_number_of_objects as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'SELECT [pk_key]\\n      ,[agr_sf_client_lost_reason]\\n      ,[agr_sf_company_name_broker]\\n      ,[agr_def_clhandl_casualty_pri]\\n      ,[agr_sf_company_owner]\\n      ,[agr_uw_description]\\n      ,[agr_dummy_ind]\\n      ,[agr_market_area_desc]\\n      ,[agr_agreement_type_detail_code]\\n      ,[agr_abatement_usd]\\n      ,[agr_sf_company_name_client]\\n      ,[agr_date_end]\\n      ,[agr_agreement_type_detail_desc]\\n      ,[agr_main_vessel_type_code]\\n      ,[agr_def_clhandl_defence_pri]\\n      ,[agr_def_clhandl_defence_sec]\\n      ,[agr_main_vessel_type_desc]\\n      ,[agr_uw_assist_team_desc]\\n      ,[agr_market_area_short_desc]\\n      ,[agr_date_established]\\n      ,[agr_sf_market_area_desc]\\n      ,[agr_uw_year]\\n      ,[agr_order_code]\\n      ,[agr_sf_top_group_broker_id]\\n      ,[agr_sf_company_id]\\n      ,[agr_est_premium_org]\\n      ,[agr_def_clhndl_pi_crew_pri]\\n      ,[agr_uw_code]\\n      ,[agr_reference]\\n      ,[agr_internal_note]\\n      ,[agr_main_office_ind]\\n      ,[agr_abatement_stat]\\n      ,[date_inserted]\\n      ,[agr_resp_uw_desc]\\n      ,[agr_sf_market_area_short_desc]\\n      ,[agr_club_retention_stat]\\n      ,[agr_uw_assist_description]\\n      ,[agr_market_segment_code]\\n      ,[agr_sf_market_area_code]\\n      ,[agr_uw_assist_code]\\n      ,[agr_sf_key]\\n      ,[agr_club_retention]\\n      ,[agr_sf_top_group_broker]\\n      ,[agr_est_total_gross_ton]\\n      ,[agr_uw_assist_team_code]\\n      ,[agr_resp_uw_code]\\n      ,[agr_sf_company_broker_id]\\n      ,[agr_sf_top_group_client]\\n      ,[agr_uw_year_days]\\n      ,[agr_market_segment_split_code]\\n      ,[agr_def_clhandl_liquid_ca_pri]\\n      ,[agr_market_segm_cnt_grp_code]\\n      ,[office]\\n      ,[agr_def_claim_adjuster]\\n      ,[agr_market_segment]\\n      ,[charterers_trad_clm_team_ind]\\n      ,[agr_market_segm_cnt_grp_sort]\\n      ,[agr_est_premium_currency_code]\\n      ,[agr_def_clhandl_environm_pri]\\n      ,[agr_market_segm_country_group]\\n      ,[agr_ext_adjuster_ind]\\n      ,[agr_def_claims_handler_paris]\\n      ,[agr_member_number]\\n      ,[agr_date_start]\\n      ,[agr_market_segment_split]\\n      ,[agr_market_area_sort]\\n      ,[agr_def_clhndl_dry_cargo_pri]\\n      ,[agr_agreement_name]\\n      ,[agr_sf_top_group_client_id]\\n      ,[agr_market_area_code]\\n      ,[agr_est_number_of_objects]\\n  FROM [dwh_prepare].[pre_dim_agreement]',\n\tformat: 'query') ~> PreDimAgreement\nPreDimAgreement aggregate(groupBy(pk_key),\n\teach(match(name!='pk_key'), $$ = max($$))) ~> Aggregate1\nSelect1 alterRow(upsertIf(true())) ~> AlterRow1\nAggregate1 derive(top_description = 'All Agreements',\n\t\tagr_uw_year = toInteger(agr_uw_year),\n\t\ttop_key = 'ALL',\n\t\tagr_sf_top_group_client_id = toInteger(agr_sf_top_group_client_id),\n\t\tagr_uw_year_days = toInteger(agr_uw_year_days),\n\t\tagr_sf_company_broker_id = toInteger(agr_sf_company_broker_id),\n\t\tagr_sf_top_group_broker_id = toInteger(agr_sf_top_group_broker_id),\n\t\tagr_sf_company_id = toInteger(agr_sf_company_id)) ~> ExtraColumns\nExtraColumns select(mapColumn(\n\t\tagr_key = pk_key,\n\t\tagr_sf_client_lost_reason,\n\t\tagr_sf_company_name_broker,\n\t\tagr_clm_hdl_casualty_and_prop = agr_def_clhandl_casualty_pri,\n\t\tagr_sf_company_owner,\n\t\tagr_uw_description,\n\t\tagr_dummy_ind,\n\t\tagr_market_area_desc,\n\t\tagr_agreement_type_detail_code,\n\t\tagr_abatement_usd,\n\t\tagr_sf_company_name_client,\n\t\tagr_date_end,\n\t\tagr_agreement_type_detail_desc,\n\t\tagr_main_vessel_type_code,\n\t\tagr_clm_hdl_defence = agr_def_clhandl_defence_pri,\n\t\tagr_main_vessel_type_desc,\n\t\tagr_uw_assist_team_desc,\n\t\tagr_market_area_short_desc,\n\t\tagr_date_established,\n\t\tagr_sf_market_area_desc,\n\t\tagr_uw_year,\n\t\tagr_order_code,\n\t\tagr_sf_top_group_broker_id,\n\t\tagr_sf_company_id,\n\t\tagr_est_premium_org,\n\t\tagr_clm_hdl_pers_inj_and_crew = agr_def_clhndl_pi_crew_pri,\n\t\tagr_uw_code,\n\t\tagr_reference,\n\t\tagr_internal_note,\n\t\tagr_main_office_ind,\n\t\tagr_abatement_stat,\n\t\tdate_inserted,\n\t\tagr_resp_uw_desc,\n\t\tagr_sf_market_area_short_desc,\n\t\tagr_club_retention_stat,\n\t\tagr_uw_assist_description,\n\t\tagr_market_segment_code,\n\t\tagr_sf_market_area_code,\n\t\tagr_uw_assist_code,\n\t\tagr_sf_key,\n\t\tagr_club_retention,\n\t\tagr_sf_top_group_broker,\n\t\tagr_est_total_gross_ton,\n\t\tagr_uw_assist_team_code,\n\t\tagr_resp_uw_code,\n\t\tagr_sf_company_broker_id,\n\t\tagr_sf_top_group_client,\n\t\tagr_uw_year_days,\n\t\tagr_market_segment_split_code,\n\t\tagr_clm_hdl_cargo_liquid = agr_def_clhandl_liquid_ca_pri,\n\t\tagr_market_segm_cnt_grp_code,\n\t\tagr_office = office,\n\t\tagr_clm_adjuster = agr_def_claim_adjuster,\n\t\tagr_market_segment,\n\t\tcharterers_trad_clm_team_ind,\n\t\tagr_market_segm_cnt_grp_sort,\n\t\tagr_est_premium_currency_code,\n\t\tagr_clm_hdl_environmental = agr_def_clhandl_environm_pri,\n\t\tagr_market_segm_country_group,\n\t\tagr_ext_adjuster_ind,\n\t\tagr_clm_hdl_paris = agr_def_claims_handler_paris,\n\t\tagr_member_number,\n\t\tagr_date_start,\n\t\tagr_market_segment_split,\n\t\tagr_market_area_sort,\n\t\tagr_clm_hdl_cargo_dry = agr_def_clhndl_dry_cargo_pri,\n\t\tagr_agreement_name,\n\t\tagr_sf_top_group_client_id,\n\t\tagr_market_area_code,\n\t\tagr_est_number_of_objects,\n\t\ttop_description,\n\t\ttop_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nAlterRow1 sink(input(\n\t\tdimension_key as long,\n\t\tagr_clm_hdl_defence as string,\n\t\tagr_clm_hdl_paris as string,\n\t\tagr_market_area_short_desc as string,\n\t\tagr_agreement_type_detail_code as string,\n\t\tagr_main_office_ind as string,\n\t\tagr_est_premium_currency_code as string,\n\t\tagr_resp_uw_code as string,\n\t\tagr_agreement_name as string,\n\t\tagr_clm_hdl_environmental as string,\n\t\tagr_agreement_type_detail_desc as string,\n\t\tagr_sf_top_group_client as string,\n\t\tagr_market_area_sort as string,\n\t\tagr_office as string,\n\t\tagr_market_segment_split_code as string,\n\t\ttop_description as string,\n\t\tagr_sf_key as string,\n\t\tagr_sf_top_group_client_id as long,\n\t\tagr_market_segment_split as string,\n\t\tagr_club_retention_stat as decimal(28,10),\n\t\tagr_market_area_code as string,\n\t\tagr_est_premium_org as decimal(28,10),\n\t\tagr_uw_assist_code as string,\n\t\tagr_sf_market_area_desc as string,\n\t\tagr_date_end as date,\n\t\tagr_member_number as decimal(28,10),\n\t\tagr_clm_adjuster as string,\n\t\tagr_market_segm_cnt_grp_code as string,\n\t\ttop_key as string,\n\t\tagr_market_segm_cnt_grp_sort as string,\n\t\tagr_sf_company_name_client as string,\n\t\tagr_clm_hdl_cargo_dry as string,\n\t\tagr_main_vessel_type_desc as string,\n\t\tagr_dummy_ind as string,\n\t\tagr_uw_year_days as integer,\n\t\tagr_market_area_desc as string,\n\t\tagr_clm_hdl_pers_inj_and_crew as string,\n\t\tagr_ext_adjuster_ind as string,\n\t\tagr_order_code as string,\n\t\tagr_sf_top_group_broker as string,\n\t\tagr_sf_company_broker_id as long,\n\t\tagr_sf_company_owner as string,\n\t\tagr_abatement_usd as decimal(28,10),\n\t\tagr_abatement_stat as decimal(28,10),\n\t\tagr_date_start as date,\n\t\tagr_uw_assist_team_code as string,\n\t\ttop_id as long,\n\t\tagr_market_segment_code as string,\n\t\tcharterers_trad_clm_team_ind as string,\n\t\tagr_uw_assist_team_desc as string,\n\t\tagr_sf_market_area_short_desc as string,\n\t\tagr_id as long,\n\t\tagr_key as string,\n\t\tagr_uw_code as string,\n\t\tagr_sf_top_group_broker_id as long,\n\t\tagr_clm_hdl_cargo_liquid as string,\n\t\tagr_sf_client_lost_reason as string,\n\t\tagr_uw_description as string,\n\t\tagr_sf_company_name_broker as string,\n\t\tagr_uw_assist_description as string,\n\t\tagr_sf_market_area_code as string,\n\t\tagr_est_total_gross_ton as decimal(28,10),\n\t\tagr_internal_note as string,\n\t\tagr_main_vessel_type_code as string,\n\t\tagr_club_retention as decimal(28,10),\n\t\tagr_market_segment as string,\n\t\tagr_market_segm_country_group as string,\n\t\tagr_sf_company_id as long,\n\t\tagr_date_established as date,\n\t\tagr_clm_hdl_casualty_and_prop as string,\n\t\tagr_resp_uw_desc as string,\n\t\tagr_uw_year as integer,\n\t\tagr_reference as string,\n\t\tagr_est_number_of_objects as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['agr_key'],\n\tformat: 'table',\n\tmapColumn(\n\t\tagr_clm_hdl_defence,\n\t\tagr_clm_hdl_paris,\n\t\tagr_market_area_short_desc,\n\t\tagr_agreement_type_detail_code,\n\t\tagr_main_office_ind,\n\t\tagr_est_premium_currency_code,\n\t\tagr_resp_uw_code,\n\t\tagr_agreement_name,\n\t\tagr_clm_hdl_environmental,\n\t\tagr_agreement_type_detail_desc,\n\t\tagr_sf_top_group_client,\n\t\tagr_market_area_sort,\n\t\tagr_office,\n\t\tagr_market_segment_split_code,\n\t\ttop_description,\n\t\tagr_sf_key,\n\t\tagr_sf_top_group_client_id,\n\t\tagr_market_segment_split,\n\t\tagr_club_retention_stat,\n\t\tagr_market_area_code,\n\t\tagr_est_premium_org,\n\t\tagr_uw_assist_code,\n\t\tagr_sf_market_area_desc,\n\t\tagr_date_end,\n\t\tagr_member_number,\n\t\tagr_clm_adjuster,\n\t\tagr_market_segm_cnt_grp_code,\n\t\ttop_key,\n\t\tagr_market_segm_cnt_grp_sort,\n\t\tagr_sf_company_name_client,\n\t\tagr_clm_hdl_cargo_dry,\n\t\tagr_main_vessel_type_desc,\n\t\tagr_dummy_ind,\n\t\tagr_uw_year_days,\n\t\tagr_market_area_desc,\n\t\tagr_clm_hdl_pers_inj_and_crew,\n\t\tagr_ext_adjuster_ind,\n\t\tagr_order_code,\n\t\tagr_sf_top_group_broker,\n\t\tagr_sf_company_broker_id,\n\t\tagr_sf_company_owner,\n\t\tagr_abatement_usd,\n\t\tagr_abatement_stat,\n\t\tagr_date_start,\n\t\tagr_uw_assist_team_code,\n\t\tagr_market_segment_code,\n\t\tcharterers_trad_clm_team_ind,\n\t\tagr_uw_assist_team_desc,\n\t\tagr_sf_market_area_short_desc,\n\t\tagr_key,\n\t\tagr_uw_code,\n\t\tagr_sf_top_group_broker_id,\n\t\tagr_clm_hdl_cargo_liquid,\n\t\tagr_sf_client_lost_reason,\n\t\tagr_uw_description,\n\t\tagr_sf_company_name_broker,\n\t\tagr_uw_assist_description,\n\t\tagr_sf_market_area_code,\n\t\tagr_est_total_gross_ton,\n\t\tagr_internal_note,\n\t\tagr_main_vessel_type_code,\n\t\tagr_club_retention,\n\t\tagr_market_segment,\n\t\tagr_market_segm_country_group,\n\t\tagr_sf_company_id,\n\t\tagr_date_established,\n\t\tagr_clm_hdl_casualty_and_prop,\n\t\tagr_resp_uw_desc,\n\t\tagr_uw_year,\n\t\tagr_reference,\n\t\tagr_est_number_of_objects\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimAgreement"
		}
	}
}