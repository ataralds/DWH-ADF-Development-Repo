{
	"name": "m_dim_incident",
	"properties": {
		"folder": {
			"name": "marts/dim"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "azure_sql_server",
						"type": "DatasetReference"
					},
					"name": "preDimIncidentPa"
				},
				{
					"dataset": {
						"referenceName": "azure_sql_server",
						"type": "DatasetReference"
					},
					"name": "dimEmployee"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "dim_incident",
						"type": "DatasetReference"
					},
					"name": "dimIncident"
				}
			],
			"transformations": [
				{
					"name": "DeriveColumns"
				},
				{
					"name": "AlterRow1"
				},
				{
					"name": "claimHandler"
				},
				{
					"name": "claimAdjuster"
				}
			],
			"script": "source(output(\n\t\tpk_key_inc as string,\n\t\tinc_retention as decimal(28,10),\n\t\tinc_gic_incident_id as decimal(28,10),\n\t\tinc_mygard_claim_id as string,\n\t\tinc_date_archive as date,\n\t\tinc_deleted_ind as string,\n\t\tinc_year_of_registered as decimal(28,10),\n\t\tinc_ind_open as string,\n\t\tinc_reg_in_paris_pool_ind as string,\n\t\tinc_claim_process_desc as string,\n\t\tgrp_text as string,\n\t\tinc_team_description as string,\n\t\tinc_longitude as decimal(28,10),\n\t\tdate_last_updated as timestamp,\n\t\tinc_voyage_to as string,\n\t\tinc_ded_used_text_1 as string,\n\t\tinc_registered_by_desc as string,\n\t\tinc_ded_used_amount_2 as decimal(28,10),\n\t\tbest_value_estimate as decimal(28,10),\n\t\tinc_vessel_name as string,\n\t\tinc_yearmonth_of_registered as decimal(28,10),\n\t\tinc_reserve_created_by_desc as string,\n\t\tinc_text_restricted as string,\n\t\tinc_claim_adjuster_desc as string,\n\t\tgrp_description as string,\n\t\tinc_gard_claim_id as string,\n\t\tgrp_event_detail_description as string,\n\t\tinc_registered_date as date,\n\t\tinc_voyage_from as string,\n\t\tinc_main_claim_detail_desc as string,\n\t\tinc_main_claim_handler_desc as string,\n\t\tgrp_ind_major_incient as string,\n\t\tgrp_key as string,\n\t\tgrp_main_event_code as string,\n\t\tinc_latitude as decimal(28,10),\n\t\tinc_om_rule_code as string,\n\t\tinc_ded_used_amount_usd_1 as decimal(28,10),\n\t\tinc_reserve_created_by_code as string,\n\t\tinc_year_of_incident_calyear as decimal(28,10),\n\t\tinc_description as string,\n\t\tinc_year_of_incident as decimal(28,10),\n\t\tlast_updated_by as string,\n\t\tinc_incident_risk_group_desc as string,\n\t\tinc_me_tlo_ind as string,\n\t\tinc_complexity_desc as string,\n\t\tinc_date_of_incident as date,\n\t\tinc_geotag_reference as string,\n\t\tinc_claim_process_code as string,\n\t\tinc_casualty_cause as string,\n\t\treserve_worst_outcome as decimal(28,10),\n\t\tinc_status_desc as string,\n\t\tinc_imono as string,\n\t\tinc_text as string,\n\t\tinc_ded_used_amount_1 as decimal(28,10),\n\t\tinc_ded_used_days_1 as decimal(28,10),\n\t\tinc_me_tlo_type as string,\n\t\tdate_inserted as timestamp,\n\t\tinc_ded_used_curr_2 as string,\n\t\tinc_ded_used_amount_usd_2 as decimal(28,10),\n\t\tinc_om_rule_desc as string,\n\t\tinc_me_claim_cat_type as string,\n\t\tinc_registered_by_code as string,\n\t\tinc_text_unresticted as string,\n\t\tinc_claim_adjuster_code as string,\n\t\tinc_code as string,\n\t\tinc_immediate_cause as string,\n\t\tgrp_claim_incurred_gross_usd as decimal(28,10),\n\t\tinc_ded_used_curr_1 as string,\n\t\tinc_main_claim_detail_code as string,\n\t\tinc_ded_used_text_2 as string,\n\t\tgrp_event_deatil_code as string,\n\t\tinc_date_archive_old as date,\n\t\tinserted_by as string,\n\t\tinc_place_of_incident as string,\n\t\tinc_main_claim_type_desc as string,\n\t\tinc_yearmonth_of_incident as decimal(28,10),\n\t\tinc_date_last_reviewed as date,\n\t\tinc_members_reference as string,\n\t\tinc_payment_created_by_desc as string,\n\t\tinc_main_jurisdiction as string,\n\t\tinc_complexity_code as string,\n\t\tinc_ded_used_days_2 as decimal(28,10),\n\t\tgrp_main_event_description as string,\n\t\tinc_incident_risk_group as string,\n\t\tinc_main_claim_type_code as string,\n\t\tinc_incident_reference as string,\n\t\tgrp_code as string,\n\t\treserve_best_outcome as decimal(28,10),\n\t\tinc_file_number as string,\n\t\tgrp_id as decimal(28,10),\n\t\tinc_payment_created_by_code as string,\n\t\tinc_main_claim_handler_code as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'select * from dwh_prepare.pre_dim_incident',\n\tformat: 'query',\n\twildcardPaths:['Pre_Dim/pre_dim_incident_pa.parquet']) ~> preDimIncidentPa\nsource(output(\n\t\temp_job_mobile as string,\n\t\temp_job_email as string,\n\t\temp_source_key as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tquery: 'select emp_job_mobile, emp_job_email, emp_source_key  from marts.dim_employee',\n\tformat: 'query') ~> dimEmployee\npreDimIncidentPa derive(top_key = 'ALL',\n\t\ttop_description = 'All Incidents',\n\t\tinc_me_tlo_ind = coalesce(inc_me_tlo_ind,'N')) ~> DeriveColumns\nDeriveColumns alterRow(upsertIf(true())) ~> AlterRow1\ndimEmployee select(mapColumn(\n\t\temp_job_mobile,\n\t\temp_job_email_claimHandler = emp_job_email,\n\t\temp_source_key_claimHandler = emp_source_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> claimHandler\ndimEmployee select(mapColumn(\n\t\temp_job_mobile_claimAdjuster = emp_job_mobile,\n\t\temp_job_email_claimAdjuster = emp_job_email,\n\t\temp_source_key_claimAdjuster = emp_source_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> claimAdjuster\nAlterRow1 sink(input(\n\t\tdimension_key as long,\n\t\tinc_text_restricted as string,\n\t\tinc_ded_used_amount_2 as decimal(28,10),\n\t\tgrp_claim_incurred_gross_usd as decimal(28,10),\n\t\tinc_longitude as decimal(28,10),\n\t\tinc_key as string,\n\t\tinc_imono as string,\n\t\tgrp_event_detail_code as string,\n\t\tinc_ded_used_curr_2 as string,\n\t\tinc_main_jurisdiction as string,\n\t\tbest_value_estimate as decimal(28,10),\n\t\tinc_payment_created_by_code as string,\n\t\tinc_date_registered as date,\n\t\tinc_registered_by_code as string,\n\t\tinc_me_tlo_ind as string,\n\t\tinc_code as string,\n\t\tgrp_id as long,\n\t\tinc_gic_incident_id as long,\n\t\tinc_casualty_cause as string,\n\t\tinc_mygard_claim_id as string,\n\t\tinc_main_claim_type_desc as string,\n\t\tinc_ded_used_text_2 as string,\n\t\tinc_status_desc as string,\n\t\tgrp_key as string,\n\t\tinc_ded_used_amount_usd_1 as decimal(28,10),\n\t\tinc_members_reference as string,\n\t\tinc_ind_open as string,\n\t\tinc_voyage_to as string,\n\t\tinc_main_claim_hdl_job_email as string,\n\t\tinc_complexity_desc as string,\n\t\tinc_ded_used_days_1 as decimal(28,10),\n\t\tinc_place_of_incident as string,\n\t\tinc_ded_used_amount_usd_2 as decimal(28,10),\n\t\tgrp_ind_major_incident as string,\n\t\tinc_claim_process_code as string,\n\t\tinc_main_claim_handler_code as string,\n\t\tinc_team_description as string,\n\t\tgrp_description as string,\n\t\tinc_registered_by_desc as string,\n\t\treserve_worst_outcome as decimal(28,10),\n\t\tinc_yearmonth_of_registered as integer,\n\t\tinc_main_claim_type_code as string,\n\t\treserve_best_outcome as decimal(28,10),\n\t\tinc_text_unrestricted as string,\n\t\tinc_date_archive_old as date,\n\t\tinc_claim_adjuster_desc as string,\n\t\tinc_date_archive as date,\n\t\tinc_date_of_incident as date,\n\t\tinc_main_claim_hdl_job_tlf as string,\n\t\tinc_payment_created_by_desc as string,\n\t\tinc_geotag_reference as string,\n\t\tinc_main_claim_handler_desc as string,\n\t\tinc_ded_used_amount_1 as decimal(28,10),\n\t\tinc_ded_used_days_2 as decimal(28,10),\n\t\tinc_text as string,\n\t\tinc_om_rule_code as string,\n\t\tinc_claim_adjuster_job_email as string,\n\t\tinc_main_claim_detail_desc as string,\n\t\tinc_year_of_incident_calyear as integer,\n\t\tinc_latitude as decimal(28,10),\n\t\tinc_file_number as string,\n\t\tinc_reserve_created_by_desc as string,\n\t\tinc_vessel_name as string,\n\t\tinc_yearmonth_of_incident as integer,\n\t\tinc_ded_used_curr_1 as string,\n\t\tinc_reg_in_paris_pool_ind as string,\n\t\tgrp_code as string,\n\t\tgrp_text as string,\n\t\tinc_immediate_cause as string,\n\t\tinc_incident_risk_group_desc as string,\n\t\tinc_reserve_created_by_code as string,\n\t\tinc_voyage_from as string,\n\t\tinc_year_of_registered as integer,\n\t\tinc_complexity_code as string,\n\t\tinc_om_rule_desc as string,\n\t\tinc_ded_used_text_1 as string,\n\t\tgrp_main_event_code as string,\n\t\tinc_year_of_incident as integer,\n\t\tgrp_main_event_description as string,\n\t\tinc_claim_adjuster_code as string,\n\t\ttop_key as string,\n\t\tinc_deleted_ind as string,\n\t\tinc_me_claim_cat_type as string,\n\t\tinc_claim_process_desc as string,\n\t\tinc_incident_risk_group as string,\n\t\tinc_retention as decimal(28,10),\n\t\tinc_claim_adjuster_job_tlf as string,\n\t\tinc_main_claim_detail_code as string,\n\t\ttop_description as string,\n\t\tinc_me_tlo_type as string,\n\t\tinc_date_last_reviewed as date,\n\t\tinc_incident_reference as string,\n\t\tgrp_event_detail_description as string,\n\t\tinc_description as string,\n\t\tinc_gard_claim_id as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:false,\n\tupdateable:false,\n\tupsertable:true,\n\tkeys:['inc_key'],\n\tformat: 'table',\n\tmapColumn(\n\t\tinc_text_restricted,\n\t\tinc_ded_used_amount_2,\n\t\tgrp_claim_incurred_gross_usd,\n\t\tinc_longitude,\n\t\tinc_key = pk_key_inc,\n\t\tinc_imono,\n\t\tgrp_event_detail_code = grp_event_deatil_code,\n\t\tinc_ded_used_curr_2,\n\t\tinc_main_jurisdiction,\n\t\tbest_value_estimate,\n\t\tinc_payment_created_by_code,\n\t\tinc_date_registered = inc_registered_date,\n\t\tinc_registered_by_code,\n\t\tinc_me_tlo_ind,\n\t\tinc_code,\n\t\tgrp_id,\n\t\tinc_gic_incident_id,\n\t\tinc_casualty_cause,\n\t\tinc_mygard_claim_id,\n\t\tinc_main_claim_type_desc,\n\t\tinc_ded_used_text_2,\n\t\tinc_status_desc,\n\t\tgrp_key,\n\t\tinc_ded_used_amount_usd_1,\n\t\tinc_members_reference,\n\t\tinc_ind_open,\n\t\tinc_voyage_to,\n\t\tinc_complexity_desc,\n\t\tinc_ded_used_days_1,\n\t\tinc_place_of_incident,\n\t\tinc_ded_used_amount_usd_2,\n\t\tgrp_ind_major_incident = grp_ind_major_incient,\n\t\tinc_claim_process_code,\n\t\tinc_main_claim_handler_code,\n\t\tinc_team_description,\n\t\tgrp_description,\n\t\tinc_registered_by_desc,\n\t\treserve_worst_outcome,\n\t\tinc_yearmonth_of_registered,\n\t\tinc_main_claim_type_code,\n\t\treserve_best_outcome,\n\t\tinc_text_unrestricted = inc_text_unresticted,\n\t\tinc_date_archive_old,\n\t\tinc_claim_adjuster_desc,\n\t\tinc_date_archive,\n\t\tinc_date_of_incident,\n\t\tinc_payment_created_by_desc,\n\t\tinc_geotag_reference,\n\t\tinc_main_claim_handler_desc,\n\t\tinc_ded_used_amount_1,\n\t\tinc_ded_used_days_2,\n\t\tinc_text,\n\t\tinc_om_rule_code,\n\t\tinc_main_claim_detail_desc,\n\t\tinc_year_of_incident_calyear,\n\t\tinc_latitude,\n\t\tinc_file_number,\n\t\tinc_reserve_created_by_desc,\n\t\tinc_vessel_name,\n\t\tinc_yearmonth_of_incident,\n\t\tinc_ded_used_curr_1,\n\t\tinc_reg_in_paris_pool_ind,\n\t\tgrp_code,\n\t\tgrp_text,\n\t\tinc_immediate_cause,\n\t\tinc_incident_risk_group_desc,\n\t\tinc_reserve_created_by_code,\n\t\tinc_voyage_from,\n\t\tinc_year_of_registered,\n\t\tinc_complexity_code,\n\t\tinc_om_rule_desc,\n\t\tinc_ded_used_text_1,\n\t\tgrp_main_event_code,\n\t\tinc_year_of_incident,\n\t\tgrp_main_event_description,\n\t\tinc_claim_adjuster_code,\n\t\ttop_key,\n\t\tinc_deleted_ind,\n\t\tinc_me_claim_cat_type,\n\t\tinc_claim_process_desc,\n\t\tinc_incident_risk_group,\n\t\tinc_retention,\n\t\tinc_main_claim_detail_code,\n\t\ttop_description,\n\t\tinc_me_tlo_type,\n\t\tinc_date_last_reviewed,\n\t\tinc_incident_reference,\n\t\tgrp_event_detail_description,\n\t\tinc_description,\n\t\tinc_gard_claim_id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> dimIncident"
		}
	}
}