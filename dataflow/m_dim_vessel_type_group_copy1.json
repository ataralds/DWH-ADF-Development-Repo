{
	"name": "m_dim_vessel_type_group_copy1",
	"properties": {
		"folder": {
			"name": "dwh_prepare/pre_dim"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "pre_dim_vessel_type_group",
						"type": "DatasetReference"
					},
					"name": "VesselTypeGroup"
				},
				{
					"dataset": {
						"referenceName": "Oltp05",
						"type": "DatasetReference"
					},
					"name": "LlyodsVessel"
				},
				{
					"dataset": {
						"referenceName": "Other",
						"type": "DatasetReference"
					},
					"name": "tcross"
				},
				{
					"dataset": {
						"referenceName": "Paris",
						"type": "DatasetReference"
					},
					"name": "crc"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "dim_vessel_type_group",
						"type": "DatasetReference"
					},
					"name": "DimVesselTyprGroup"
				}
			],
			"transformations": [
				{
					"name": "Deduplicator"
				},
				{
					"name": "VesselType"
				},
				{
					"name": "VesselTypeCode"
				},
				{
					"name": "xrefvesseltype"
				},
				{
					"name": "VesselTypeCrossRef"
				},
				{
					"name": "CodeType"
				},
				{
					"name": "Constant"
				},
				{
					"name": "NA"
				},
				{
					"name": "onlycrossref"
				},
				{
					"name": "notInVslTypeGrp"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "notin"
				},
				{
					"name": "finalunion"
				},
				{
					"name": "vesseltypegroupselected"
				},
				{
					"name": "DefaultNull"
				},
				{
					"name": "renamingcolumns"
				},
				{
					"name": "DeriveTopLevels"
				},
				{
					"name": "AlterRow"
				}
			],
			"script": "source(output(\n\t\tvtg_key as string,\n\t\tvtg_description as string,\n\t\tvtg_main_group_level_1_code as integer,\n\t\tvtg_main_group_level_1_desc as string,\n\t\tvtg_main_group_level_1_sort as string,\n\t\tvtg_main_group_level_2_code as integer,\n\t\tvtg_main_group_level_2_desc as string,\n\t\tvtg_main_group_level_2_sort as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> VesselTypeGroup\nsource(output(\n\t\tammonia_ind as string,\n\t\tanswer_back as string,\n\t\taudit_created as timestamp,\n\t\taudit_updated as timestamp,\n\t\tbale_capacity as decimal(38,18),\n\t\tballast_capacity as decimal(38,18),\n\t\tbeneficial_owner_id as decimal(38,18),\n\t\tbeneficial_owner_start_date as timestamp,\n\t\tbollard_pull as decimal(38,18),\n\t\tbore as decimal(38,18),\n\t\tbow_chain_stoppers as string,\n\t\tbow_load_discharge as string,\n\t\tbreadth_extreme as decimal(38,18),\n\t\tbreadth_moulded as decimal(38,18),\n\t\tbreaker_company as string,\n\t\tbroken_end_date as timestamp,\n\t\tbroken_place as string,\n\t\tbuilt_place as string,\n\t\tbulbous_bow_ind as string,\n\t\tcall_sign as string,\n\t\tcar_capacity as decimal(38,18),\n\t\tcasualty_date as timestamp,\n\t\tclass1 as string,\n\t\tclass1_code as string,\n\t\tclass1_esp_ind as string,\n\t\tclass1_ice_class as string,\n\t\tclass1_ice_class_text as string,\n\t\tclass1_last_survey_date as timestamp,\n\t\tclass1_notation as string,\n\t\tclass1_provisional_end_date as timestamp,\n\t\tclass1_provisional_ind as string,\n\t\tclass1_rating as string,\n\t\tclass1_start_date as timestamp,\n\t\tclass1_suspension_ind as string,\n\t\tclass1_vessel_id as string,\n\t\tclass2 as string,\n\t\tclass2_code as string,\n\t\tclass2_esp_ind as string,\n\t\tclass2_ice_class as string,\n\t\tclass2_ice_class_text as string,\n\t\tclass2_last_survey_date as timestamp,\n\t\tclass2_notation as string,\n\t\tclass2_provisional_end_date as timestamp,\n\t\tclass2_provisional_ind as string,\n\t\tclass2_rating as string,\n\t\tclass2_start_date as timestamp,\n\t\tclass2_suspension_ind as string,\n\t\tclass2_vessel_id as string,\n\t\tclass_changes_previous_3_years as decimal(38,18),\n\t\tcls_ind as string,\n\t\tco2_ind as string,\n\t\tcoil_ind as string,\n\t\tcoil_text as string,\n\t\tcollisions as decimal(38,18),\n\t\tcommercial_operator_id as decimal(38,18),\n\t\tcommercial_op_start_date as timestamp,\n\t\tcommon_boiler_type as string,\n\t\tcommon_gear_type as string,\n\t\tcommon_gear_type_code as string,\n\t\tcommon_propeller_type as string,\n\t\tcommon_propeller_type_code as string,\n\t\tconstruction_end as timestamp,\n\t\tconstruction_start as timestamp,\n\t\tconvention_69_ind as string,\n\t\tconversion_date as timestamp,\n\t\tconversion_text as string,\n\t\tcount_designation as double,\n\t\tcount_eng_builder as double,\n\t\tcount_gbowner_chg_5y as double,\n\t\tcow_ind as string,\n\t\tcurrent_flag as string,\n\t\tcurrent_flag_start_date as timestamp,\n\t\tcurrent_name as string,\n\t\tcylinder_arrangement as string,\n\t\tdead_date as timestamp,\n\t\tdeck_tank_capacity as decimal(38,18),\n\t\tdepth as decimal(38,18),\n\t\tdetentions_last_12_months as decimal(38,18),\n\t\tdetentions_last_24mon as decimal(38,18),\n\t\tdetentions_last_3_years as decimal(38,18),\n\t\tdetention_ind as string,\n\t\tdisplacement as decimal(38,18),\n\t\tdraft as decimal(38,18),\n\t\tdwt as decimal(38,18),\n\t\tearliest_engine_dob as timestamp,\n\t\tengine_action as string,\n\t\tengine_builder as string,\n\t\tengine_built_town as string,\n\t\tengine_designation as string,\n\t\tengine_designer as string,\n\t\tengine_position as string,\n\t\tengine_type as string,\n\t\tethylene_ind as string,\n\t\tflag as string,\n\t\tflag_changes_previous_3_years as decimal(38,18),\n\t\tflag_official_number as string,\n\t\tflash_point_60_ind as string,\n\t\tformula_dwt as decimal(38,18),\n\t\tfreeboard as decimal(38,18),\n\t\tfuel_capacity as decimal(38,18),\n\t\tfuel_consumption as string,\n\t\tfuel_type as string,\n\t\tfuel_type2 as string,\n\t\tgas_capacity as decimal(38,18),\n\t\tgas_max_pressure as decimal(38,18),\n\t\tgas_min_pressure as decimal(38,18),\n\t\tgearless_ind as string,\n\t\tgrain_capacity as decimal(38,18),\n\t\tgross as decimal(38,18),\n\t\thatch_type as string,\n\t\theat_exchangers as string,\n\t\theli_deck_ind as string,\n\t\thp as decimal(38,18),\n\t\thull_damage as decimal(38,18),\n\t\thull_design as string,\n\t\thull_type as string,\n\t\tigs_ind as string,\n\t\timo as decimal(38,18),\n\t\timo_rating_1 as string,\n\t\timo_rating_2 as string,\n\t\timo_rating_3 as string,\n\t\tincidents_result_in_pollution as decimal(38,18),\n\t\tincident_result_in_los_of_life as decimal(38,18),\n\t\tinmarsat_code as string,\n\t\tinmarsat_number as string,\n\t\tinspections_last_12_months as decimal(38,18),\n\t\tinspections_last_24mon as decimal(38,18),\n\t\tinspections_last_3_years as decimal(38,18),\n\t\tinspection_precis as string,\n\t\tktm as decimal(38,18),\n\t\tlane_length as decimal(38,18),\n\t\tlane_width as decimal(38,18),\n\t\tlatest_incident_precis as string,\n\t\tlatest_inspection_date as timestamp,\n\t\tlaunch_date as timestamp,\n\t\tlbp as decimal(38,18),\n\t\tliquid_capacity as decimal(38,18),\n\t\tliquid_capacity_barrels as decimal(38,18),\n\t\tlng_containment_ind as string,\n\t\tloa as decimal(38,18),\n\t\tloss_date as timestamp,\n\t\tlrg as decimal(38,18),\n\t\tlt_tonnes as decimal(38,18),\n\t\tmachinery_damage as decimal(38,18),\n\t\tmanifold_distance as decimal(38,18),\n\t\tmanifold_to_bow as decimal(38,18),\n\t\tmanifold_type as string,\n\t\tmaterial_of_build as string,\n\t\tmaximum_hatch_length as decimal(38,18),\n\t\tmaximum_hatch_width as decimal(38,18),\n\t\tmaximum_hold_depth as decimal(38,18),\n\t\tmaximum_hold_length as decimal(38,18),\n\t\tmaximum_hold_width as decimal(38,18),\n\t\tmaximum_individual_gear_swl as decimal(38,18),\n\t\tmaximum_rpm as decimal(38,18),\n\t\tmmsi as string,\n\t\tname_changes_previous_3_years as decimal(38,18),\n\t\tnet as decimal(38,18),\n\t\tnominal_owner_id as decimal(38,18),\n\t\tnominal_owner_start_date as timestamp,\n\t\tno_berths as decimal(38,18),\n\t\tno_bulkheads as decimal(38,18),\n\t\tno_cabins as decimal(38,18),\n\t\tno_centre_tanks as decimal(38,18),\n\t\tno_crew as decimal(38,18),\n\t\tno_cylinders as decimal(38,18),\n\t\tno_decks as decimal(38,18),\n\t\tno_deficiencies_last_12mon as decimal(38,18),\n\t\tno_deficiencies_last_24mon as decimal(38,18),\n\t\tno_engines as decimal(38,18),\n\t\tno_grades as decimal(38,18),\n\t\tno_lines as decimal(38,18),\n\t\tno_passengers as decimal(38,18),\n\t\tno_reefer_plugs as decimal(38,18),\n\t\tno_stainless_steel_tanks as decimal(38,18),\n\t\tno_watertight_compartments as decimal(38,18),\n\t\tno_wing_tanks as decimal(38,18),\n\t\tnumber_deficienci_last_3_year as decimal(38,18),\n\t\tnumber_owner as double,\n\t\torder_cancelled as timestamp,\n\t\torder_date as timestamp,\n\t\torder_value as decimal(38,18),\n\t\tore_capacity_tonnes as decimal(38,18),\n\t\tore_cargo_ind as string,\n\t\toriginal_sched_cons_end as timestamp,\n\t\tpanama_nrt as decimal(38,18),\n\t\tparallel_body_length as decimal(38,18),\n\t\tpiracy as decimal(38,18),\n\t\tpi_changes_previous_3_years as decimal(38,18),\n\t\tpi_club as string,\n\t\tpi_club_id as string,\n\t\tpi_start_date as timestamp,\n\t\tport_of_registry as string,\n\t\tpower_kw as decimal(38,18),\n\t\tpressurised_ind as string,\n\t\tprevious_flag as string,\n\t\tprevious_name as string,\n\t\tpropulsion_text as string,\n\t\tpropulsion_type as string,\n\t\tpump_capacity_cubic as decimal(38,18),\n\t\tpump_capacity_tonnes as decimal(38,18),\n\t\tpump_description as string,\n\t\trecord_last_updated as timestamp,\n\t\trefrigerated_capacity as decimal(38,18),\n\t\trefrigerated_ind as string,\n\t\trefrigerated_teu_capacity as decimal(38,18),\n\t\tregistered_owner_id as decimal(38,18),\n\t\tregistered_owner_start_date as timestamp,\n\t\tsbt_ind as string,\n\t\tscheduled_construction_end as timestamp,\n\t\tsemi_pressurised_ind as string,\n\t\tslop_tank_capacity as decimal(38,18),\n\t\tsnapshot_date as timestamp,\n\t\tspeed as decimal(38,18),\n\t\tspeed_type as string,\n\t\tspm_ind as string,\n\t\tstainles_steel_tanks as string,\n\t\tstart_date as timestamp,\n\t\tstatus as string,\n\t\tstern_load_discharge as string,\n\t\tstrengthened_for_heavy_cargo as string,\n\t\tstroke as decimal(38,18),\n\t\tstroke_type as decimal(38,18),\n\t\tsuez_nrt as decimal(38,18),\n\t\ttank_coated_ind as string,\n\t\ttank_coated_text as string,\n\t\ttank_text as string,\n\t\ttechnical_manager_id as decimal(38,18),\n\t\ttechnical_manager_start_date as timestamp,\n\t\tteu_14t_capacity as decimal(38,18),\n\t\tteu_capacity as decimal(38,18),\n\t\tteu_deck_capacity as decimal(38,18),\n\t\tteu_hold_capacity as decimal(38,18),\n\t\tteu_operation_capacity as decimal(38,18),\n\t\tthird_party_operator_id as decimal(38,18),\n\t\tthird_party_operator_start_dat as timestamp,\n\t\tthruster_ind as string,\n\t\ttotal_ac_current_generators as decimal(38,18),\n\t\ttotal_boilers as decimal(38,18),\n\t\ttotal_casualties as decimal(38,18),\n\t\ttotal_casualties_last_12_month as decimal(38,18),\n\t\ttotal_casualties_last_5_years as decimal(38,18),\n\t\ttotal_dc_current_generators as decimal(38,18),\n\t\ttotal_dead as decimal(38,18),\n\t\ttotal_detentions as decimal(38,18),\n\t\ttotal_generators as decimal(38,18),\n\t\ttotal_generator_power as decimal(38,18),\n\t\ttotal_hatches as decimal(38,18),\n\t\ttotal_holds as decimal(38,18),\n\t\ttotal_injured as decimal(38,18),\n\t\ttotal_inspections as decimal(38,18),\n\t\ttotal_lifting_gear as decimal(38,18),\n\t\ttotal_missing as decimal(38,18),\n\t\ttotal_propellers as decimal(38,18),\n\t\ttotal_pumps as decimal(38,18),\n\t\ttotal_tanks as decimal(38,18),\n\t\ttpcmi as decimal(38,18),\n\t\ttrailer_capacity as decimal(38,18),\n\t\tvcm_ind as string,\n\t\tvessel_builder as string,\n\t\tvessel_id as decimal(38,18),\n\t\tvessel_name as string,\n\t\tvessel_type as string,\n\t\tvessel_type_code as string,\n\t\tyard_number as string,\n\t\tyear_of_build as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> LlyodsVessel\nsource(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> tcross\nsource(output(\n\t\tcrcccode as decimal(38,18),\n\t\tcrccpers2 as decimal(38,18),\n\t\tcrccpers3 as decimal(38,18),\n\t\tcrccpers4 as decimal(38,18),\n\t\tcrclospro as decimal(38,18),\n\t\tcrcmdescr as string,\n\t\tcrcperinc as string,\n\t\tcrcratcod as string,\n\t\tcrcratcomp as decimal(38,18),\n\t\tcrcsdescr as string,\n\t\tcrcstopuse as string,\n\t\tcrcsw5 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> crc\nLlyodsVessel aggregate(groupBy(vessel_type,\n\t\tvessel_type_code),\n\tvessel_types = first(vessel_type)) ~> Deduplicator\ntcross filter(CODE_TYPE_ID == 45) ~> VesselType\nDeduplicator select(mapColumn(\n\t\tvessel_type_code\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> VesselTypeCode\nVesselType select(mapColumn(\n\t\tTarget_Code_vessel_type = TARGET_CODE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> xrefvesseltype\nVesselTypeCode, xrefvesseltype union(byName: false)~> VesselTypeCrossRef\nVesselTypeGroup select(mapColumn(\n\t\tvtg_key\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> CodeType\ncrc derive(NA = 'N/A',\n\t\tnot_applicable = 'Not Applicable',\n\t\tconst_number = toInteger(null()),\n\t\tfp_level5_desc = 'Not Applicable') ~> Constant\nConstant select(mapColumn(\n\t\tvtg_key = NA,\n\t\tvtg_description = not_applicable,\n\t\tvtg_main_group_level_1_code = const_number,\n\t\tvtg_main_group_level_1_desc = not_applicable,\n\t\tvtg_main_group_level_1_sort = not_applicable,\n\t\tvtg_main_group_level_2_code = const_number,\n\t\tvtg_main_group_level_2_desc = not_applicable,\n\t\tvtg_main_group_level_2_sort = not_applicable\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> NA\nVesselTypeCrossRef, CodeType join(vessel_type_code == vtg_key,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> onlycrossref\nonlycrossref filter(iif(isNull(vtg_key),1,0) == 1) ~> notInVslTypeGrp\nnotInVslTypeGrp derive(NA = 'N/A',\n\t\tnot_applicable = 'Not Applicable',\n\t\tconst_number = toInteger(null())) ~> DerivedColumn1\nDerivedColumn1 select(mapColumn(\n\t\tvtg_key,\n\t\tvtg_description = not_applicable,\n\t\tvtg_main_group_level_1_code = const_number,\n\t\tvtg_main_group_level_1_desc = not_applicable,\n\t\tvtg_main_group_level_1_sort = not_applicable,\n\t\tvtg_main_group_level_2_code = const_number,\n\t\tvtg_main_group_level_2_desc = not_applicable,\n\t\tvtg_main_group_level_2_sort = not_applicable\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> notin\nvesseltypegroupselected, notin, NA union(byName: false)~> finalunion\nVesselTypeGroup select(mapColumn(\n\t\tvtg_key,\n\t\tvtg_description,\n\t\tvtg_main_group_level_1_code,\n\t\tvtg_main_group_level_1_desc,\n\t\tvtg_main_group_level_1_sort,\n\t\tvtg_main_group_level_2_code,\n\t\tvtg_main_group_level_2_desc,\n\t\tvtg_main_group_level_2_sort\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> vesseltypegroupselected\nfinalunion derive(vtg_key = iifNull(trim(vtg_key),'N/A'),\n\t\tvtg_description = iifNull(trim(vtg_description),'N/A'),\n\t\tvtg_main_group_level_1_code = iifNull(vtg_main_group_level_1_code,0),\n\t\tvtg_main_group_level_1_desc = iifNull(trim(vtg_main_group_level_1_desc),'N/A'),\n\t\tvtg_main_group_level_1_sort = iifNull(trim(vtg_main_group_level_1_sort),'N/A'),\n\t\tvtg_main_group_level_2_code = iifNull(vtg_main_group_level_2_code,0),\n\t\tvtg_main_group_level_2_desc = iifNull(trim(vtg_main_group_level_2_desc),'N/A'),\n\t\tvtg_main_group_level_2_sort = iifNull(trim(vtg_main_group_level_2_sort),'N/A')) ~> DefaultNull\nDefaultNull select(mapColumn(\n\t\tvtg_key,\n\t\tvtg_description,\n\t\tvtg_main_group_level_1_code,\n\t\tvtg_main_group_level_1_desc,\n\t\tvtg_main_group_level_1_sort,\n\t\tvtg_main_group_level_2_code,\n\t\tvtg_main_group_level_2_desc,\n\t\tvtg_main_group_level_2_sort\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> renamingcolumns\nrenamingcolumns derive(top_key = 'ALL',\n\t\ttop_description = 'All Source Systems') ~> DeriveTopLevels\nDeriveTopLevels alterRow(upsertIf(iifNull(vtg_key,'A')!='A')) ~> AlterRow\nAlterRow sink(input(\n\t\tPK_KEY as string,\n\t\tCPT_DESCRIPTION as string,\n\t\tCPT_NUMBER as integer,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> DimVesselTyprGroup"
		}
	}
}