{
	"name": "m_pre_dim_partner_me",
	"properties": {
		"folder": {
			"name": "dwh_prepare/paris"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "P_PAATABLE",
						"type": "DatasetReference"
					},
					"name": "paatable"
				},
				{
					"dataset": {
						"referenceName": "P_PEATABLE",
						"type": "DatasetReference"
					},
					"name": "peatable"
				},
				{
					"dataset": {
						"referenceName": "P_PEBTABLE",
						"type": "DatasetReference"
					},
					"name": "pebtable"
				},
				{
					"dataset": {
						"referenceName": "P_PEZTABLE",
						"type": "DatasetReference"
					},
					"name": "peztable"
				},
				{
					"dataset": {
						"referenceName": "P_QTBTABLE",
						"type": "DatasetReference"
					},
					"name": "qtbtable"
				},
				{
					"dataset": {
						"referenceName": "P_CRCTABLE",
						"type": "DatasetReference"
					},
					"name": "crctable"
				},
				{
					"dataset": {
						"referenceName": "t_crossreference",
						"type": "DatasetReference"
					},
					"name": "tcrossreference"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "maxpeb"
				},
				{
					"name": "Join1"
				},
				{
					"name": "pebdunco"
				},
				{
					"name": "Prtstatusjoin"
				},
				{
					"name": "Peaselected"
				},
				{
					"name": "Prtstatus"
				},
				{
					"name": "Join2"
				},
				{
					"name": "crcselected"
				},
				{
					"name": "Join3"
				},
				{
					"name": "paaselected"
				},
				{
					"name": "Paafiltered"
				},
				{
					"name": "Join4"
				},
				{
					"name": "Pezselected"
				},
				{
					"name": "Join5"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "Lookup1"
				}
			],
			"script": "source(output(\n\t\tpaapeaid as long,\n\t\tpaaspbusndiv as integer,\n\t\tpaafunct as integer,\n\t\tpaarevcname as string,\n\t\tpaawww as string,\n\t\tpaalongname as string,\n\t\tpaacaddress1 as string,\n\t\tpaaintnote as string,\n\t\tlast_updated_by as string,\n\t\tpaalcname as string,\n\t\tmap_date as date,\n\t\tinserted_by as string,\n\t\tpaacaddrcountry as string,\n\t\tdate_inserted as date,\n\t\tpaaintnet as string,\n\t\tpaacname2 as string,\n\t\tpaacontcname as string,\n\t\tpaacaddress4 as string,\n\t\tpaacfax as string,\n\t\tpaacaddrpostal as string,\n\t\tpaascname as string,\n\t\tdate_last_updated as date,\n\t\tpaacaddress5 as string,\n\t\tpaactelex as string,\n\t\tpaacaddress2 as string,\n\t\tpaacphone as string,\n\t\tpaacname as string,\n\t\tpaacaddress3 as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> paatable\nsource(output(\n\t\tpeapeaid as long,\n\t\tpeainvisible as string,\n\t\tpeaiebusndiv as integer,\n\t\tpeaiecond as string,\n\t\tpeaprobor as integer,\n\t\tpeaiyear as integer,\n\t\tpeasex as string,\n\t\tpeacorrmailfreq as integer,\n\t\tpeanopurr as string,\n\t\tpeaoutgirono as string,\n\t\tpeaclosmailfreq as integer,\n\t\tpeaieint5 as string,\n\t\tlast_updated_by as string,\n\t\tpeaclmmailfreq as integer,\n\t\tpeainvnotify as integer,\n\t\tpeaacorbo as integer,\n\t\tpeamexcdate as date,\n\t\tpeaaddmailfreq as integer,\n\t\tpeaieint3 as string,\n\t\tpeamailsizemb as decimal(28,10),\n\t\tpeaiediv as string,\n\t\tpeaorgno as string,\n\t\tpeaaclmbo as integer,\n\t\tpeacalamt as long,\n\t\tpeaxlcurr as string,\n\t\tmap_date as date,\n\t\tpeaccintr as decimal(28,10),\n\t\tpeaextid2 as string,\n\t\tpeapurnotify as integer,\n\t\tpeaccode as integer,\n\t\tpeasw10 as string,\n\t\tpeaaclmadv as integer,\n\t\tpeaclomet as integer,\n\t\tpeacloclm as integer,\n\t\tpeamexamt as long,\n\t\tpeaprotyp as integer,\n\t\tpeanotsort as integer,\n\t\tpeaieint1 as string,\n\t\tpeaiecon3 as integer,\n\t\tpeaincreday as integer,\n\t\tpeapersid as string,\n\t\tpeaaaddbo as integer,\n\t\tpeanotdays as integer,\n\t\tpeaaclobo as integer,\n\t\tpeacalcurr as string,\n\t\tpeaprovad as integer,\n\t\tpeafromcomp as long,\n\t\tpeastopuse as string,\n\t\tpeaclmadv as integer,\n\t\tpeasttniv as integer,\n\t\tpeamexcurr as string,\n\t\tpeaiecon4 as integer,\n\t\tpeasubtype as integer,\n\t\tpeaswrun as integer,\n\t\tpealeicode as string,\n\t\tpeaoutcreday as integer,\n\t\tpeaoutgiro as integer,\n\t\tpeamexpro as decimal(28,10),\n\t\tpeaoutgiroludate as date,\n\t\tpeaiecon2 as integer,\n\t\tpeaieint2 as string,\n\t\tpeastdate as date,\n\t\tpeaclamailfreq as integer,\n\t\tpeacclamt as long,\n\t\tpealang2 as string,\n\t\tpeastatyp as integer,\n\t\tpeaingirolusign as string,\n\t\tpeacrsign as string,\n\t\tpeaie2busnse as integer,\n\t\tpeabirtno as string,\n\t\tpeaiesect as string,\n\t\tpeaaddbor as integer,\n\t\tpeaieint4 as string,\n\t\tpeasttprmclm as integer,\n\t\tpeaiebusnse as integer,\n\t\tpeanotaco as integer,\n\t\tpeastaamt as integer,\n\t\tpeacclcurr as string,\n\t\tpeaextid as string,\n\t\tpeaendate as date,\n\t\tpeacomp2 as integer,\n\t\tpeabirtws as integer,\n\t\tpeaie2busndiv as integer,\n\t\tpearesdat as date,\n\t\tpeausecolfee as string,\n\t\tpeanotlay as integer,\n\t\tpealudate as date,\n\t\tpeaxlpoin as long,\n\t\tpeaoutgirolusign as string,\n\t\tpeaprenotify as integer,\n\t\tpeacrdate as date,\n\t\tpeaaprobo as integer,\n\t\tpeanopdue as integer,\n\t\tpeaingiroludate as date,\n\t\tpeaie3busnse as integer,\n\t\tdate_inserted as date,\n\t\tpeapurtyp as integer,\n\t\tinserted_by as string,\n\t\tpeapersrfl as long,\n\t\tpeacorbo as integer,\n\t\tpeastaniv as integer,\n\t\tdate_last_updated as date,\n\t\tpeastensw as integer,\n\t\tpeaccint as string,\n\t\tpeaswink as integer,\n\t\tpealusign as string,\n\t\tpeaiecon5 as integer,\n\t\tpeaknvmark as string,\n\t\tpeastopcod as integer,\n\t\tpeacrmid as long,\n\t\tpeaieint as string,\n\t\tpeamaxper as decimal(28,10),\n\t\tpeastoppremnote as string,\n\t\tpeaiecon1 as integer,\n\t\tpeamdescr as string,\n\t\tpeaclmintynsw as string,\n\t\tpeadueday as integer,\n\t\tpeaingirono as string,\n\t\tpeaie3busndiv as integer,\n\t\tpeaprovmailfreq as integer,\n\t\tpeaclmbor as integer,\n\t\tpeacolid as string,\n\t\tpeaingiro as integer,\n\t\tpeaclobor as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> peatable\nsource(output(\n\t\tpebpebid as string,\n\t\tpebpricecurr as string,\n\t\tpebmdescr as string,\n\t\tpebhourprice as decimal(28,10),\n\t\tpebnmnyk as string,\n\t\tpebisolan as string,\n\t\tpebpever as integer,\n\t\tpebsupporter as string,\n\t\tpebcivilstatus as integer,\n\t\tpebnmisic as string,\n\t\tpebludate as date,\n\t\tpebconcomp2 as integer,\n\t\tpebpeoopeaid as long,\n\t\tpebemlcurr as string,\n\t\tpebpaylevel as integer,\n\t\tpebratcod as string,\n\t\tpebdunco as integer,\n\t\tpebconbusndiv as integer,\n\t\tpebemlmdescr as string,\n\t\tpebratedate as date,\n\t\tpebvaldate as date,\n\t\tpebconbusnsec as integer,\n\t\tpebmvaynsw as string,\n\t\tpebratludate as date,\n\t\tpebpidcname as string,\n\t\tpebpeoid as string,\n\t\tpebpeaid as long,\n\t\tpebdistrict as string,\n\t\tpeblusign as string,\n\t\tdate_inserted as date,\n\t\tinserted_by as string,\n\t\tpebtaxno as string,\n\t\tpebmacheml as long,\n\t\tpebverstat as string,\n\t\tpebgeneml as long,\n\t\tpebratsign as string,\n\t\tpebforttrade as string,\n\t\tdate_last_updated as date,\n\t\tpebfortsector as integer,\n\t\tlast_updated_by as string,\n\t\tpebgroup as integer,\n\t\tpebconbusncla as integer,\n\t\tpebratcomp as long,\n\t\tmap_date as date,\n\t\tpebpidid as integer,\n\t\tpebtypelevel as integer,\n\t\tpebressign as string,\n\t\tpebreason as string,\n\t\tpebpibregdate as date,\n\t\tpebbrdate as date,\n\t\tpebconoffice as integer,\n\t\tpebinstadynz as string,\n\t\tpebpersacc as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> pebtable\nsource(output(\n\t\tpezdefbusndiv as integer,\n\t\tpezdefinstcalctype as integer,\n\t\tpezdefoffice as integer,\n\t\tpezdefagtnol as long,\n\t\tpezdefncomm as decimal(28,10),\n\t\tpezdefbusncla as integer,\n\t\tpezdefcomcod as string,\n\t\tpezpezid as long,\n\t\tpezdefbusnsec as integer,\n\t\tpezdefmortg as long,\n\t\tpezdefccpid as string,\n\t\tpezdefaccrebynsw as string,\n\t\tpezdefbusnbranch as integer,\n\t\tpezdeftarcodof as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> peztable\nsource(output(\n\t\tqtbmdescr as string,\n\t\tqtbsdescr as string,\n\t\tqtbfieldn as string,\n\t\tqtbvalue as string,\n\t\tqtbdispynsw as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> qtbtable\nsource(output(\n\t\tcrcratcod as string,\n\t\tcrcratcomp as long,\n\t\tcrcsw5 as string,\n\t\tcrccpers4 as integer,\n\t\tcrccpers2 as integer,\n\t\tcrcsdescr as string,\n\t\tcrcstopuse as string,\n\t\tcrcperinc as string,\n\t\tcrclospro as decimal(28,10),\n\t\tcrcccode as integer,\n\t\tcrccpers3 as integer,\n\t\tcrcmdescr as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> crctable\nsource(output(\n\t\tcode_type_id as long,\n\t\tcode2 as string,\n\t\ttarget_description as string,\n\t\tsource_system as string,\n\t\tom_x_ref as string,\n\t\ttarget_code as string,\n\t\tcode_type as string,\n\t\tsource_code_key as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> tcrossreference\npebtable aggregate(groupBy(pebpeaid),\n\tpebpever = max(pebpever)) ~> maxpeb\npebtable, maxpeb join(pebtable@pebpeaid == maxpeb@pebpeaid\n\t&& pebtable@pebpever == maxpeb@pebpever,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join1\nqtbtable filter(qtbfieldn=='pebdunco') ~> pebdunco\nJoin1, pebdunco join(pebdunco == toInteger(qtbvalue),\n\tjoinType:'left',\n\tbroadcast: 'none')~> Prtstatusjoin\npeatable select(mapColumn(\n\t\tpeapeaid,\n\t\tpeamdescr,\n\t\tpeaccode,\n\t\tpealeicode,\n\t\tpeasubtype,\n\t\tpeaextid2\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Peaselected\nPrtstatusjoin select(mapColumn(\n\t\tpebpeaid = pebtable@pebpeaid,\n\t\tpebdunco,\n\t\tqtbmdescr,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Prtstatus\nPrtstatus, Peaselected join(pebpeaid == peapeaid,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join2\ncrctable select(mapColumn(\n\t\tcrcratcod,\n\t\tcrcmdescr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> crcselected\nJoin2, crcselected join(pebratcod == crcratcod,\n\tjoinType:'left',\n\tbroadcast: 'none')~> Join3\npaatable select(mapColumn(\n\t\tpaapeaid,\n\t\tpaafunct,\n\t\tpaalongname,\n\t\tpaacaddress1,\n\t\tpaacaddress4,\n\t\tpaacaddress2,\n\t\tpaacname,\n\t\tpaacaddress3,\n\t\tpaactelex\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> paaselected\npaaselected filter(iifNull(paafunct,0) ==0) ~> Paafiltered\nJoin3, Paafiltered join(peapeaid == paapeaid,\n\tjoinType:'left',\n\tbroadcast: 'none')~> Join4\npeztable select(mapColumn(\n\t\tpezpezid,\n\t\tpezdefbusnbranch\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Pezselected\nJoin4, Pezselected join(peapeaid == pezpezid,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join5\nJoin5 derive(Key = concat('P',toString(peapeaid)),\n\t\t{Partner Name} = iifNull(trim(paalongname),iifNull(trim(paacname, peamdescr))),\n\t\tAddress = concat(trim(paacaddress1),iif(isNull((concat(trim(paacaddress2),concat(trim(paacaddress3), trim(paacaddress4))))),' ',paacaddress2)),\n\t\t{Rating Code} = case(isNull(pebratcod),'N/A',pebratcod),\n\t\t{Rating Code desc} = case(isNull(crcmdescr),'N/A',crcmdescr),\n\t\t{Partner Short Name} = peamdescr,\n\t\tpezdefbusnbranch = toString(pezdefbusnbranch),\n\t\t{Source System} = 'PARIS',\n\t\tCode_it_capital = 116,\n\t\tCode_type_state = 368) ~> DerivedColumn1\nDerivedColumn1, tcrossreference lookup(ERROR_FUNCTION('') == ERROR_FUNCTION(''),\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> Lookup1"
		}
	}
}