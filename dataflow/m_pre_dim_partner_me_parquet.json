{
	"name": "m_pre_dim_partner_me_parquet",
	"properties": {
		"folder": {
			"name": "dwh_prepare/paris"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "P_Paatable_prq",
						"type": "DatasetReference"
					},
					"name": "paatable"
				},
				{
					"dataset": {
						"referenceName": "P_Peatable_prq",
						"type": "DatasetReference"
					},
					"name": "peatable"
				},
				{
					"dataset": {
						"referenceName": "P_PEBTABLE",
						"type": "DatasetReference"
					},
					"name": "pebtable"
				},
				{
					"dataset": {
						"referenceName": "P_PEZTABLE",
						"type": "DatasetReference"
					},
					"name": "peztable"
				},
				{
					"dataset": {
						"referenceName": "P_QTBTABLE",
						"type": "DatasetReference"
					},
					"name": "qtbtable"
				},
				{
					"dataset": {
						"referenceName": "P_CRCTABLE",
						"type": "DatasetReference"
					},
					"name": "crctable"
				},
				{
					"dataset": {
						"referenceName": "t_crossreference",
						"type": "DatasetReference"
					},
					"name": "tcrossreference"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "maxpeb"
				},
				{
					"name": "Join1"
				},
				{
					"name": "pebdunco"
				},
				{
					"name": "Prtstatusjoin"
				},
				{
					"name": "Peaselected"
				},
				{
					"name": "Prtstatus"
				},
				{
					"name": "Join2"
				},
				{
					"name": "crcselected"
				},
				{
					"name": "Join3"
				},
				{
					"name": "paaselected"
				},
				{
					"name": "Paafiltered"
				},
				{
					"name": "Join4"
				},
				{
					"name": "Pezselected"
				},
				{
					"name": "Join5"
				},
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "Lookup1"
				},
				{
					"name": "AlterRow1"
				}
			],
			"script": "source(output(\n\t\tPAAPEAID as decimal(38,18),\n\t\tPAASPBUSNDIV as decimal(38,18),\n\t\tPAAFUNCT as decimal(38,18),\n\t\tPAACNAME as string,\n\t\tPAAREVCNAME as string,\n\t\tPAACFAX as string,\n\t\tPAACPHONE as string,\n\t\tPAACTELEX as string,\n\t\tPAAINTNOTE as string,\n\t\tPAACONTCNAME as string,\n\t\tPAAWWW as string,\n\t\tPAAINTNET as string,\n\t\tPAACNAME2 as string,\n\t\tPAALCNAME as string,\n\t\tPAASCNAME as string,\n\t\tPAACADDRESS1 as string,\n\t\tPAACADDRESS2 as string,\n\t\tPAACADDRESS3 as string,\n\t\tPAACADDRESS4 as string,\n\t\tPAACADDRESS5 as string,\n\t\tPAACADDRPOSTAL as string,\n\t\tPAACADDRCOUNTRY as string,\n\t\tPAALONGNAME as string,\n\t\tPAACONTMOBCPHONE as string,\n\t\tPAACONTCPHONE as string,\n\t\tPAACONTPEAID as decimal(38,18),\n\t\tPAACONTEMAIL as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> paatable\nsource(output(\n\t\tPEAPEAID as decimal(38,18),\n\t\tPEACCODE as decimal(38,18),\n\t\tPEACOMP2 as decimal(38,18),\n\t\tPEASTOPUSE as string,\n\t\tPEAINVISIBLE as string,\n\t\tPEAPERSID as string,\n\t\tPEACOLID as string,\n\t\tPEAMDESCR as string,\n\t\tPEALANG2 as string,\n\t\tPEABIRTWS as decimal(38,18),\n\t\tPEASUBTYPE as decimal(38,18),\n\t\tPEABIRTNO as string,\n\t\tPEASW10 as string,\n\t\tPEAPERSRFL as decimal(38,18),\n\t\tPEASTOPCOD as decimal(38,18),\n\t\tPEARESDAT as decimal(38,18),\n\t\tPEAINCREDAY as decimal(38,18),\n\t\tPEAINGIRO as decimal(38,18),\n\t\tPEAINGIRONO as string,\n\t\tPEANOTACO as decimal(38,18),\n\t\tPEAPURTYP as decimal(38,18),\n\t\tPEANOTLAY as decimal(38,18),\n\t\tPEANOTSORT as decimal(38,18),\n\t\tPEASWINK as decimal(38,18),\n\t\tPEAOUTCREDAY as decimal(38,18),\n\t\tPEAOUTGIRO as decimal(38,18),\n\t\tPEAOUTGIRONO as string,\n\t\tPEASWRUN as decimal(38,18),\n\t\tPEACLOMET as decimal(38,18),\n\t\tPEANOPDUE as decimal(38,18),\n\t\tPEASTATYP as decimal(38,18),\n\t\tPEASTAAMT as decimal(38,18),\n\t\tPEASTTNIV as decimal(38,18),\n\t\tPEASTANIV as decimal(38,18),\n\t\tPEACLMADV as decimal(38,18),\n\t\tPEAAPROBO as decimal(38,18),\n\t\tPEAAADDBO as decimal(38,18),\n\t\tPEAACLOBO as decimal(38,18),\n\t\tPEAACLMBO as decimal(38,18),\n\t\tPEAACORBO as decimal(38,18),\n\t\tPEAMEXCDATE as decimal(38,18),\n\t\tPEAMEXCURR as string,\n\t\tPEAMEXAMT as decimal(38,18),\n\t\tPEAMEXPRO as decimal(38,18),\n\t\tPEACCLCURR as string,\n\t\tPEACCLAMT as decimal(38,18),\n\t\tPEACCINT as string,\n\t\tPEACCINTR as decimal(38,18),\n\t\tPEACALCURR as string,\n\t\tPEACALAMT as decimal(38,18),\n\t\tPEAXLCURR as string,\n\t\tPEAXLPOIN as decimal(38,18),\n\t\tPEAIYEAR as decimal(38,18),\n\t\tPEASTENSW as decimal(38,18),\n\t\tPEASTDATE as decimal(38,18),\n\t\tPEAENDATE as decimal(38,18),\n\t\tPEAMAXPER as decimal(38,18),\n\t\tPEAIEDIV as string,\n\t\tPEAIEBUSNDIV as decimal(38,18),\n\t\tPEAIE2BUSNDIV as decimal(38,18),\n\t\tPEAIE3BUSNDIV as decimal(38,18),\n\t\tPEAIESECT as string,\n\t\tPEAIEBUSNSE as decimal(38,18),\n\t\tPEAIE2BUSNSE as decimal(38,18),\n\t\tPEAIE3BUSNSE as decimal(38,18),\n\t\tPEAIEINT as string,\n\t\tPEAIEINT1 as string,\n\t\tPEAIEINT2 as string,\n\t\tPEAIEINT3 as string,\n\t\tPEAIEINT4 as string,\n\t\tPEAIEINT5 as string,\n\t\tPEAIECOND as string,\n\t\tPEAIECON1 as decimal(38,18),\n\t\tPEAIECON2 as decimal(38,18),\n\t\tPEAIECON3 as decimal(38,18),\n\t\tPEAIECON4 as decimal(38,18),\n\t\tPEAIECON5 as decimal(38,18),\n\t\tPEACRDATE as decimal(38,18),\n\t\tPEACRSIGN as string,\n\t\tPEALUDATE as decimal(38,18),\n\t\tPEALUSIGN as string,\n\t\tPEASEX as string,\n\t\tPEAVATNO as string,\n\t\tPEAORGNO as string,\n\t\tPEANOPURR as string,\n\t\tPEAACLMADV as decimal(38,18),\n\t\tPEAADDBOR as decimal(38,18),\n\t\tPEAADDMAILFREQ as decimal(38,18),\n\t\tPEACLAMAILFREQ as decimal(38,18),\n\t\tPEACLMBOR as decimal(38,18),\n\t\tPEACLMINTYNSW as string,\n\t\tPEACLMMAILFREQ as decimal(38,18),\n\t\tPEACLOBOR as decimal(38,18),\n\t\tPEACLOSMAILFREQ as decimal(38,18),\n\t\tPEACORBO as decimal(38,18),\n\t\tPEACORRMAILFREQ as decimal(38,18),\n\t\tPEADUEDAY as decimal(38,18),\n\t\tPEAFROMCOMP as decimal(38,18),\n\t\tPEAINGIROLUDATE as decimal(38,18),\n\t\tPEAINGIROLUSIGN as string,\n\t\tPEAINVNOTIFY as decimal(38,18),\n\t\tPEAKNVMARK as string,\n\t\tPEAMAILSIZEMB as decimal(38,18),\n\t\tPEANOTDAYS as decimal(38,18),\n\t\tPEAOUTGIROLUDATE as decimal(38,18),\n\t\tPEAOUTGIROLUSIGN as string,\n\t\tPEAPRENOTIFY as decimal(38,18),\n\t\tPEAPROBOR as decimal(38,18),\n\t\tPEAPROVMAILFREQ as decimal(38,18),\n\t\tPEAPURNOTIFY as decimal(38,18),\n\t\tPEASTOPPREMNOTE as string,\n\t\tPEASTTPRMCLM as decimal(38,18),\n\t\tPEAUSECOLFEE as string,\n\t\tPEACRMID as decimal(38,18),\n\t\tPEAEXTID as string,\n\t\tPEALEICODE as string,\n\t\tPEALETNOTIFY as decimal(38,18),\n\t\tPEAEXTID2 as string,\n\t\tPEAMAILCNDNSPLIT as string,\n\t\tPEAMAILUSESERVADRESS as string,\n\t\tPEAMASKED as string,\n\t\tPEAEXTTRANSFER2 as string,\n\t\tPEAEXTTRANSFER as string,\n\t\tPEACRUSER as decimal(38,18),\n\t\tPEALUUSER as decimal(38,18),\n\t\tPEAALTERNATEPAYER as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> peatable\nsource(output(\n\t\tpebpebid as string,\n\t\tpebpricecurr as string,\n\t\tpebmdescr as string,\n\t\tpebhourprice as decimal(28,10),\n\t\tpebnmnyk as string,\n\t\tpebisolan as string,\n\t\tpebpever as integer,\n\t\tpebsupporter as string,\n\t\tpebcivilstatus as integer,\n\t\tpebnmisic as string,\n\t\tpebludate as date,\n\t\tpebconcomp2 as integer,\n\t\tpebpeoopeaid as long,\n\t\tpebemlcurr as string,\n\t\tpebpaylevel as integer,\n\t\tpebratcod as string,\n\t\tpebdunco as integer,\n\t\tpebconbusndiv as integer,\n\t\tpebemlmdescr as string,\n\t\tpebratedate as date,\n\t\tpebvaldate as date,\n\t\tpebconbusnsec as integer,\n\t\tpebmvaynsw as string,\n\t\tpebratludate as date,\n\t\tpebpidcname as string,\n\t\tpebpeoid as string,\n\t\tpebpeaid as long,\n\t\tpebdistrict as string,\n\t\tpeblusign as string,\n\t\tdate_inserted as date,\n\t\tinserted_by as string,\n\t\tpebtaxno as string,\n\t\tpebmacheml as long,\n\t\tpebverstat as string,\n\t\tpebgeneml as long,\n\t\tpebratsign as string,\n\t\tpebforttrade as string,\n\t\tdate_last_updated as date,\n\t\tpebfortsector as integer,\n\t\tlast_updated_by as string,\n\t\tpebgroup as integer,\n\t\tpebconbusncla as integer,\n\t\tpebratcomp as long,\n\t\tmap_date as date,\n\t\tpebpidid as integer,\n\t\tpebtypelevel as integer,\n\t\tpebressign as string,\n\t\tpebreason as string,\n\t\tpebpibregdate as date,\n\t\tpebbrdate as date,\n\t\tpebconoffice as integer,\n\t\tpebinstadynz as string,\n\t\tpebpersacc as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> pebtable\nsource(output(\n\t\tpezdefbusndiv as integer,\n\t\tpezdefinstcalctype as integer,\n\t\tpezdefoffice as integer,\n\t\tpezdefagtnol as long,\n\t\tpezdefncomm as decimal(28,10),\n\t\tpezdefbusncla as integer,\n\t\tpezdefcomcod as string,\n\t\tpezpezid as long,\n\t\tpezdefbusnsec as integer,\n\t\tpezdefmortg as long,\n\t\tpezdefccpid as string,\n\t\tpezdefaccrebynsw as string,\n\t\tpezdefbusnbranch as integer,\n\t\tpezdeftarcodof as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> peztable\nsource(output(\n\t\tqtbmdescr as string,\n\t\tqtbsdescr as string,\n\t\tqtbfieldn as string,\n\t\tqtbvalue as string,\n\t\tqtbdispynsw as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> qtbtable\nsource(output(\n\t\tcrcratcod as string,\n\t\tcrcratcomp as long,\n\t\tcrcsw5 as string,\n\t\tcrccpers4 as integer,\n\t\tcrccpers2 as integer,\n\t\tcrcsdescr as string,\n\t\tcrcstopuse as string,\n\t\tcrcperinc as string,\n\t\tcrclospro as decimal(28,10),\n\t\tcrcccode as integer,\n\t\tcrccpers3 as integer,\n\t\tcrcmdescr as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> crctable\nsource(output(\n\t\tcode_type_id as long,\n\t\tcode2 as string,\n\t\ttarget_description as string,\n\t\tsource_system as string,\n\t\tom_x_ref as string,\n\t\ttarget_code as string,\n\t\tcode_type as string,\n\t\tsource_code_key as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tisolationLevel: 'READ_UNCOMMITTED',\n\tformat: 'table') ~> tcrossreference\npebtable aggregate(groupBy(pebpeaid),\n\tpebpever = max(pebpever)) ~> maxpeb\npebtable, maxpeb join(pebtable@pebpeaid == maxpeb@pebpeaid\n\t&& pebtable@pebpever == maxpeb@pebpever,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join1\nqtbtable filter(qtbfieldn=='pebdunco') ~> pebdunco\nJoin1, pebdunco join(pebdunco == toInteger(qtbvalue),\n\tjoinType:'left',\n\tbroadcast: 'none')~> Prtstatusjoin\npeatable select(mapColumn(\n\t\tpeapeaid = PEAPEAID,\n\t\tpeamdescr = PEAMDESCR,\n\t\tpeaccode = PEACCODE,\n\t\tpealeicode = PEALEICODE,\n\t\tpeasubtype = PEASUBTYPE,\n\t\tpeaextid2 = PEAEXTID2\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Peaselected\nPrtstatusjoin select(mapColumn(\n\t\tpebpeaid = pebtable@pebpeaid,\n\t\tpebdunco,\n\t\tqtbmdescr,\n\t\tpebpeoopeaid,\n\t\tpebratcod,\n\t\tpebratedate,\n\t\tpebisolan,\n\t\tpebratcomp,\n\t\tpebtaxno\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Prtstatus\nPrtstatus, Peaselected join(pebpeaid == peapeaid,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join2\ncrctable select(mapColumn(\n\t\tcrcratcod,\n\t\tcrcmdescr\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> crcselected\nJoin2, crcselected join(pebratcod == crcratcod,\n\tjoinType:'left',\n\tbroadcast: 'none')~> Join3\npaatable select(mapColumn(\n\t\tpaapeaid = PAAPEAID,\n\t\tpaafunct = PAAFUNCT,\n\t\tpaalongname = PAALONGNAME,\n\t\tpaacaddress1 = PAACADDRESS1,\n\t\tpaacaddress4 = PAACADDRESS4,\n\t\tpaacaddress2 = PAACADDRESS2,\n\t\tpaacname = PAACNAME,\n\t\tpaacaddress3 = PAACADDRESS3,\n\t\tpaactelex = PAACTELEX\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> paaselected\npaaselected filter(iifNull(paafunct,0) ==0) ~> Paafiltered\nJoin3, Paafiltered join(peapeaid == paapeaid,\n\tjoinType:'left',\n\tbroadcast: 'none')~> Join4\npeztable select(mapColumn(\n\t\tpezpezid,\n\t\tpezdefbusnbranch\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Pezselected\nJoin4, Pezselected join(peapeaid == pezpezid,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> Join5\nJoin5 derive(Key = concat('P',toString(peapeaid)),\n\t\t{Partner Name} = iifNull(trim(paalongname),iifNull(trim(paacname, peamdescr))),\n\t\tAddress = concat(trim(paacaddress1),iif(isNull((concat(trim(paacaddress2),concat(trim(paacaddress3), trim(paacaddress4))))),' ',paacaddress2)),\n\t\t{Rating Code} = case(isNull(pebratcod),'N/A',pebratcod),\n\t\t{Rating Code desc} = case(isNull(crcmdescr),'N/A',crcmdescr),\n\t\t{Partner Short Name} = peamdescr,\n\t\tpezdefbusnbranch = toString(pezdefbusnbranch),\n\t\t{Source System} = 'PARIS',\n\t\tCode_it_capital = 116,\n\t\tCode_type_state = 368) ~> DerivedColumn1\nDerivedColumn1, tcrossreference lookup({Source System} == source_system\n\t&& pezdefbusnbranch == source_code_key\n\t&& Code_it_capital == code_type_id,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> Lookup1\nLookup1 alterRow(updateIf(isMatch())) ~> AlterRow1"
		}
	}
}