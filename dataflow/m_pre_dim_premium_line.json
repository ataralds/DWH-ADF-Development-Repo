{
	"name": "m_pre_dim_premium_line",
	"properties": {
		"folder": {
			"name": "dwh_prepare/pre_dim"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"name": "Ipa"
				},
				{
					"name": "Qtb"
				},
				{
					"name": "Rob"
				},
				{
					"name": "Tcross"
				},
				{
					"name": "Tcross1"
				},
				{
					"name": "Ing"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "Ipatable"
				},
				{
					"name": "FltIpapcod",
					"description": "Filtering rows using expressions on columns 'qtbfieldn' == 'ipapcode'"
				},
				{
					"name": "QtbCols"
				},
				{
					"name": "QtbIpapcod",
					"description": "Aggregating data by 'qtbvalue' producing columns 'qtbmdescr'\nGet distinct Ipapcod with description"
				},
				{
					"name": "PreDimRiskObject"
				},
				{
					"name": "XrefPrlType802"
				},
				{
					"name": "XrefReasom391"
				},
				{
					"name": "RobRateInd"
				},
				{
					"name": "Ingtable"
				},
				{
					"name": "IngCols"
				},
				{
					"name": "BkrProcPerIna"
				},
				{
					"name": "RRBrokerPercent"
				},
				{
					"name": "IpapcodeNA"
				},
				{
					"name": "IpaQtb"
				},
				{
					"name": "Ipapcode"
				},
				{
					"name": "TcrossCols"
				},
				{
					"name": "Tcross1Cols"
				}
			],
			"script": "source(output(\n\t\tipaipaid as string,\n\t\tipaeingrpre as decimal(28,10),\n\t\tipapolnn19 as string,\n\t\tipapoolpercentage as decimal(28,10),\n\t\tiparatype as string,\n\t\tiparistor as decimal(28,10),\n\t\tipaprocombase as decimal(28,10),\n\t\tipaagtynsw as string,\n\t\tipacosig2 as string,\n\t\tipaminprem as decimal(28,10),\n\t\tipalusign as string,\n\t\tipainstpertype as integer,\n\t\tipasecrebbase as decimal(28,10),\n\t\tipatxcomc as integer,\n\t\tipabonusamt as integer,\n\t\tiparelcallperc as decimal(28,10),\n\t\tiparetynsw as string,\n\t\tipabonusndisc as decimal(28,10),\n\t\tipacrsign as string,\n\t\tipaadmfee as decimal(28,10),\n\t\tipaludate as date,\n\t\tipaadarea as string,\n\t\tipaprfcombase as decimal(28,10),\n\t\tipapcod2 as string,\n\t\tipaprocomamtp as decimal(28,10),\n\t\tipanote as string,\n\t\tipaaddst as integer,\n\t\tipapremn3 as integer,\n\t\tipavalueicaid as string,\n\t\tipainstcalctype as integer,\n\t\tipacurr as string,\n\t\tipaadocombase as decimal(28,10),\n\t\tipasecrebamtp as decimal(28,10),\n\t\tiparipercentage as decimal(28,10),\n\t\tipaendate as date,\n\t\tipamaninsynsw as string,\n\t\tipaadicomamtp as decimal(28,10),\n\t\tiparate as decimal(28,10),\n\t\tipaadicomp as decimal(28,10),\n\t\tiparelcallamtp as decimal(28,10),\n\t\tipapcode as string,\n\t\tipalastinstamtp as decimal(28,10),\n\t\tipaenhour as integer,\n\t\tipalisig1 as string,\n\t\tipaadocomp as decimal(28,10),\n\t\tipaienteredprem as decimal(28,10),\n\t\tipapdays as decimal(28,10),\n\t\tipasecrebp as decimal(28,10),\n\t\tipapocprtln3 as integer,\n\t\tipaousdgt as decimal(28,10),\n\t\tipavalueipaid as string,\n\t\tipaorate as decimal(28,10),\n\t\tipanoterm as integer,\n\t\tipataxamt as decimal(28,10),\n\t\tipaprfcomamtp as decimal(28,10),\n\t\tipaapprovestatus as string,\n\t\tipareopenipaid as string,\n\t\tipagnsw as integer,\n\t\tipadwbsname as string,\n\t\tipaagbaseamtp as decimal(28,10),\n\t\tipagrossprem as decimal(28,10),\n\t\tiparicalcdate as date,\n\t\tipaaccrebamtp as decimal(28,10),\n\t\tipacrdate as date,\n\t\tipaadocomamtp as decimal(28,10),\n\t\tipaadcom as decimal(28,10),\n\t\tipainstad as decimal(28,10),\n\t\tipaprocomp as decimal(28,10),\n\t\tiparesig2 as integer,\n\t\tipaeoutpre as decimal(28,10),\n\t\tipaaccrebp as decimal(28,10),\n\t\tipaaccrebbase as decimal(28,10),\n\t\tipaccqid as string,\n\t\tipaaccrebsh as decimal(28,10),\n\t\tiparesig1 as integer,\n\t\tipaassetsubno as integer,\n\t\tipataxgnsw as integer,\n\t\tipaadcomc as integer,\n\t\tipairatecrew as decimal(28,10),\n\t\tipalastinstperc as decimal(28,10),\n\t\tipaicaid as string,\n\t\tipacosig1 as string,\n\t\tipaabatementpercentage as decimal(28,10),\n\t\tiparetndisc as decimal(28,10),\n\t\tipaotherexpences as decimal(28,10),\n\t\tiparoundrule as string,\n\t\tipagrossamtp as decimal(28,10),\n\t\tipatarifamt as integer,\n\t\tipasthour as integer,\n\t\tipamarketripercentage as decimal(28,10),\n\t\tipatxcom as decimal(28,10),\n\t\tipaagaid as string,\n\t\tipapocid as string,\n\t\tipaslipsw as string,\n\t\tipanetprem as decimal(28,10),\n\t\tipaadicombase as decimal(28,10),\n\t\tipatarifndisc as decimal(28,10),\n\t\tipaiusdgt as decimal(28,10),\n\t\tipaobno as integer,\n\t\tipaclodate as date,\n\t\tipaprfcomp as decimal(28,10),\n\t\tipapremri as string,\n\t\tipanetamtp as decimal(28,10),\n\t\tipastdate as date,\n\t\tipaminrate as decimal(28,10),\n\t\tipanatpre as decimal(28,10),\n\t\tipainaid as string,\n\t\tipaclstat as integer,\n\t\tipaindate as date,\n\t\tipalisig2 as string,\n\t\tipaknvmark as string,\n\t\tipapcdtxt as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> Ipa\nsource(output(\n\t\tqtbfieldn as string,\n\t\tqtbdispynsw as string,\n\t\tqtbmdescr as string,\n\t\tqtbvalue as string,\n\t\tqtbsdescr as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> Qtb\nsource(output(\n\t\tpk_key as string,\n\t\trob_condition_desc as string,\n\t\trob_risk_group_rsv_code as decimal(28,10),\n\t\trob_vessel_age as decimal(28,10),\n\t\trob_date_orig_end as date,\n\t\trob_segment_code as string,\n\t\trob_poolable_ind as string,\n\t\trob_cover_limit_cgl_usd as decimal(28,10),\n\t\trob_ceding_company_code as decimal(28,10),\n\t\trob_claims_lead_ind as string,\n\t\trob_risk_group_code as string,\n\t\trob_section_name as string,\n\t\trob_ret_line as decimal(28,10),\n\t\trob_section_type_desc as string,\n\t\trob_vessel_name as string,\n\t\trob_imono as string,\n\t\trob_vessel_type_fp as string,\n\t\trob_partial_interest as decimal(28,10),\n\t\tgard_vsl_type_grp_3_int_code as string,\n\t\trob_co_line as decimal(28,10),\n\t\tdeleted_ind as string,\n\t\trob_condition_code as string,\n\t\trob_expiry_rate_etc as decimal(28,10),\n\t\tgard_vsl_type_grp_2_int_desc as string,\n\t\trob_entered_tonnage as decimal(28,10),\n\t\trob_exposure as decimal(28,10),\n\t\trob_port_of_registry as string,\n\t\trob_rr_annual_amount_org as decimal(28,10),\n\t\trob_cash_index as decimal(28,10),\n\t\trob_ton_entered_our_share as decimal(28,10),\n\t\trob_capital_branch_code as string,\n\t\trob_epi_curr as string,\n\t\trob_flag_desc as string,\n\t\trob_date_first_inception as date,\n\t\trob_date_start as date,\n\t\tggp_gard_group as string,\n\t\trob_ceding_comp_country_code as string,\n\t\trob_cover_limit_main_curr as string,\n\t\trob_ffo as string,\n\t\trob_risk_group_sort as decimal(28,10),\n\t\trob_ceding_comp_country_desc as string,\n\t\trob_mutual_fixed as string,\n\t\trob_cover_limit_dth_curr as string,\n\t\trob_ded_amount_ice_usd as decimal(28,10),\n\t\trob_reinsurance_type_code as string,\n\t\trob_total_index as decimal(28,10),\n\t\trob_date_user_removed as date,\n\t\trob_ded_amount_daily_ind_curr as string,\n\t\trob_cover_limit_main_stat as decimal(28,10),\n\t\trob_epi_rate as decimal(28,10),\n\t\tgard_vsl_type_grp_2_ext_desc as string,\n\t\trob_main_limit_partial_org as decimal(28,10),\n\t\tgard_vsl_type_grp_3_ext_code as string,\n\t\trob_sum_insured_os_usd as decimal(28,10),\n\t\trob_ded_days_machinery as decimal(28,10),\n\t\trob_ded_amount_rdc_curr as string,\n\t\tgard_vsl_type_grp_6_int_code as string,\n\t\trob_re_line_fac as decimal(28,10),\n\t\trob_entered_tonnage_pro_rata as decimal(28,10),\n\t\trob_inapayer_name as string,\n\t\trob_non_vessel_indicator as string,\n\t\tdate_last_updated as timestamp,\n\t\trob_currency_code as string,\n\t\trob_risk_group_rsv_desc as string,\n\t\trob_ded_amount_rdc_usd as decimal(28,10),\n\t\trob_built_year_calc as decimal(28,10),\n\t\trob_cover_limit_main_usd as decimal(28,10),\n\t\trob_no_of_passengers as decimal(28,10),\n\t\trob_cover_limit_dth_org as decimal(28,10),\n\t\tgard_vsl_type_grp_3_ext_desc as string,\n\t\trob_reinstatement_rate as decimal(28,10),\n\t\trob_reinsurance_pgm_desc as string,\n\t\trob_object_category as string,\n\t\trob_flag_code as string,\n\t\trob_count_risk_days as decimal(28,10),\n\t\trob_ded_amount_pa_curr as string,\n\t\trob_class as string,\n\t\trob_ded_amount_amd_org as decimal(28,10),\n\t\trob_gard_bermuda_nuf_ind as string,\n\t\trob_ded_days_in_all as decimal(28,10),\n\t\trob_rr_abatement_percent as decimal(28,10),\n\t\trob_layer_desc as string,\n\t\trob_cover_limit_cgl_org as decimal(28,10),\n\t\trob_reinsurance_pgm_code as string,\n\t\trob_ded_amount_amd_curr as string,\n\t\trob_sum_insured_os_curr as string,\n\t\trob_expiry_rate as decimal(28,10),\n\t\trob_ded_amount_rdc_org as decimal(28,10),\n\t\trob_reinsurance_type as string,\n\t\trob_re_line_war as decimal(28,10),\n\t\trob_capital as string,\n\t\trob_inapayer as decimal(28,10),\n\t\trob_cover_limit_exh_date as date,\n\t\trob_ceding_company_name as string,\n\t\trob_claims_leader as string,\n\t\trob_ded_days as decimal(28,10),\n\t\trob_ded_amount_aad_usd as decimal(28,10),\n\t\trob_cover_limit_defence_curr as string,\n\t\trob_combined_single_limit_ind as string,\n\t\tdate_inserted as timestamp,\n\t\trob_class_desc as string,\n\t\trob_reinstatement_counts as decimal(28,10),\n\t\trob_main_limit_partial_curr as string,\n\t\trob_capital_branch_long_desc as string,\n\t\trob_date_end as date,\n\t\tgard_vsl_type_grp_6_ext_desc as string,\n\t\trob_ded_amount_amd_usd as decimal(28,10),\n\t\trob_rr_pool_percent as decimal(28,10),\n\t\trob_fac_cover_limit as decimal(28,10),\n\t\trob_cover_limit_defence_usd as decimal(28,10),\n\t\trob_rr_annual_amount_usd as decimal(28,10),\n\t\tggp_key as string,\n\t\trob_cover_limit_cgl_curr as string,\n\t\trob_ded_amount_daily_ind as decimal(28,10),\n\t\trob_segment_desc as string,\n\t\trob_rr_broker_percent as decimal(28,10),\n\t\trob_built_year as decimal(28,10),\n\t\trob_rr_annual_amount_stat as decimal(28,10),\n\t\trob_small_craft_ind as string,\n\t\trob_sum_insured_os_org as decimal(28,10),\n\t\trob_our_line as decimal(28,10),\n\t\trob_vessel_type_3ltr as string,\n\t\trob_vessel_type_desc as string,\n\t\trob_original_rate as decimal(28,10),\n\t\trob_etc_broker_ind as string,\n\t\trob_capital_branch_short_desc as string,\n\t\trob_ded_amount_daily_ind_usd as decimal(28,10),\n\t\trob_ded_amount_aad_org as decimal(28,10),\n\t\trob_mou_type_miller as string,\n\t\tgard_vsl_type_grp_2_ext_code as string,\n\t\tgard_vsl_type_grp_6_ext_code as string,\n\t\tgard_vsl_type_grp_3_int_desc as string,\n\t\trob_tonnage_gross as decimal(28,10),\n\t\trob_cut_line as decimal(28,10),\n\t\trob_tonnage_dw as decimal(28,10),\n\t\trob_sub_limit_cc_indicator as string,\n\t\trob_status as string,\n\t\trob_mou_type as string,\n\t\trob_date_registered as date,\n\t\trob_warranty_days as decimal(28,10),\n\t\trob_ded_amount_pa_org as decimal(28,10),\n\t\trob_business_type as string,\n\t\trob_class2_desc as string,\n\t\trob_risk_group_desc as string,\n\t\trob_rr_market_ri_percent as decimal(28,10),\n\t\trob_rating_method as string,\n\t\trob_mou_location as string,\n\t\trob_epi_premium as decimal(28,10),\n\t\trob_date_last_expiry as date,\n\t\trob_ded_amount_pa_usd as decimal(28,10),\n\t\trob_main_limit_partial_usd as decimal(28,10),\n\t\trob_ri_vessel_type as string,\n\t\tgard_vsl_type_grp_2_int_code as string,\n\t\trob_removed_ind as string,\n\t\trob_layer_code as string,\n\t\trob_reg_owner_name as string,\n\t\trob_cover_limit_main_org as decimal(28,10),\n\t\trob_rdc as string,\n\t\trob_ded_layer as string,\n\t\trob_class2 as string,\n\t\trob_signal_letters as string,\n\t\trob_on_risk_ind as string,\n\t\tinserted_by as string,\n\t\trob_ded_amount_ice_org as decimal(28,10),\n\t\trob_ded_days_indemnity as decimal(28,10),\n\t\trob_object_group as string,\n\t\trob_section_type_code as string,\n\t\trob_re_line as decimal(28,10),\n\t\tlast_updated_by as string,\n\t\trob_ded_amount_ice_curr as string,\n\t\trob_cover_limit_defence_org as decimal(28,10),\n\t\tgard_vsl_type_grp_6_int_desc as string,\n\t\trob_club_retention as decimal(28,10),\n\t\trob_ded_amount_aad_curr as string,\n\t\trob_object_key as string,\n\t\trob_cover_limit_dth_usd as decimal(28,10),\n\t\trob_capital_code as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> Rob\nsource(output(\n\t\tsource_code_key as string,\n\t\tsource_system as string,\n\t\ttarget_code as string,\n\t\ttarget_description as string,\n\t\tcode_type_id as integer,\n\t\tcode2 as string,\n\t\tom_x_ref as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> Tcross\nsource(output(\n\t\tsource_code_key as string,\n\t\tsource_system as string,\n\t\ttarget_code as string,\n\t\ttarget_description as string,\n\t\tcode_type_id as integer,\n\t\tcode2 as string,\n\t\tom_x_ref as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false) ~> Tcross1\nsource(output(\n\t\tingprov as decimal(28,10),\n\t\tinginaid as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> Ing\nIpa select(mapColumn(\n\t\tipaipaid,\n\t\tiparistor,\n\t\tipapcod2,\n\t\tipaendate,\n\t\tipapcode,\n\t\tipapdays,\n\t\tipaicaid,\n\t\tipastdate,\n\t\tipapcdtxt,\n\t\tipamarketripercentage,\n\t\tipaabatementpercentage,\n\t\tipapoolpercentage\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Ipatable\nQtb filter(qtbfieldn=='ipapcode') ~> FltIpapcod\nFltIpapcod select(mapColumn(\n\t\tqtbfieldn,\n\t\tqtbmdescr,\n\t\tqtbvalue\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> QtbCols\nQtbCols aggregate(groupBy(qtbvalue),\n\tqtbmdescr = max(qtbmdescr)) ~> QtbIpapcod\nRob select(mapColumn(\n\t\trob_count_risk_days,\n\t\tpk_key\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> PreDimRiskObject\nTcrossCols filter(source_system =='PARIS' &&code_type_id == 802) ~> XrefPrlType802\nTcross1Cols filter(source_system == 'PARIS' && code_type_id == 391) ~> XrefReasom391\nPreDimRiskObject derive(rob_count_risk_days = case (isNull(rob_count_risk_days,0) <= 21, 0, 1)) ~> RobRateInd\nIng select(mapColumn(\n\t\tingingid,\n\t\tingpremshare,\n\t\tingetcbroker,\n\t\tingprov,\n\t\tinginaid,\n\t\tingln2,\n\t\tingagent,\n\t\tingsettlynsw\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Ingtable\nIngtable filter(ingprov > 0) ~> IngCols\nIngCols aggregate(groupBy(inginaid),\n\tingprov = max(ingprov)) ~> BkrProcPerIna\nBkrProcPerIna derive(ingprov = isNull(ingprov,0)) ~> RRBrokerPercent\nIpapcode derive(target_code = Isnull(target_code, 'N/A')) ~> IpapcodeNA\nIpatable, Qtb join(ipapcode == qtbvalue,\n\tjoinType:'left',\n\tbroadcast: 'none')~> IpaQtb\nIpaQtb, XrefPrlType802 lookup(ipapcode == source_code_key,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> Ipapcode\nTcross select(mapColumn(\n\t\tsource_code_key,\n\t\tsource_system,\n\t\ttarget_code,\n\t\ttarget_description,\n\t\tcode_type_id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> TcrossCols\nTcross1 select(mapColumn(\n\t\tsource_code_key,\n\t\tsource_system,\n\t\ttarget_code,\n\t\ttarget_description,\n\t\tcode_type_id\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Tcross1Cols"
		}
	}
}