{
	"name": "m_pre_dim_sub_claim_detail_me_new",
	"properties": {
		"folder": {
			"name": "Henrik"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "lake_raw_paris",
						"type": "DatasetReference"
					},
					"name": "LGATABLE"
				},
				{
					"dataset": {
						"referenceName": "lake_raw_paris",
						"type": "DatasetReference"
					},
					"name": "LCATABLE"
				},
				{
					"dataset": {
						"referenceName": "dwh_stage_mapsys",
						"type": "DatasetReference"
					},
					"name": "TCrossReference"
				},
				{
					"dataset": {
						"referenceName": "dwh_prepare_preDim_lake",
						"type": "DatasetReference"
					},
					"name": "PreDimSubClaimDetailSource"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "dwh_prepare_pre_dim",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "FilterLGACRCODE"
				},
				{
					"name": "Deduplicate"
				},
				{
					"name": "Join"
				},
				{
					"name": "DerivedConstants"
				},
				{
					"name": "LookupTCrossReference"
				},
				{
					"name": "RemoveUnusedColumns"
				},
				{
					"name": "Expression"
				},
				{
					"name": "ChangeNames"
				},
				{
					"name": "LookupActualRecInitials"
				},
				{
					"name": "ChangeNames2"
				},
				{
					"name": "TCrossReference1"
				},
				{
					"name": "ActualRecInitials"
				},
				{
					"name": "Duplicates"
				},
				{
					"name": "JoinDeduplicates"
				},
				{
					"name": "LookupExistingRows"
				},
				{
					"name": "Select1"
				},
				{
					"name": "SelectKeyColumn"
				}
			],
			"script": "source(output(\n\t\tLGALGAID as string,\n\t\tLGALCAID as string,\n\t\tLGALN2 as decimal(38,18),\n\t\tLGACRCODE as string,\n\t\tLGARECEIVER as decimal(38,18),\n\t\tLGASTATUS as string,\n\t\tLGASTDATE as decimal(38,18),\n\t\tLGAENDATE as decimal(38,18),\n\t\tLGAGUACURR as string,\n\t\tLGAGUAAMT as decimal(38,18),\n\t\tLGAINTNOTE as string,\n\t\tLGAJURISDICTION as string,\n\t\tLGAOBOPEAID as decimal(38,18),\n\t\tLGACLMCAT as string,\n\t\tLGACRLGAID as string,\n\t\tLGAOBOCNAME as string,\n\t\tLGACANDATE as decimal(38,18),\n\t\tLGALCCID as string,\n\t\tLGAINTYNSW as string,\n\t\tLGACRYNSW as string,\n\t\tLGALUDATE as decimal(38,18),\n\t\tLGACRDATE as decimal(38,18),\n\t\tLGALUSIGN as string,\n\t\tLGACRSIGN as string,\n\t\tLGACRCRDATE as decimal(38,18),\n\t\tLGACRCRSIGN as string,\n\t\tLGAKNVMARK as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> LGATABLE\nsource(output(\n\t\tLCALCAID as string,\n\t\tLCAICAID as string,\n\t\tLCACLMN3 as decimal(38,18),\n\t\tLCACLMDATE as decimal(38,18),\n\t\tLCACYEAR as decimal(38,18),\n\t\tLCATRTMCO as decimal(38,18),\n\t\tLCAACSTAT as string,\n\t\tLCALOSSCO as string,\n\t\tLCAOUTSTM as string,\n\t\tLCAUWSIGN as string,\n\t\tLCAOFFICE as decimal(38,18),\n\t\tLCALDESCR as string,\n\t\tLCACLODATE as decimal(38,18),\n\t\tLCAECAUSECO as string,\n\t\tLCACLINTC as decimal(38,18),\n\t\tLCABONYNSW as string,\n\t\tLCAIMPEXP as decimal(38,18),\n\t\tLCANMCLEF as string,\n\t\tLCACCOD2 as string,\n\t\tLCAAREACD as string,\n\t\tLCACEFOUC as string,\n\t\tLCAONOFFS as decimal(38,18),\n\t\tLCAENINTRST as string,\n\t\tLCAMPLCURR as string,\n\t\tLCAMPLAMT as decimal(38,18),\n\t\tLCAXLMREF as string,\n\t\tLCAREPDATE as decimal(38,18),\n\t\tLCALIMCURR as string,\n\t\tLCALIMAMT as decimal(38,18),\n\t\tLCABIGEVENT as string,\n\t\tLCALODESCR as string,\n\t\tLCAINTNOTE as string,\n\t\tLCALTDATE as decimal(38,18),\n\t\tLCACRSIGN as string,\n\t\tLCACRDATE as decimal(38,18),\n\t\tLCALUSIGN as string,\n\t\tLCALUDATE as decimal(38,18),\n\t\tLCAKNVMARK as string,\n\t\tLCALABID as string,\n\t\tLCAAGAID as string,\n\t\tLCAOBNO as decimal(38,18),\n\t\tLCACROBBID as string,\n\t\tLCAWRKCLAIM as decimal(38,18),\n\t\tLCAFPAREACD as string,\n\t\tLCATOAREACD as string,\n\t\tLCAJURISDICTION as string,\n\t\tLCAFILEREF as decimal(38,18),\n\t\tLCANEXTSIGN as string,\n\t\tLCAAREADESCR as string,\n\t\tLCALRGCLMYNSW as string,\n\t\tLCAFROMAREACD as string,\n\t\tLCANEXTDATE as decimal(38,18),\n\t\tLCAOCCOFFDATE as decimal(38,18),\n\t\tLCAWORKPLACE as decimal(38,18),\n\t\tLCAWRKPLCCOD as decimal(38,18),\n\t\tLCAREGNDATE as decimal(38,18),\n\t\tLCAOCCOFFYNSW as string,\n\t\tLCAREGRESS as decimal(38,18),\n\t\tLCACLMPEAID as decimal(38,18),\n\t\tLCAOCCOWNYNSW as string,\n\t\tLCAREGNSIGN as string,\n\t\tLCAMUOFFPROS as decimal(38,18),\n\t\tLCAREGCURR as string,\n\t\tLCAREGAMT as decimal(38,18),\n\t\tLCAMUOWNPROS as decimal(38,18),\n\t\tLCALIMDAYS as decimal(38,18),\n\t\tLCAREGTEXT70 as string,\n\t\tLCAEUOFFPROS as decimal(38,18),\n\t\tLCAMUOFFGRP as decimal(38,18),\n\t\tLCAEUOWNPROS as decimal(38,18),\n\t\tLCABIRTNO as string,\n\t\tLCAADJSIGN as string,\n\t\tLCACAGTYP as string,\n\t\tLCACALCLAMTFRINJURED as string,\n\t\tLCACLMDATECHD as string,\n\t\tLCACLMID as decimal(38,18),\n\t\tLCACLMINTYNSW as string,\n\t\tLCACNDID as string,\n\t\tLCACOMMONYNSW as string,\n\t\tLCACOMPLLEVEL as string,\n\t\tLCAEXPPDATE as decimal(38,18),\n\t\tLCAFOADATE as decimal(38,18),\n\t\tLCAGEODESCR as string,\n\t\tLCAHOUR as decimal(38,18),\n\t\tLCAINSURED as decimal(38,18),\n\t\tLCAINSUREDMOF as string,\n\t\tLCALIABCODE as decimal(38,18),\n\t\tLCALIABTXT as string,\n\t\tLCALIMDEDAMT as decimal(38,18),\n\t\tLCALOADATE as decimal(38,18),\n\t\tLCAMANHAVSALAER as string,\n\t\tLCANOOFPERS as decimal(38,18),\n\t\tLCAPREPAYAMTP as decimal(38,18),\n\t\tLCAPREPAYCURR as string,\n\t\tLCATAUCODE as decimal(38,18),\n\t\tLCATAUTXT as string,\n\t\tLCATAXNO as string,\n\t\tLCATRANME as string,\n\t\tLCATRANTY as decimal(38,18),\n\t\tLCATZONE as string,\n\t\tLCACATTYPE as string,\n\t\tLCAEXTADJYNSW as string,\n\t\tLCAN1NOOFTREATM as decimal(38,18),\n\t\tLCAN2NOOFTREATM as decimal(38,18),\n\t\tLCAN3NOOFTREATM as decimal(38,18),\n\t\tLCAN4NOOFTREATM as decimal(38,18),\n\t\tLCAN5NOOFTREATM as decimal(38,18),\n\t\tLCAN6NOOFTREATM as decimal(38,18),\n\t\tLCAN7NOOFTREATM as decimal(38,18),\n\t\tLCAN8NOOFTREATM as decimal(38,18),\n\t\tLCAPORTCCCID as string,\n\t\tLCATLOTYPE as decimal(38,18),\n\t\tLCAWOCDATE as decimal(38,18),\n\t\tLCAWOCSTAT as string,\n\t\tLCAENASSSHR as decimal(38,18),\n\t\tLCAINSCURR as string,\n\t\tLCAECOID as string,\n\t\tLCAECLID as string,\n\t\tLCAECFID as string,\n\t\tLCAINSAMT as decimal(38,18),\n\t\tLCALIMRENEWED as decimal(38,18),\n\t\tLCACCOD2DATE as decimal(38,18),\n\t\tLCAEXTCLMID as string,\n\t\tLCATIMNOTE as string,\n\t\tLCATMDUEDATE as decimal(38,18),\n\t\tLCATMEXTLUDATE as decimal(38,18),\n\t\tLCAAUTOSETLEYN as string,\n\t\tLCATMLUDATE as decimal(38,18),\n\t\tLCATMEXTDOCID as decimal(38,18),\n\t\tLCATMEXTLUSIGN as string,\n\t\tLCATMLUSIGN as string,\n\t\tLCATMCLOLUDATE as decimal(38,18),\n\t\tLCATMSTATUS as string,\n\t\tLCATMCLOLUSIGN as string,\n\t\tLCATMEXTDUEDATE as decimal(38,18),\n\t\tLCACEFOCM as string,\n\t\tLCACEFOCC as string,\n\t\tLCATCAUSECO as string,\n\t\tLCANCAUSECO as string,\n\t\tLCACLMCAC as string,\n\t\tLCAMOVEDSIGN as string,\n\t\tLCAREDUCEPREM as string,\n\t\tLCAMOVEDTO as string,\n\t\tLCAISRNDCONTRSSIGNED as string,\n\t\tLCACATEGORYTYPE as string,\n\t\tLCAMOVEDDATE as decimal(38,18),\n\t\tLCAFINALSTATMDATE as decimal(38,18),\n\t\tLCARESUMTIONFROM as string,\n\t\tLCAINSUREDMNO as string,\n\t\tLCARECOVPOTAMT as decimal(38,18),\n\t\tLCAPILOTONBOARD as string,\n\t\tLCARECOVCCVID as decimal(38,18),\n\t\tLCARECOVREMDATE as decimal(38,18),\n\t\tLCARECOVACHCURR as string,\n\t\tLCARECOVPOTINTNOTE as string,\n\t\tLCARECOVACHYNSW as string,\n\t\tLCARECOVACHINTNOTE as string,\n\t\tLCARECOVACHDATE as decimal(38,18),\n\t\tLCARECOVPOTCURR as string,\n\t\tLCACCOD2TRMTDATE as decimal(38,18),\n\t\tLCACCOD2TXT35 as string,\n\t\tLCARECOVACHSIGN as string,\n\t\tLCARECOVPOTYNSW as string,\n\t\tLCARECOVACHAMT as decimal(38,18)\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> LCATABLE\nsource(output(\n\t\tSOURCE_CODE_KEY as string,\n\t\tSOURCE_SYSTEM as string,\n\t\tTARGET_CODE as string,\n\t\tTARGET_DESCRIPTION as string,\n\t\tCODE_TYPE as string,\n\t\tCODE_TYPE_ID as double,\n\t\tCODE2 as string,\n\t\tOM_X_REF as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> TCrossReference\nsource(output(\n\t\tSCD_KEY as string,\n\t\tSCD_ACTUAL_REC_COMMENTS as string,\n\t\tSCD_ACTUAL_REC_DATE as decimal(38,18),\n\t\tSCD_ACTUAL_REC_IND as string,\n\t\tSCL_ACTUAL_REC_INITIALS as string,\n\t\tSCD_ACTUAL_REMINDER_DATE as decimal(38,18),\n\t\tSCD_OBTAINED_GUARANTEE_IND as string,\n\t\tSCD_POSSIBLE_RECOVERY_IND as string,\n\t\tSCL_REASON_FOR_NO_REC_CODE as string,\n\t\tSCL_REASON_FOR_NO_REC_DESC as string,\n\t\tSCD_POSSIBLE_REC_COMMENTS as string,\n\t\tSCD_STRATEGY_PARTNER_IND as string,\n\t\tINSERTED_BY as string,\n\t\tDATE_INSERTED as date,\n\t\tSCD_IND_PENDING as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet') ~> PreDimSubClaimDetailSource\nLGATABLE filter(LGACRCODE == 'R') ~> FilterLGACRCODE\nFilterLGACRCODE aggregate(groupBy(LGALCAID),\n\tLGALGAID = first(LGALGAID)) ~> Deduplicate\nLCATABLE, JoinDeduplicates join(LCALCAID == Deduplicate@LGALCAID,\n\tjoinType:'left',\n\tbroadcast: 'none')~> Join\nExpression derive(SCL_DELETED_IND = 'N',\n\t\tMAPPING_NAME = 'M_PRE_DIM_SUB_CLAIM_DETAIL_ME',\n\t\tLOAD_DATE = currentDate('CET')) ~> DerivedConstants\nDerivedConstants, TCrossReference1 lookup(toString(LCARECOVCCVID) == SOURCE_CODE_KEY,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LookupTCrossReference\nJoin select(mapColumn(\n\t\tLCALCAID,\n\t\tLCATRTMCO,\n\t\tLCARECOVCCVID,\n\t\tLCARECOVREMDATE,\n\t\tLCARECOVPOTINTNOTE,\n\t\tLCARECOVACHYNSW,\n\t\tLCARECOVACHINTNOTE,\n\t\tLCARECOVACHDATE,\n\t\tLCARECOVPOTCURR,\n\t\tLCARECOVACHSIGN,\n\t\tLCARECOVPOTYNSW,\n\t\tLCARECOVACHAMT,\n\t\tLGALCAID = Deduplicate@LGALCAID,\n\t\tLGACRCODE\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> RemoveUnusedColumns\nRemoveUnusedColumns derive(LCA_ID = \"P{LCALCAID}\",\n\t\tGUARANTEE_IND = case(isNull(LGALCAID), 'N', 'Y'),\n\t\tSCD_POSSIBLE_REC_COMMENTS = left(LCARECOVPOTINTNOTE, 256),\n\t\tSCD_ACTUAL_REC_COMMENTS = left(LCARECOVACHINTNOTE, 256),\n\t\tSCD_STRATEGY_PARTNER_IND = 'N',\n\t\tSCD_POSSIBLE_RECOVERY_IND = case(LCARECOVPOTYNSW=='Y', 'Y', 'N'),\n\t\tSCD_IND_PENDING = case(in([1, 3], coalesce(toInteger(LCATRTMCO), 9)), 'Y', 'N')) ~> Expression\nLookupTCrossReference select(mapColumn(\n\t\tLCALCAID,\n\t\tLCATRTMCO,\n\t\tLCARECOVCCVID,\n\t\tLCARECOVREMDATE,\n\t\tLCARECOVPOTINTNOTE,\n\t\tLCARECOVACHYNSW,\n\t\tLCARECOVACHINTNOTE,\n\t\tLCARECOVACHDATE,\n\t\tLCARECOVPOTCURR,\n\t\tLCARECOVACHSIGN,\n\t\tLCARECOVPOTYNSW,\n\t\tLCARECOVACHAMT,\n\t\tLGALCAID,\n\t\tLGACRCODE,\n\t\tLCA_ID,\n\t\tGUARANTEE_IND,\n\t\tSCD_POSSIBLE_REC_COMMENTS,\n\t\tSCD_ACTUAL_REC_COMMENTS,\n\t\tSCD_STRATEGY_PARTNER_IND,\n\t\tSCD_POSSIBLE_RECOVERY_IND,\n\t\tSCD_IND_PENDING,\n\t\tSCL_DELETED_IND,\n\t\tMAPPING_NAME,\n\t\tLOAD_DATE,\n\t\tSOURCE_CODE_KEY,\n\t\tSCL_REASON_FOR_NO_REC_CODE = TARGET_CODE,\n\t\tSCL_REASON_FOR_NO_REC_DESC = TARGET_DESCRIPTION\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ChangeNames\nChangeNames, ActualRecInitials lookup(LCARECOVACHSIGN == TCrossReference@SOURCE_CODE_KEY,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LookupActualRecInitials\nLookupActualRecInitials select(mapColumn(\n\t\tSCD_KEY = LCA_ID,\n\t\tSCD_ACTUAL_REC_COMMENTS,\n\t\tSCD_ACTUAL_REC_DATE = LCARECOVACHDATE,\n\t\tSCD_ACTUAL_REC_IND = LCARECOVACHYNSW,\n\t\tSCL_ACTUAL_REC_INITIALS = TARGET_CODE,\n\t\tSCD_ACTUAL_REMINDER_DATE = LCARECOVREMDATE,\n\t\tSCD_OBTAINED_GUARANTEE_IND = GUARANTEE_IND,\n\t\tSCD_POSSIBLE_RECOVERY_IND,\n\t\tSCL_REASON_FOR_NO_REC_CODE,\n\t\tSCL_REASON_FOR_NO_REC_DESC,\n\t\tSCD_POSSIBLE_REC_COMMENTS,\n\t\tSCD_STRATEGY_PARTNER_IND,\n\t\tINSERTED_BY = MAPPING_NAME,\n\t\tLAST_UPDATED_BY = MAPPING_NAME,\n\t\tDATE_INSERTED = LOAD_DATE,\n\t\tDATE_LAST_UPDATED = LOAD_DATE,\n\t\tSCD_IND_PENDING\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ChangeNames2\nTCrossReference filter(SOURCE_SYSTEM == 'PARIS'&&\r\nCODE_TYPE_ID == 804) ~> TCrossReference1\nTCrossReference filter(SOURCE_SYSTEM == 'PARIS' &&\r\nCODE_TYPE_ID == 329) ~> ActualRecInitials\nFilterLGACRCODE select(mapColumn(\n\t\tLGALGAID,\n\t\tLGALCAID,\n\t\tLGALN2,\n\t\tLGACRCODE,\n\t\tLGARECEIVER,\n\t\tLGASTATUS,\n\t\tLGASTDATE,\n\t\tLGAENDATE,\n\t\tLGAGUACURR,\n\t\tLGAGUAAMT,\n\t\tLGAINTNOTE,\n\t\tLGAJURISDICTION,\n\t\tLGAOBOPEAID,\n\t\tLGACLMCAT,\n\t\tLGACRLGAID,\n\t\tLGAOBOCNAME,\n\t\tLGACANDATE,\n\t\tLGALCCID,\n\t\tLGAINTYNSW,\n\t\tLGACRYNSW,\n\t\tLGALUDATE,\n\t\tLGACRDATE,\n\t\tLGALUSIGN,\n\t\tLGACRSIGN,\n\t\tLGACRCRDATE,\n\t\tLGACRCRSIGN,\n\t\tLGAKNVMARK\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Duplicates\nDeduplicate, Duplicates join(Deduplicate@LGALGAID == Duplicates@LGALGAID,\n\tjoinType:'inner',\n\tbroadcast: 'none')~> JoinDeduplicates\nChangeNames2, SelectKeyColumn lookup(ChangeNames2@SCD_KEY == SCD_KEY2,\n\tmultiple: false,\n\tpickup: 'any',\n\tbroadcast: 'none')~> LookupExistingRows\nLookupExistingRows select(mapColumn(\n\t\tSCD_KEY,\n\t\tSCD_ACTUAL_REC_COMMENTS,\n\t\tSCD_ACTUAL_REC_DATE,\n\t\tSCD_ACTUAL_REC_IND,\n\t\tSCL_ACTUAL_REC_INITIALS,\n\t\tSCD_ACTUAL_REMINDER_DATE,\n\t\tSCD_OBTAINED_GUARANTEE_IND,\n\t\tSCD_POSSIBLE_RECOVERY_IND,\n\t\tSCL_REASON_FOR_NO_REC_CODE,\n\t\tSCL_REASON_FOR_NO_REC_DESC,\n\t\tSCD_POSSIBLE_REC_COMMENTS,\n\t\tSCD_STRATEGY_PARTNER_IND,\n\t\tINSERTED_BY,\n\t\tDATE_INSERTED,\n\t\tSCD_IND_PENDING\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Select1\nPreDimSubClaimDetailSource select(mapColumn(\n\t\tSCD_KEY2 = SCD_KEY\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectKeyColumn\nSelect1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'parquet',\n\tpartitionFileNames:['pre_dim_claim_type_new.parquet'],\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
		}
	}
}